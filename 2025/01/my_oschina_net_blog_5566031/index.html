<!doctype html><html lang=zh-CH><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>StarRocks 技术内幕 | 基于全局字典的极速字符串查询 - 杂货铺</title><meta name=Description content="杂七杂八的，随手记录。"><meta property="og:url" content="https://yangyingchao.github.io/2025/01/my_oschina_net_blog_5566031/"><meta property="og:site_name" content="杂货铺"><meta property="og:title" content="StarRocks 技术内幕 | 基于全局字典的极速字符串查询"><meta property="og:description" content="Table of Contents 1 为什么要引入低基数字典优化 2 为什么需要全局字典 3 如何高效构建全局字典 3.1 通常的分布式字典构建方式 3.2 StarRocks 全局字典的构建 4 如何高效使用全局字典 4.1 CBO 优化器的紧密配合 4.2 全局字典的字符串函数优化 5 优化效果 6 总结 本文为摘录(或转载)，侵删，原文为： https://segmentfault.com/a/1190000042326071
作者：冯浩桉，StarRocks 核心研发工程师，StarRocks Committer"><meta property="og:locale" content="zh_CH"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-03T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-03T00:00:00+00:00"><meta property="article:tag" content="Starrocks"><meta property="article:tag" content="String"><meta property="article:tag" content="Global"><meta property="article:tag" content="Low"><meta property="article:tag" content="Cardinality"><meta property="og:image" content="https://yangyingchao.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yangyingchao.github.io/logo.png"><meta name=twitter:title content="StarRocks 技术内幕 | 基于全局字典的极速字符串查询"><meta name=twitter:description content="Table of Contents 1 为什么要引入低基数字典优化 2 为什么需要全局字典 3 如何高效构建全局字典 3.1 通常的分布式字典构建方式 3.2 StarRocks 全局字典的构建 4 如何高效使用全局字典 4.1 CBO 优化器的紧密配合 4.2 全局字典的字符串函数优化 5 优化效果 6 总结 本文为摘录(或转载)，侵删，原文为： https://segmentfault.com/a/1190000042326071
作者：冯浩桉，StarRocks 核心研发工程师，StarRocks Committer"><meta name=application-name content="杂货铺"><meta name=apple-mobile-web-app-title content="杂货铺"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yangyingchao.github.io/2025/01/my_oschina_net_blog_5566031/><link rel=prev href=https://yangyingchao.github.io/2025/01/segmentfault_com_a_1190000042739883/><link rel=next href=https://yangyingchao.github.io/2025/01/clickhouse_com_data-types_lowcardinality/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"StarRocks 技术内幕 | 基于全局字典的极速字符串查询","inLanguage":"zh-CH","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yangyingchao.github.io\/2025\/01\/my_oschina_net_blog_5566031\/"},"image":["https:\/\/yangyingchao.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"starrocks, string, global, low, cardinality","wordcount":4964,"url":"https:\/\/yangyingchao.github.io\/2025\/01\/my_oschina_net_blog_5566031\/","datePublished":"2025-01-03T00:00:00+00:00","dateModified":"2025-01-03T00:00:00+00:00","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/yangyingchao.github.io\/images\/avatar.jpg","width":160,"height":160}},"author":{"@type":"Person","name":"yc"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=杂货铺><span class=header-title-pre><i class='fa-solid fa-house-chimney'></i></span>老杨的杂货铺</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=https://github.com/yangyingchao title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=杂货铺><span class=header-title-pre><i class='fa-solid fa-house-chimney'></i></span>老杨的杂货铺</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=https://github.com/yangyingchao title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">StarRocks 技术内幕 | 基于全局字典的极速字符串查询</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>yc</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-01-03>2025-01-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 4964 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 10 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#为什么要引入低基数字典优化><span class=section-num>1</span> 为什么要引入低基数字典优化</a></li><li><a href=#为什么需要全局字典><span class=section-num>2</span> 为什么需要全局字典</a></li><li><a href=#如何高效构建全局字典><span class=section-num>3</span> 如何高效构建全局字典</a><ul><li><a href=#通常的分布式字典构建方式><span class=section-num>3.1</span> 通常的分布式字典构建方式</a><ul><li><a href=#用户指定-schema-用户在建表的时候-指定对应的列为低基数列><span class=section-num>3.1.1</span> 用户指定 Schema，用户在建表的时候，指定对应的列为低基数列</a></li><li><a href=#导入时候构建全局字典><span class=section-num>3.1.2</span> 导入时候构建全局字典</a></li></ul></li><li><a href=#starrocks-全局字典的构建><span class=section-num>3.2</span> StarRocks 全局字典的构建</a><ul><li><a href=#数据存储上的字典优化><span class=section-num>3.2.1</span> 数据存储上的字典优化</a></li><li><a href=#全局字典的构建><span class=section-num>3.2.2</span> 全局字典的构建</a></li><li><a href=#全局字典的正确性保证><span class=section-num>3.2.3</span> 全局字典的正确性保证</a></li></ul></li></ul></li><li><a href=#如何高效使用全局字典><span class=section-num>4</span> 如何高效使用全局字典</a><ul><li><a href=#cbo-优化器的紧密配合><span class=section-num>4.1</span> CBO 优化器的紧密配合</a><ul><li><a href=#case-1><span class=section-num>4.1.1</span> case 1</a></li><li><a href=#case-2><span class=section-num>4.1.2</span> case 2</a></li><li><a href=#case-3><span class=section-num>4.1.3</span> case 3</a></li></ul></li><li><a href=#全局字典的字符串函数优化><span class=section-num>4.2</span> 全局字典的字符串函数优化</a></li></ul></li><li><a href=#优化效果><span class=section-num>5</span> 优化效果</a></li><li><a href=#总结><span class=section-num>6</span> 总结</a></li></ul></nav></div></div><div class=content id=content><div class="ox-hugo-toc toc has-section-numbers"><div class=heading>Table of Contents</div><ul><li><span class=section-num>1</span> <a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e5%bc%95%e5%85%a5%e4%bd%8e%e5%9f%ba%e6%95%b0%e5%ad%97%e5%85%b8%e4%bc%98%e5%8c%96 rel>为什么要引入低基数字典优化</a></li><li><span class=section-num>2</span> <a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e5%85%a8%e5%b1%80%e5%ad%97%e5%85%b8 rel>为什么需要全局字典</a></li><li><span class=section-num>3</span> <a href=#%e5%a6%82%e4%bd%95%e9%ab%98%e6%95%88%e6%9e%84%e5%bb%ba%e5%85%a8%e5%b1%80%e5%ad%97%e5%85%b8 rel>如何高效构建全局字典</a><ul><li><span class=section-num>3.1</span> <a href=#%e9%80%9a%e5%b8%b8%e7%9a%84%e5%88%86%e5%b8%83%e5%bc%8f%e5%ad%97%e5%85%b8%e6%9e%84%e5%bb%ba%e6%96%b9%e5%bc%8f rel>通常的分布式字典构建方式</a></li><li><span class=section-num>3.2</span> <a href=#starrocks-%e5%85%a8%e5%b1%80%e5%ad%97%e5%85%b8%e7%9a%84%e6%9e%84%e5%bb%ba rel>StarRocks 全局字典的构建</a></li></ul></li><li><span class=section-num>4</span> <a href=#%e5%a6%82%e4%bd%95%e9%ab%98%e6%95%88%e4%bd%bf%e7%94%a8%e5%85%a8%e5%b1%80%e5%ad%97%e5%85%b8 rel>如何高效使用全局字典</a><ul><li><span class=section-num>4.1</span> <a href=#cbo-%e4%bc%98%e5%8c%96%e5%99%a8%e7%9a%84%e7%b4%a7%e5%af%86%e9%85%8d%e5%90%88 rel>CBO 优化器的紧密配合</a></li><li><span class=section-num>4.2</span> <a href=#%e5%85%a8%e5%b1%80%e5%ad%97%e5%85%b8%e7%9a%84%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%87%bd%e6%95%b0%e4%bc%98%e5%8c%96 rel>全局字典的字符串函数优化</a></li></ul></li><li><span class=section-num>5</span> <a href=#%e4%bc%98%e5%8c%96%e6%95%88%e6%9e%9c rel>优化效果</a></li><li><span class=section-num>6</span> <a href=#%e6%80%bb%e7%bb%93 rel>总结</a></li></ul></div><p>本文为摘录(或转载)，侵删，原文为： <a href=https://segmentfault.com/a/1190000042326071 target=_blank rel="noopener noreffer">https://segmentfault.com/a/1190000042326071</a></p><p><code>作者：冯浩桉，StarRocks 核心研发工程师，StarRocks Committer</code></p><p>在数据库和存储系统中，String 类型数据广泛存在。为了提升 String 的处理效率和节省存储资源，出现了很多针对 String 类型进行优化的技术手段，例如提升处理效率的各类字典应用，提升存储效率的字典编码压缩技术。</p><p>本文主要针对 StarRocks 基于全局字典做的低基数 String 查询优化，揭秘其技术内幕。</p><h2 id=为什么要引入低基数字典优化><span class=section-num>1</span> 为什么要引入低基数字典优化</h2><p>我们先看下两个 SQL 的对比，表 Lineorder 是 SSB100G 数据集， <code>lo_shippriority</code> 为低基数 int 列， <code>l_shipmode</code> 为低基数 String 列</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>cnt</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>lo_shippriority</span><span class=p>)</span><span class=w> </span><span class=n>tb</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>cnt</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>          </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>3</span><span class=p>.</span><span class=mi>51</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>cnt</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>lo_shipmode</span><span class=p>)</span><span class=w> </span><span class=n>tb</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>cnt</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>          </span><span class=mi>7</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>9</span><span class=p>.</span><span class=mi>33</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>可以看到，处理相同数据量的情况下，String 类型的处理时间差不多是 int 类型的 3 倍。</p><p>如果能使用整数类型来替代 String 类型进行数据处理，能够显著提升系统的性能！</p><p>对于利用整型替代字符串进行处理，通常是使用字典编码进行优化。一个 SQL 从输入到输出结果，往往会经过这几个步骤，几乎每一个阶段都可以使用字典优化：Scan，Filter，Agg，Join，Shuffle，Sort。</p><p>以 Filter 和 Agg 为例：</p><ul><li><p>Filter (过滤操作)</p><figure><img src=/ox-hugo/347ac70abb2_f8b6b51c8af54d8d1e0ed1ca959a5c6e.png width=800px></figure></li></ul><p>​ 对于 Filter 阶段来说，如果某一个列是用字典编码的，我们就可以直接使用编码之后的整数进行比较，而不是直接用 String
进行比较操作。大多数情况下，整数之间的 Compare 性能会高于字符串之间的性能。</p><ul><li><p>Agg (聚合操作)</p><figure><img src=/ox-hugo/347ac70abb2_d9efa9be7a51c8e9f21d737efad4f4fe.jpeg width=800px></figure><p>对于 Agg 操作，如果使用了字典编码，我们在聚合中可以使用编码之后的值作为聚合的 Key。如此一来，在聚合操作的
Hash 表构建和查找过程中，可以减少 Hash 表中 Key 的比较代价，同时也能够加快 Hash 值计算，节省内存空间，可以提升聚合操作的速度。</p><p>因此如果我们使用字典的编码方式把字符串转变成整型，在 SQL 执行的很多阶段，都可以起到正向加速的效果。</p><p>使用整型来替代 String 类型进行加速计算，业界通常使用的手段是使用字典优化。但是对于一个复杂系统来说，想要充分利用字典优化，并不是一件容易的事情。</p></li></ul><h2 id=为什么需要全局字典><span class=section-num>2</span> 为什么需要全局字典</h2><p>在一个分布式执行引擎中，一个 SQL 的执行过程是复杂的。一个查询会存在多个执行阶段，可能会涉及到多个机器多个任务之间的数据交换。如果想充分利用字典优化，那么需要考虑很多的情况:</p><ul><li><p>在执行过程中，字典要保证全局性<br>也就是说在不同的节点之间同样需要维护一个字典。字典数据始终贯穿 SQL 执行的整个生命周期，如果不是全局字典，那么加速只能在局部进行。例如如果两个执行节点的字典编码不一致，那么在网络传输过程中需要同时把字典传给对端机器，或者是需要提前把字典码转为字符串再通过网络发送。如果能保证一个字典的全局性，在网络传输中就可以直接使用字典码而不再需要传输字典。</p></li><li><p>查询规划器规划出使用全局字典最高效的方式<br>如果一个 SQL 在执行过程中没有网络 Shuffle，也不存在潜在应用字典优化的操作，那么不再采用字典优化。例如 <code>insert into t1 select * from t2</code> 这样的 SQL，中间既不存在数据网络 Shuffle，也不存在可能会应用到低基数优化的算子。那么这样的 SQL 就不适合使用低基数优化。</p></li></ul><p>对于一个复杂的、支持实时数据更新的分布式数据库，做到以上两点，并不容易。所以很多的分布式系统，只是用了字典来做局部加速，并没有做全局加速。</p><figure><img src=/ox-hugo/347ac70abb2_8adc293a54bde3bc2f10c32358fb5682.png width=800px></figure><h2 id=如何高效构建全局字典><span class=section-num>3</span> 如何高效构建全局字典</h2><p>为了充分利用字典加速，首先需要解决的问题就是全局字典构建和维护问题。</p><h3 id=通常的分布式字典构建方式><span class=section-num>3.1</span> 通常的分布式字典构建方式</h3><p>对于很多系统来说，通常构建全局字典的方式有两种：</p><h4 id=用户指定-schema-用户在建表的时候-指定对应的列为低基数列><span class=section-num>3.1.1</span> 用户指定 Schema，用户在建表的时候，指定对应的列为低基数列</h4><p>因为用户指定了低基数，那么可以在数据导入的时候，构建全局字典，因为知道了基数范围，全局字典很好维护，按着特定的规则去生成就好了，存储的代价也不高。</p><p>但是这么做，主要存在的问题在于：</p><ul><li>对用户不友好，需要用户指定 Schema，当基数存在变化，比如基数变高后，不方便维护</li><li>无法提升已经运行的系统的性能，必须得重建表并且重新导入数据后才能使用。</li></ul><h4 id=导入时候构建全局字典><span class=section-num>3.1.2</span> 导入时候构建全局字典</h4><p>导入数据时，通过中心节点维护全局字典。每次遇到新的的字符都要通过中心节点创建一个新的字典码。但是这么做的主要问题是中心节点很容易会成为瓶颈。另外中心节点因为需要同时处理维护并发控制。</p><p>因为维护和构建字典对于很多系统来说都是一个比较困难的事情，因此很多系统，只是在局部使用了局部字典来进行加速，并不支持字典的全局加速。</p><h3 id=starrocks-全局字典的构建><span class=section-num>3.2</span> StarRocks 全局字典的构建</h3><p>对于 StarRocks 的全局字典的构建，主要有以下考虑：</p><ul><li><p>自适应，不需要用户通过 Schema 指定特定低基数列，而是根据数据特性，自动选择优化策略。</p></li><li><p>尽可能避免单点问题，比如数据导入的时候遇到新的字符串，先通过中心节点更新全局字典。</p></li></ul><h4 id=数据存储上的字典优化><span class=section-num>3.2.1</span> 数据存储上的字典优化</h4><p>首先先来看下 StarRocks 的数据存储的结构。</p><p>StarRocks 的基本存储单元为 Segment，每个 Segment 的存储结构如下图所示：</p><figure><img src=/ox-hugo/347ac70abb2_2c29ab820d61742525b464ea481883fe.png width=800px></figure><p>StarRocks 的存储结构天然为低基数字符串做了字典编码。对于 Segment 上的低基数字符串列会有以下特点：</p><ul><li><p>Footer 上会存储有这个 Column 特有的字典信息，包括字典码跟原始字符串之间的映射关系；</p></li><li><p>Data page 上存储的不是原始字符串，而是整数类型的字典码(整型)。</p></li></ul><p>简单的示意图如下：</p><figure><img src=/ox-hugo/347ac70abb2_c1fb6d14080a67f84dc2aabe20a1e148.png width=800px></figure><p>当处理低基数 String column 的时候，直接使用编码后的字典码，而不是直接处理原始的 String 值。当需要原始的 String
值时，使用字典码就可以很方便地在这个列的字典信息里面拿到原始 String 值。这么做带来的明显好处是：</p><ul><li><p>减少了磁盘 IO。</p></li><li><p>可以提前做一些过滤操作，提升处理速度。</p></li></ul><h4 id=全局字典的构建><span class=section-num>3.2.2</span> 全局字典的构建</h4><p>StarRocks 支持 CBO 优化器，并且存在一套统计信息机制，那么就可以通过统计信息来收集全局字典。我们通过统计信息，筛选出潜在的低基数列，再从潜在的低基数列的元数据中读取字典信息，然后做去重/编码操作，就可以收集到全量的字典了。</p><h4 id=全局字典的正确性保证><span class=section-num>3.2.3</span> 全局字典的正确性保证</h4><p>对于低基数列来说，那么肯定会出现一种情况，在某次导入中导入了新的 String (这个 String 不在全局字典的集合内)，那么这个时候，原先已经构建的全局字典就没有办法包含所有的字符串的值。因此 StarRocks 需要维护全局字典的有效性。</p><p>全局字典可能失效只会出现在导入， StarRocks 支持了很多类型的数据导入方式，而所有的导入都有两个共同点</p><ul><li><p>导入产生新的 Segment。</p></li><li><p>通过 Master FE 提交事务。</p></li></ul><p>对于低基数列，所有 Segment 中都必定存在局部字典信息，那么对于一个新的导入，在产生新的 Segment 时，会有几种情况。</p><ul><li><p>如果新生成的 Segment 没有了局部字典，那么说明这个列很可能是一个高基数列，此时不再适合全局字典优化；</p></li><li><p>新生成的 Segment 有局部字典，而且局部字典中的所有 String 是全局字典的子集，这种情况下可以直接使用旧的字典；</p></li><li><p>新生成的 Segment 有局部字典，而且局部字典所有的 String 值，部分不在全局字典里，此时全局字典失效已经生效，需要重新生成全局字典。</p></li></ul><p>无论出现了上面的哪种情况，在向 FE 中心节点提交的时候，带上这个对应的信息，我们就都能保证全局字典的正确性。</p><p>因为每次导入都是产生新的版本，而查询是支持 MVCC 的，每次查询都会带有一个固定的查询版本号。在某一时刻中，如果出现一个新的版本数据，那么对这个版本出现之前的所有查询都是不可见的。因此我们查询中如果有新的导入，那么已发起的查询也是不受影响的。</p><h2 id=如何高效使用全局字典><span class=section-num>4</span> 如何高效使用全局字典</h2><h3 id=cbo-优化器的紧密配合><span class=section-num>4.1</span> CBO 优化器的紧密配合</h3><p>对于一个简单的聚合 SQL 来说，其执行过程如下：</p><figure><img src=/ox-hugo/347ac70abb2_fb6796e1d13e7375ced32b8a03236a6d.png></figure><p>因为 StarRocks 是个分布式系统，其数据分散在多个后端 BE 实例上，且存在多个副本。Segment 内的字典是一个局部的字典，不能作为全局字典码使用。</p><p>对于一个没有使用全局字典优化的 SQL，在 SCAN NODE 扫描 Segment 数据的过程中就需要将对应把局部的字典码(int)解码成原始的 String 返回给上层节点。</p><p>如果使用了全局字典优化，我们就不需要 SCAN NODE 节点就进行 Decoded，而是可以将原先的局部字典码(int)，直接映射到全局字典中的字典码(int)，并在之后的计算处理过程中，均使用全局字典码进行处理。当遇到某些特殊的算子，或者是需要具体的依赖字符串内部信息的时候，再按着全局字典的信息，Decoded 出原始的 String 值，这样可以充分利用到全局字典的加速。</p><p>下图展示了 SCAN NODE 使用全局字典后，向上传递的数据使用了 int 编码：</p><figure><img src=/ox-hugo/347ac70abb2_b6f7e5e8c1a2dd5ac1f63aeaab0ad5e2.jpeg width=800px></figure><p>既然我们已经有了全局字典，那么接下来的问题就是更高效地使用好全局字典。</p><p>当存在全局字典的时候，所需要做的比较关键的就是：</p><ul><li><p>将对 String 的操作转化为对 int 的操作时，从而提升处理的速度，节省对应的资源。</p></li><li><p>当遇到无法使用 int 替代 String 的操作时，需要提前将字典码 Decoded 成 String。</p></li></ul><p>举个例子：</p><p>lineitem 表中的 l_shipmode 是低基数 String 列</p><h4 id=case-1><span class=section-num>4.1.1</span> case 1</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineitem</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>l_shipmode</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>对于这个 SQL 来说，我们需要的只是聚合之后的行数，因此在整个 SQL 的执行过程中，都可以使用 int 来替代 String 进行处理，并不需要进行 Decoded。</p><figure><img src=/ox-hugo/347ac70abb2_e706b2a2f766822d4ec62cde08192149.png></figure><h4 id=case-2><span class=section-num>4.1.2</span> case 2</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=w> </span><span class=n>l_shipmode</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineitem</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>l_shipmode</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>而对于这个 SQL，需要的不仅仅是聚合后的结果数，还有对应的字符串值。在这里我们需要在结果输出之前，进行 Decoded，将
int 值翻译成 String。</p><p>对于第二条 SQL 来说，其执行过程如下所示：</p><figure><img src=/ox-hugo/347ac70abb2_d18ba0f85a95adfb0a6d50b29fa6b986.png></figure><p>可以看到第二条 SQL 多了个 Decode 节点。</p><p>对于低基数 String 列来说，聚合后的行数并不多，这个 Decode 的成本基本可以忽略不计，反而在之前的处理，使用 int 替代 String 所带来的提升是巨大的。</p><p>那么，对于查询规划器来说，要做的就是选择最合适的 Decode 时期，最大限度地提升性能。</p><h4 id=case-3><span class=section-num>4.1.3</span> case 3</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineitem</span><span class=err>；</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>对于上面的 SQL 来说，使用全局字典，反而会带来额外的解码的开销。对于这样的 SQL，我们的 CBO 优化器需要正确规划，并且不会使用字典。</p><h3 id=全局字典的字符串函数优化><span class=section-num>4.2</span> 全局字典的字符串函数优化</h3><p>上面的 SQL 都是简单的例子。如果稍微对 SQL 进行一些改动，比如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=w> </span><span class=n>l_shipmode</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineitem</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>substr</span><span class=p>(</span><span class=n>l_shipmode</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>在这个 SQL 中，需要对 String 列进行 substr 运算，并且按着运算后的值进行聚合，这么一看，那肯定是需要在聚合前，插入一个 Decode 节点来把字典码转为具体的字符串值了，甚至在扫描数据的时候，就需要原始的 String 列了。</p><p>对于这条 SQL 来说，使用 int 值替代 String 来进行聚合，所带来的提升是巨大的，我们应该发挥全局字典的最大价值。</p><p>对于大多数的字符串函数来说，他们的计算往往有下面的一些特点:</p><ul><li><p>对于固定的输入，输出也是固定，最简单的比如 substring 函数, <code>substring("abc", 1, 2)</code> 的结果一定是 &ldquo;AB&rdquo;；</p></li><li><p>大部分 String 操作，都符合上面的定义。</p></li></ul><p>既然对于单个 String 的运算，输出是固定的，那么对于固定集合的 String 的运算，其结果集合也一定是固定的，比如对
<code>{"s1", "s2", "s11" }</code> 进行 <code>substring (str, 1, 2)</code> 运算，其结果也一定是 <code>{"s1", "s2", "s11" }</code> 。</p><p>很明显，当有了低基数全局字典，全局字典里面的 String 取值，就是固定的集合。因此，我们将对单个 String 的操作，转化为对 String 集合的操作，而这个操作，在 SQL 执行的过程中，只需要执行一次。</p><p>以上面的 substr SQL 为例子，当低基数列 l_shipmode 存在全局字典时，我们运用 substr 对全局字典进行计算，计算的示意图如下：</p><figure><img src=/ox-hugo/347ac70abb2_90ac9dd0770b607431da71da8160dec1.png width=800px></figure><p>对于上图所示的全局字典来说，substring(&ldquo;hello&rdquo;, 1, 2) 和 substring(&ldquo;world&rdquo;, 1, 3)产生的结果集是 {&ldquo;he&rdquo;, &ldquo;wo&rdquo;}。我们会把所有的输出都加入到一个新的字典中，与此同时，我们还得到了两个字典之间的转换关系。</p><p>例如字典码 1 的输入在经过这个函数之后会变成新字典的字典码 1。</p><p>有了这个映射关系，对输入的数据，进行 substring 操作，那就很简单了，因为我们输入的数据是全局字典码，并不是原始的
String，我们只需要按着 substring 中两个字典之间的转换关系，将对应的字典码通过映射输出成对应的新字典码，就完成了相关函数的计算。</p><figure><img src=/ox-hugo/347ac70abb2_ce2a3281a4245d633864f36f9209ee31.png></figure><p>对于这类的字符串函数，并不需要进行 Decode 获取原始 String 来调用函数处理，而且这种映射的方法，对于直接使用字符串进行计算也有一定的性能提升，尤其是对复杂的表达式。</p><h2 id=优化效果><span class=section-num>5</span> 优化效果</h2><p>我们选取了几组典型的 SQL，对比了开启低基数下的性能。</p><p>StarRocks 2.0+ 后的版本默认会开启低基数字典优化：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>set</span><span class=w> </span><span class=n>cbo_enable_low_cardinality_optimize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>true</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>对比 SQL：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=n>lo_shipmode</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>lo_shipmode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=k>distinct</span><span class=w> </span><span class=n>lo_shipmode</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=n>lo_shipmode</span><span class=p>,</span><span class=n>lo_orderpriority</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>lo_shipmode</span><span class=p>,</span><span class=n>lo_orderpriority</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=n>lo_shipmode</span><span class=p>,</span><span class=n>lo_orderpriority</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>lo_shipmode</span><span class=p>,</span><span class=n>lo_orderpriority</span><span class=p>,</span><span class=n>lo_shippriority</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder_flat</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>lo_shipmode</span><span class=p>,</span><span class=n>lo_orderpriority</span><span class=p>,</span><span class=n>p_category</span><span class=p>,</span><span class=n>s_nation</span><span class=p>,</span><span class=n>c_nation</span><span class=p>)</span><span class=w> </span><span class=n>t</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder_flat</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>lo_shipmode</span><span class=p>,</span><span class=n>lo_orderpriority</span><span class=p>,</span><span class=n>p_category</span><span class=p>,</span><span class=n>s_nation</span><span class=p>,</span><span class=n>c_nation</span><span class=p>,</span><span class=n>p_mfgr</span><span class=p>)</span><span class=w> </span><span class=n>t</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder_flat</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>substr</span><span class=p>(</span><span class=n>lo_shipmode</span><span class=p>,</span><span class=mi>2</span><span class=p>),</span><span class=k>lower</span><span class=p>(</span><span class=n>lo_orderpriority</span><span class=p>),</span><span class=n>p_category</span><span class=p>,</span><span class=n>s_nation</span><span class=p>,</span><span class=n>c_nation</span><span class=p>,</span><span class=n>s_region</span><span class=p>,</span><span class=n>p_mfgr</span><span class=p>)</span><span class=w> </span><span class=n>t</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>),</span><span class=n>lo_shipmode</span><span class=p>,</span><span class=n>s_city</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder_flat</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>lo_shipmode</span><span class=p>,</span><span class=n>s_city</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder_flat</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>c_city</span><span class=p>,</span><span class=n>s_city</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder_flat</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>c_city</span><span class=p>,</span><span class=n>s_city</span><span class=p>,</span><span class=n>c_nation</span><span class=p>,</span><span class=n>s_nation</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder_flat</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>lo_shipmode</span><span class=p>,</span><span class=n>lo_orderdate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>lineorder_flat</span><span class=w> </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>lo_orderdate</span><span class=p>,</span><span class=n>s_nation</span><span class=p>,</span><span class=n>s_region</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>对比结果：</p><figure><img src=/ox-hugo/347ac70abb2_65870f92ed27574701a34e9f323b293e.png width=800px></figure><p>从效果上来看，开启低基数优化的 SQL 比没开启低基数优化的 SQL 平均快了 3 倍。</p><h2 id=总结><span class=section-num>6</span> 总结</h2><p>StarRocks 的低基数 String 优化，主要的特点有:</p><ul><li><p>全局的字典加速，作用于 SQL 执行的各个阶段。</p></li><li><p>基于 CBO 优化器的，自适应选择全局字典的加速策略。</p></li><li><p>无 Schema，自适应，用户不需要指定特定的低基数列。</p></li><li><p>对用户透明，不需要重新导数据。</p></li><li><p>高性能，业界领先水平。</p></li><li><p>支持场景丰富，兼容大部分 String 处理逻辑。</p></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2025-01-03</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/starrocks/>Starrocks</a>,&nbsp;<a href=/tags/string/>String</a>,&nbsp;<a href=/tags/global/>Global</a>,&nbsp;<a href=/tags/low/>Low</a>,&nbsp;<a href=/tags/cardinality/>Cardinality</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2025/01/segmentfault_com_a_1190000042739883/ class=prev rel=prev title="数据库 - StarRocks 技术内幕 | Join 查询优化"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>数据库 - StarRocks 技术内幕 | Join 查询优化</a>
<a href=/2025/01/clickhouse_com_data-types_lowcardinality/ class=next rel=next title="LowCardinality(T) | ClickHouse Docs">LowCardinality(T) | ClickHouse Docs<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},search:{highlightTag:"em",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>