<!doctype html><html lang=zh-CH><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>LowCardinality(T) | ClickHouse Docs - 杂货铺</title><meta name=Description content="杂七杂八的，随手记录。"><meta property="og:url" content="https://yangyingchao.github.io/clickhouse_com_data-types_lowcardinality/"><meta property="og:site_name" content="杂货铺"><meta property="og:title" content="LowCardinality(T) | ClickHouse Docs"><meta property="og:description" content="Table of Contents 1 LowCardinality(T) 1.1 Syntax​ 1.2 Description​ 1.3 Example​ 2 Use LowCardinality 3 string optimization 3.1 String storage in ClickHouse 3.2 Dictionary encoded strings 3.3 Summary 本文为摘录(或转载)，侵删，原文为： https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality
1 LowCardinality(T) https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality
Changes the internal representation of other data types to be dictionary-encoded.
1.1 Syntax​ 1 LowCardinality(data_type) Parameters:
data_type String, FixedString, Date, DateTime, and numbers excepting Decimal. LowCardinality is not efficient for some data types, see the allow_suspicious_low_cardinality_types setting description. 1.2 Description​ LowCardinality is a superstructure that changes a data storage method and rules of data processing. ClickHouse applies dictionary coding to LowCardinality-columns. Operating with dictionary encoded data significantly increases performance of SELECT queries for many applications."><meta property="og:locale" content="zh_CH"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-03T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-03T00:00:00+00:00"><meta property="og:image" content="https://yangyingchao.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yangyingchao.github.io/logo.png"><meta name=twitter:title content="LowCardinality(T) | ClickHouse Docs"><meta name=twitter:description content="Table of Contents 1 LowCardinality(T) 1.1 Syntax​ 1.2 Description​ 1.3 Example​ 2 Use LowCardinality 3 string optimization 3.1 String storage in ClickHouse 3.2 Dictionary encoded strings 3.3 Summary 本文为摘录(或转载)，侵删，原文为： https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality
1 LowCardinality(T) https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality
Changes the internal representation of other data types to be dictionary-encoded.
1.1 Syntax​ 1 LowCardinality(data_type) Parameters:
data_type String, FixedString, Date, DateTime, and numbers excepting Decimal. LowCardinality is not efficient for some data types, see the allow_suspicious_low_cardinality_types setting description. 1.2 Description​ LowCardinality is a superstructure that changes a data storage method and rules of data processing. ClickHouse applies dictionary coding to LowCardinality-columns. Operating with dictionary encoded data significantly increases performance of SELECT queries for many applications."><meta name=application-name content="杂货铺"><meta name=apple-mobile-web-app-title content="杂货铺"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yangyingchao.github.io/clickhouse_com_data-types_lowcardinality/><link rel=prev href=https://yangyingchao.github.io/my_oschina_net_blog_5566031/><link rel=next href=https://yangyingchao.github.io/%E7%AC%94%E8%AE%B0%E6%B8%85%E6%99%B0%E6%80%9D%E8%80%83-%E8%8B%B1-%E6%B1%A4%E5%A7%86%E6%9F%A5%E7%89%B9%E8%8F%B2%E5%B0%94%E5%BE%B7%E8%B5%B5%E5%86%9B/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"LowCardinality(T) | ClickHouse Docs","inLanguage":"zh-CH","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yangyingchao.github.io\/clickhouse_com_data-types_lowcardinality\/"},"image":["https:\/\/yangyingchao.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","wordcount":1542,"url":"https:\/\/yangyingchao.github.io\/clickhouse_com_data-types_lowcardinality\/","datePublished":"2025-01-03T00:00:00+00:00","dateModified":"2025-01-03T00:00:00+00:00","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/yangyingchao.github.io\/images\/avatar.jpg","width":160,"height":160}},"author":{"@type":"Person","name":"yc"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=杂货铺><span class=header-title-pre><i class='fa-solid fa-house-chimney'></i></span>老杨的杂货铺</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=https://github.com/yangyingchao title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=杂货铺><span class=header-title-pre><i class='fa-solid fa-house-chimney'></i></span>老杨的杂货铺</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=https://github.com/yangyingchao title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">LowCardinality(T) | ClickHouse Docs</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>yc</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-01-03>2025-01-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 1542 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#lowcardinality--t><span class=section-num>1</span> LowCardinality(T)</a><ul><li><a href=#syntax><span class=section-num>1.1</span> Syntax​</a></li><li><a href=#description><span class=section-num>1.2</span> Description​</a></li><li><a href=#example><span class=section-num>1.3</span> Example​</a></li></ul></li><li><a href=#use-lowcardinality><span class=section-num>2</span> Use LowCardinality</a></li><li><a href=#string-optimization><span class=section-num>3</span> string optimization</a><ul><li><a href=#string-storage-in-clickhouse><span class=section-num>3.1</span> String storage in ClickHouse</a><ul><li><a href=#external-dictionaries><span class=section-num>3.1.1</span> External dictionaries</a></li><li><a href=#local-dictionaries><span class=section-num>3.1.2</span> Local dictionaries</a></li></ul></li><li><a href=#dictionary-encoded-strings><span class=section-num>3.2</span> Dictionary encoded strings</a><ul><li><a href=#stringwithdictionary><span class=section-num>3.2.1</span> StringWithDictionary</a></li><li><a href=#lowcardinality--type><span class=section-num>3.2.2</span> LowCardinality(Type)</a></li><li><a href=#queries-optimizations><span class=section-num>3.2.3</span> Queries optimizations</a></li></ul></li><li><a href=#summary><span class=section-num>3.3</span> Summary</a></li></ul></li></ul></nav></div></div><div class=content id=content><div class="ox-hugo-toc toc has-section-numbers"><div class=heading>Table of Contents</div><ul><li><span class=section-num>1</span> <a href=#lowcardinality--t rel>LowCardinality(T)</a><ul><li><span class=section-num>1.1</span> <a href=#syntax rel>Syntax​</a></li><li><span class=section-num>1.2</span> <a href=#description rel>Description​</a></li><li><span class=section-num>1.3</span> <a href=#example rel>Example​</a></li></ul></li><li><span class=section-num>2</span> <a href=#use-lowcardinality rel>Use LowCardinality</a></li><li><span class=section-num>3</span> <a href=#string-optimization rel>string optimization</a><ul><li><span class=section-num>3.1</span> <a href=#string-storage-in-clickhouse rel>String storage in ClickHouse</a></li><li><span class=section-num>3.2</span> <a href=#dictionary-encoded-strings rel>Dictionary encoded strings</a></li><li><span class=section-num>3.3</span> <a href=#summary rel>Summary</a></li></ul></li></ul></div><p>本文为摘录(或转载)，侵删，原文为： <a href=https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality target=_blank rel="noopener noreffer">https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality</a></p><h2 id=lowcardinality--t><span class=section-num>1</span> LowCardinality(T)</h2><p><a href=https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality target=_blank rel="noopener noreffer">https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality</a></p><p>Changes the internal representation of other data types to be dictionary-encoded.</p><h3 id=syntax><span class=section-num>1.1</span> Syntax​</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>LowCardinality</span><span class=p>(</span><span class=n>data_type</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Parameters:</p><ul><li><code>data_type</code><br><ul><li><code>String</code>, <code>FixedString</code>, <code>Date</code>, <code>DateTime</code>, and <code>numbers</code> <strong>excepting</strong> <code>Decimal</code>.</li><li>LowCardinality is not efficient for some data types, see the <code>allow_suspicious_low_cardinality_types</code> setting description.</li></ul></li></ul><h3 id=description><span class=section-num>1.2</span> Description​</h3><p>LowCardinality is a superstructure that changes a data storage method and rules of data processing. ClickHouse
applies dictionary coding to LowCardinality-columns. Operating with dictionary encoded data significantly
increases performance of SELECT queries for many applications.</p><p>LowCardinality 是一种改变数据存储方法和数据处理规则的超级结构。ClickHouse 对 LowCardinality 列应用字典编码。使用字典编码的数据操作显著提高了许多应用程序的 SELECT 查询性能。</p><p>The efficiency of using LowCardinality data type depends on data diversity. If a dictionary contains less than
10,000 distinct values, then ClickHouse mostly shows higher efficiency of data reading and storing. If a
dictionary contains more than 100,000 distinct values, then ClickHouse can perform worse in comparison with
using ordinary data types.</p><p>使用 LowCardinality 数据类型的效率取决于数据的多样性。如果字典包含少于 10,000 个不同的值，那么 ClickHouse 在数据读取和存储方面通常显示出更高的效率。如果字典包含超过 100,000 个不同的值，那么 ClickHouse 的性能可能会比使用普通数据类型差。</p><p>Consider using LowCardinality instead of Enum when working with strings. LowCardinality provides more
flexibility in use and often reveals the same or higher efficiency.</p><p>在处理字符串时，可以考虑使用 <code>LowCardinality</code> 代替 <code>Enum</code> 。 <code>LowCardinality</code> 在使用上提供了更多的灵活性，并且通常展现出相同或更高的效率。</p><h3 id=example><span class=section-num>1.3</span> Example​</h3><p>Create a table with a LowCardinality-column:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>lc_t</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=n>UInt16</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>`</span><span class=n>strings</span><span class=o>`</span><span class=w> </span><span class=n>LowCardinality</span><span class=p>(</span><span class=n>String</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MergeTree</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>id</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=use-lowcardinality><span class=section-num>2</span> Use LowCardinality</h2><p><a href=https://www.tinybird.co/clickhouse/knowledge-base/low-cardinality target=_blank rel="noopener noreffer">https://www.tinybird.co/clickhouse/knowledge-base/low-cardinality</a></p><p>The fewer bytes you read from disk, the faster your query.</p><p>If your column contains a limited set of repeated values (otherwise known as low cardinality, or low
unique-ness) you can optimize the storage of the value of this column by using the LowCardinality type.</p><p>The LowCardinality type encapsulates other data types, creating a dictionary of possible column values. Rather
than storing the raw value many, many times, instead, the column value is a key that points to the raw value in
a dictionary.</p><p>For example, if you had ColumnA with 5 possible unique values:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=s1>&#39;Possible String Value 1&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=s1>&#39;Possible String Value 2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=s1>&#39;Possible String Value 3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=s1>&#39;Possible String Value 4&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=s1>&#39;Possible String Value 5&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Your table may contain 1 million rows, and 300,000 rows have the value &lsquo;Possible String Value 1&rsquo; for ColumnA. If
you use a standard STRING type, you will store the entire value &lsquo;Possible String Value 1&rsquo; 300,000 times, which
uses 25 bytes each time, for a total of 7.5 megabytes.</p><p>To optimize, you can set the column type to LowCardinality. Every unique value will be stored once, in a
dictionary table, for example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Possible String Value 1&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Possible String Value 2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Possible String Value 3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>4</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Possible String Value 4&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>5</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Possible String Value 5&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Now, rather than each of the 300,000 rows storing &lsquo;Possible String Value 1&rsquo; for ColumnA, instead, each of these
rows stores the key 1. When selecting ColumnA, you would retrieve the value for key 1 from the dictionary of
values. Storing 1 as a 4 byte integer, 300,000 times, would result in a total of 1.2 megabytes, or a 6.25x
reduction in bytes.</p><p>Here&rsquo;s an example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>lc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>lc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>lc</span><span class=p>.</span><span class=n>base</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MergeTree</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=p>(</span><span class=n>n1</span><span class=p>,</span><span class=w> </span><span class=n>s1</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>number</span><span class=w> </span><span class=n>n1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s1>&#39;The tattered work gloves speak of the many hours of hard labor he endured throughout his life.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s1>&#39;The glacier came alive as the climbers hiked closer.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s1>&#39;Nancy was proud that she ran a tight shipwreck.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s1>&#39;The ants enjoyed the barbecue more than the family.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s1>&#39;The bug was having an excellent day until he hit the windshield.&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>][(</span><span class=n>rand</span><span class=p>()</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>5</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=n>s1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>numbers</span><span class=p>(</span><span class=mi>2000000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>lc</span><span class=p>.</span><span class=n>lowcard</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MergeTree</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=p>(</span><span class=n>n1</span><span class=p>,</span><span class=w> </span><span class=n>s1</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>n1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>toLowCardinality</span><span class=p>(</span><span class=n>s1</span><span class=p>)</span><span class=w> </span><span class=n>s1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>lc</span><span class=p>.</span><span class=n>base</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>formatReadableSize</span><span class=p>(</span><span class=k>sum</span><span class=p>(</span><span class=n>bytes_on_disk</span><span class=p>)),</span><span class=w> </span><span class=k>count</span><span class=p>()</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>system</span><span class=p>.</span><span class=n>parts</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;base&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>active</span><span class=w> </span><span class=n>FORMAT</span><span class=w> </span><span class=n>PrettyCompact</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>formatReadableSize</span><span class=p>(</span><span class=k>sum</span><span class=p>(</span><span class=n>bytes_on_disk</span><span class=p>)),</span><span class=w> </span><span class=k>count</span><span class=p>()</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>system</span><span class=p>.</span><span class=n>parts</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;lowcard&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>active</span><span class=w> </span><span class=n>FORMAT</span><span class=w> </span><span class=n>PrettyCompact</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>You can already see that the table using the LowCardinality column requires less disk space. You can confirm
this by doing a query and checking the statistics returned by ClickHouse.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>localhost</span><span class=w> </span><span class=p>:)</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>lc</span><span class=p>.</span><span class=n>base</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>n1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>┌─</span><span class=n>n1</span><span class=err>─┬─</span><span class=n>s1</span><span class=err>───────────────────────────────────────────────────┐</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=err>│</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=n>glacier</span><span class=w> </span><span class=n>came</span><span class=w> </span><span class=n>alive</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>climbers</span><span class=w> </span><span class=n>hiked</span><span class=w> </span><span class=n>closer</span><span class=p>.</span><span class=w> </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>└────┴──────────────────────────────────────────────────────┘</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=p>.</span><span class=w> </span><span class=n>Elapsed</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>006</span><span class=w> </span><span class=n>sec</span><span class=p>.</span><span class=w> </span><span class=n>Processed</span><span class=w> </span><span class=mi>8</span><span class=p>.</span><span class=mi>19</span><span class=w> </span><span class=n>thousand</span><span class=w> </span><span class=k>rows</span><span class=p>,</span><span class=w> </span><span class=mi>646</span><span class=p>.</span><span class=mi>57</span><span class=w> </span><span class=n>KB</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>39</span><span class=w> </span><span class=n>million</span><span class=w> </span><span class=k>rows</span><span class=o>/</span><span class=n>s</span><span class=p>.,</span><span class=w> </span><span class=mi>110</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>MB</span><span class=o>/</span><span class=n>s</span><span class=p>.)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>localhost</span><span class=w> </span><span class=p>:)</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>lc</span><span class=p>.</span><span class=n>lowcard</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>n1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>┌─</span><span class=n>n1</span><span class=err>─┬─</span><span class=n>s1</span><span class=err>───────────────────────────────────────────────────┐</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>│</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=err>│</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=n>glacier</span><span class=w> </span><span class=n>came</span><span class=w> </span><span class=n>alive</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>climbers</span><span class=w> </span><span class=n>hiked</span><span class=w> </span><span class=n>closer</span><span class=p>.</span><span class=w> </span><span class=err>│</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>└────┴──────────────────────────────────────────────────────┘</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=p>.</span><span class=w> </span><span class=n>Elapsed</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>004</span><span class=w> </span><span class=n>sec</span><span class=p>.</span><span class=w> </span><span class=n>Processed</span><span class=w> </span><span class=mi>8</span><span class=p>.</span><span class=mi>19</span><span class=w> </span><span class=n>thousand</span><span class=w> </span><span class=k>rows</span><span class=p>,</span><span class=w> </span><span class=mi>74</span><span class=p>.</span><span class=mi>09</span><span class=w> </span><span class=n>KB</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>83</span><span class=w> </span><span class=n>million</span><span class=w> </span><span class=k>rows</span><span class=o>/</span><span class=n>s</span><span class=p>.,</span><span class=w> </span><span class=mi>16</span><span class=p>.</span><span class=mi>51</span><span class=w> </span><span class=n>MB</span><span class=o>/</span><span class=n>s</span><span class=p>.)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>As expected, both queries are reading the same number of rows but the one not using LowCardinality is reading
almost 9 times more data!</p><h2 id=string-optimization><span class=section-num>3</span> string optimization</h2><h3 id=string-storage-in-clickhouse><span class=section-num>3.1</span> String storage in ClickHouse</h3><p>Downloadable from: <a href=https://raw.githubusercontent.com/ClickHouse/clickhouse-presentations/master/meetup19/string_optimization.pdf target=_blank rel="noopener noreffer">https://raw.githubusercontent.com/ClickHouse/clickhouse-presentations/master/meetup19/string_optimization.pdf</a></p><h4 id=external-dictionaries><span class=section-num>3.1.1</span> External dictionaries</h4><p>Store strings in a dictionary, indices in a table</p><ul><li><p>Advantages</p><ul><li>Dynamically changeable set of strings</li><li>No alterations (no problems)</li><li>A variety of dictionary sources</li></ul></li><li><p>Disadvantages</p><ul><li>Bulky (explicit) syntax</li><li>Difficult to optimize</li><li>Delayed updates from external source</li></ul></li></ul><h4 id=local-dictionaries><span class=section-num>3.1.2</span> Local dictionaries</h4><ul><li>Getting rid of global dictionaries<br>No synchronization — no problem</li><li>Store dictionaries locally<ul><li>Per block (in memory)</li><li>Per part (on file system)</li><li>In caches (during query processing)</li></ul></li></ul><h3 id=dictionary-encoded-strings><span class=section-num>3.2</span> Dictionary encoded strings</h3><h4 id=stringwithdictionary><span class=section-num>3.2.1</span> StringWithDictionary</h4><ul><li><p>Datatype for dictionary encoded strings</p><ul><li>Serialization</li><li>Representation in memory</li><li>Data processing</li></ul></li><li><p>Content:</p><ul><li><p>Dictionary</p></li><li><p>Column with positions</p></li><li><p>Reversed index</p><p><a id=figure--fig:screenshot@2025-01-03-20:23:29></a></p><figure><img src=/ox-hugo/7e2dfb78239_screenshot@2025-01-03_20:23:29.png></figure></li></ul></li></ul><h4 id=lowcardinality--type><span class=section-num>3.2.2</span> LowCardinality(Type)</h4><p>Is a general datatype with dictionary encoding</p><ul><li>Is implemented for strings, numbers, Date, DateTime, Nullable.</li><li>StringWithDictionary is an alias for LowCardinality(String).</li><li>Remains for some functions</li></ul><p><a id=figure--fig:screenshot@2025-01-03-20:25:28></a></p><figure><img src=/ox-hugo/7e2dfb78239_screenshot@2025-01-03_20:25:28.png width=800px></figure><h4 id=queries-optimizations><span class=section-num>3.2.3</span> Queries optimizations</h4><ul><li><p>Implemented</p><ul><li>Functions executed on dictionaries if it’s possible</li><li>Calculations are cached for same dictionaries</li><li>GROUP BY optimization</li></ul></li><li><p>To be done<br>Specializations for aggregate functions</p></li></ul><p><a id=figure--fig:screenshot@2025-01-03-20:28:36></a></p><figure><img src=/ox-hugo/7e2dfb78239_screenshot@2025-01-03_20:28:36.png></figure><h3 id=summary><span class=section-num>3.3</span> Summary</h3><ul><li><p>LowCardinality type is available in last release</p><ul><li>Experimental ( <code>set allow_experimental_low_cardinality_type = 1</code> to enable)</li><li>Test performance on your dataset</li><li>Just replace String with StringWithDictionary</li></ul></li><li><p>Goals</p><ul><li>Make datatype with dictionary better than String in all cases</li><li>Implicitly replace String with StringWithDictionary</li></ul></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2025-01-03</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/my_oschina_net_blog_5566031/ class=prev rel=prev title="StarRocks 技术内幕 | 基于全局字典的极速字符串查询"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>StarRocks 技术内幕 | 基于全局字典的极速字符串查询</a>
<a href=/%E7%AC%94%E8%AE%B0%E6%B8%85%E6%99%B0%E6%80%9D%E8%80%83-%E8%8B%B1-%E6%B1%A4%E5%A7%86%E6%9F%A5%E7%89%B9%E8%8F%B2%E5%B0%94%E5%BE%B7%E8%B5%B5%E5%86%9B/ class=next rel=next title="[笔记]清晰思考-(英) 汤姆·查特菲尔德;赵军">[笔记]清晰思考-(英) 汤姆·查特菲尔德;赵军<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>