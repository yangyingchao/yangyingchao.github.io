<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Performance Tip of the Week - 杂货铺</title><meta name=Description content="杂七杂八的，随手记录。"><meta property="og:url" content="https://yangyingchao.github.io/perf-tip-of-week/">
<meta property="og:site_name" content="杂货铺"><meta property="og:title" content="Performance Tip of the Week"><meta property="og:description" content="Table of Contents 1 #9: Optimizations past their prime 1.1 Best practices 1.2 #21: Improving the efficiency of your regular expressions 本文为摘录(或转载)，侵删，原文为： https://abseil.io/fast
1 #9: Optimizations past their prime 1.1 Best practices – 可能的情况下编写清晰、惯用的代码 Prefer writing clear, idiomatic code whenever possible. It is not only easier to read and debug, but in the long run, also easier for the compiler to optimize."><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="og:image" content="https://yangyingchao.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yangyingchao.github.io/logo.png"><meta name=twitter:title content="Performance Tip of the Week"><meta name=twitter:description content="Table of Contents 1 #9: Optimizations past their prime 1.1 Best practices 1.2 #21: Improving the efficiency of your regular expressions 本文为摘录(或转载)，侵删，原文为： https://abseil.io/fast
1 #9: Optimizations past their prime 1.1 Best practices – 可能的情况下编写清晰、惯用的代码 Prefer writing clear, idiomatic code whenever possible. It is not only easier to read and debug, but in the long run, also easier for the compiler to optimize."><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yangyingchao.github.io/perf-tip-of-week/><link rel=prev href=https://yangyingchao.github.io/pgaudit%23readme/><link rel=next href=https://yangyingchao.github.io/performanceof10gbe/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Performance Tip of the Week","inLanguage":"zh-cn","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yangyingchao.github.io\/perf-tip-of-week\/"},"image":["https:\/\/yangyingchao.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","wordcount":827,"url":"https:\/\/yangyingchao.github.io\/perf-tip-of-week\/","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/yangyingchao.github.io\/images\/avatar.png"},"author":{"@type":"Person","name":"yc"},"description":""}</script></head><body data-header-desktop=normal data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=杂货铺><span class=header-title-pre><i class="fa-solid fa-house-chimney"></i></span>老杨的杂货铺</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=https://github.com/yangyingchao/MyNotes title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=杂货铺><span class=header-title-pre><i class="fa-solid fa-house-chimney"></i></span>老杨的杂货铺</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=https://github.com/yangyingchao/MyNotes title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Performance Tip of the Week</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>yc</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=0001-01-01>0001-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 827 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 2 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#h:3349e37f-2402-49e1-a891-9f1849eee5a8><span class=section-num>1</span> #9: Optimizations past their prime</a><ul><li><a href=#h:4353c6fb-3ca3-4d32-b745-11b1fbcb7005><span class=section-num>1.1</span> Best practices</a></li><li><a href=#h:b840fb72-5992-44a3-ad54-225b893a0b03><span class=section-num>1.2</span> #21: Improving the efficiency of your regular expressions</a><ul><li><a href=#h:7505eba6-e079-4ae5-9a54-b62074cc1450><span class=section-num>1.2.1</span> Using regular expressions: a representative sample</a></li><li><a href=#h:eee0025f-e714-4baf-a3fc-f789edc9919b><span class=section-num>1.2.2</span> Writing more efficient code</a></li><li><a href=#h:29739270-c76a-4e80-b8b7-bbafb535e4d2><span class=section-num>1.2.3</span> Writing more efficient regular expressions</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><div class="ox-hugo-toc toc has-section-numbers"><div class=heading>Table of Contents</div><ul><li><span class=section-num>1</span> <a href=#h:3349e37f-2402-49e1-a891-9f1849eee5a8 rel>#9: Optimizations past their prime</a><ul><li><span class=section-num>1.1</span> <a href=#h:4353c6fb-3ca3-4d32-b745-11b1fbcb7005 rel>Best practices</a></li><li><span class=section-num>1.2</span> <a href=#h:b840fb72-5992-44a3-ad54-225b893a0b03 rel>#21: Improving the efficiency of your regular expressions</a></li></ul></li></ul></div><p>本文为摘录(或转载)，侵删，原文为： <a href=https://abseil.io/fast target=_blank rel="noopener noreffer">https://abseil.io/fast</a></p><h2 id=h:3349e37f-2402-49e1-a891-9f1849eee5a8><span class=section-num>1</span> #9: Optimizations past their prime</h2><h3 id=h:4353c6fb-3ca3-4d32-b745-11b1fbcb7005><span class=section-num>1.1</span> Best practices</h3><p>– 可能的情况下编写清晰、惯用的代码<br>Prefer writing clear, idiomatic code whenever possible. It is not only easier to read
and debug, but in the long run, also easier for the compiler to optimize.</p><p>这不仅易于阅读和调试，而且从长远来看，也更容易让编译器进行优化。</p><p>– 倾向使用编译器提供的函数：<br>Whenever you find a low-level performance optimization that requires fancy
bit-twiddling, intrinsics code, or inline assembly, consider first whether this is
something the compiler could do.</p><p>当你发现需要使用复杂的位运算、内嵌代码或内联汇编来进行底层性能优化时，请首先考虑这是否是编译器可以完成的工作。</p><p>– If the code is hot, and the optimization is not something the compiler can be taught
to perform, then: prefer portable code, possibly using hwy to generate efficient and
portable vector code, failing that use intrinsics, failing that use inline asm (this
should be extremely rare). Avoiding inline assembly makes the code more portable
across microarchitectures.</p><p>如果代码运行频繁，并且优化不是编译器可以完成的工作， 有多种可选择的实现时，考虑下面的顺序：</p><ul><li>请优先使用可移植的代码，（可能使用 hwy 生成高效且可移植的向量代码）</li><li>如果不行则使用编译器内部函数 (intrinsics) ，</li><li>最后使用内联汇编（这应该是极为罕见的情况）。<ul><li>避免使用内联汇编可使代码在微体系结构之间更易移植。</li></ul></li></ul><p>– Keep the “naive” code you are replacing.<br>If you are optimizing ComputeFoo, consider keeping the simple implementation in a
REFERENCE_ComputeFoo function. This:</p><ul><li>makes it easy to write a unit-test for the new implementation that ensures the two
functions are equivalent;</li><li>makes it easier to write a microbenchmark; and it makes it easier to revert to the
reference code when (not if) the machine-dependent implementation outlives its
usefulness.</li></ul><p>保留你要替换的“朴素”代码。如果你正在优化 ComputeFoo，考虑将简单的实现保留在
REFERENCE_ComputeFoo 函数中。这使得编写单元测试来确保两个函数是等效的变得容易；它使编写微基准测试变得更容易；它也使得当（而不是如果）与机器相关的实现过时时，更容易恢复到参考代码。</p><p>– Include a microbenchmark with your change.<br>在你的更改中包含一个微基准测试。</p><p>– When designing or changing configuration knobs, ensure that the choices stay optimal
over time. Frequently, overriding the default can lead to suboptimal behavior when the
default changes by pinning things in a worse-than-out-of-the-box state. Designing the
knobs in terms of the outcome rather than specific behavior aspects can make such
overrides easier (or even possible) to evolve.</p><p>在设计或更改配置选项时，请确保选择始终保持最优状态。通常，覆盖默认设置可能会导致次优行为，因为将事物钉在比开箱即用更差的状态。将选项设计为以结果为基础而不是特定行为方面，可以使这些覆盖更易于演变甚至成为可能。</p><h3 id=h:b840fb72-5992-44a3-ad54-225b893a0b03><span class=section-num>1.2</span> #21: Improving the efficiency of your regular expressions</h3><h4 id=h:7505eba6-e079-4ae5-9a54-b62074cc1450><span class=section-num>1.2.1</span> Using regular expressions: a representative sample</h4><h4 id=h:eee0025f-e714-4baf-a3fc-f789edc9919b><span class=section-num>1.2.2</span> Writing more efficient code</h4><h4 id=h:29739270-c76a-4e80-b8b7-bbafb535e4d2><span class=section-num>1.2.3</span> Writing more efficient regular expressions</h4></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 0001-01-01</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/perf-tip-of-week/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/pgaudit%23readme/ class=prev rel=prev title="pgaudit/pgaudit: PostgreSQL Audit Extension"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>pgaudit/pgaudit: PostgreSQL Audit Extension</a>
<a href=/performanceof10gbe/ class=next rel=next title="Performance of 10 G Ethernet Using Commodity Hardware">Performance of 10 G Ethernet Using Commodity Hardware<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app>Giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{giscus:{category:"Announcements",categoryId:"R_kgDON6NYZA",darkTheme:"dark",emitMetadata:"0",inputPosition:"bottom",lang:"zh-CN",lazyLoading:!1,lightTheme:"light",mapping:"pathname",reactionsEnabled:"1",repo:"yangyingchao/giscus",repoId:""}},search:{algoliaAppID:null,algoliaIndex:"index.zh-cn",algoliaSearchKey:null,highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>