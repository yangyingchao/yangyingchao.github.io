<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>cary huang: PostgreSQL’s Planner – Simple Scan Paths vs Plans - 老杨的杂货铺</title><meta name=Description content="杂七杂八的，随手记录。"><meta property="og:url" content="https://yangyingchao.github.io/postgr.es_p_6s9/">
<meta property="og:site_name" content="老杨的杂货铺"><meta property="og:title" content="cary huang:  PostgreSQL’s Planner – Simple Scan Paths vs Plans"><meta property="og:description" content="Table of Contents 1 Introduction 2 Where it all start 3 What happens behind pg_plan_query 4 set_base_rel_sizes() 5 set_base_rel_pathlist() 6 generate_gather_paths 7 get_cheapest_fractional_path and create_plan 8 Examine the Plan 本文为摘录(或转载)，侵删，原文为： https://postgr.es/p/6s9
1 Introduction 当你向 PostgreSQL 发送查询时，通常会经历查询处理的各个阶段，并在最后返回结果。这些阶段被称为："><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-25T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-25T00:00:00+00:00"><meta property="article:tag" content="Pg"><meta property="article:tag" content="Planner"><meta property="og:image" content="https://yangyingchao.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yangyingchao.github.io/logo.png"><meta name=twitter:title content="cary huang:  PostgreSQL’s Planner – Simple Scan Paths vs Plans"><meta name=twitter:description content="Table of Contents 1 Introduction 2 Where it all start 3 What happens behind pg_plan_query 4 set_base_rel_sizes() 5 set_base_rel_pathlist() 6 generate_gather_paths 7 get_cheapest_fractional_path and create_plan 8 Examine the Plan 本文为摘录(或转载)，侵删，原文为： https://postgr.es/p/6s9
1 Introduction 当你向 PostgreSQL 发送查询时，通常会经历查询处理的各个阶段，并在最后返回结果。这些阶段被称为："><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yangyingchao.github.io/postgr.es_p_6s9/><link rel=prev href=https://yangyingchao.github.io/postgr.es_p_6oe/><link rel=next href=https://yangyingchao.github.io/superuser.com_77504_how-to-strip-audio-streams-from-an-mkv-file/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"cary huang:  PostgreSQL’s Planner – Simple Scan Paths vs Plans","inLanguage":"zh-cn","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yangyingchao.github.io\/postgr.es_p_6s9\/"},"image":["https:\/\/yangyingchao.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"pg, planner","wordcount":2198,"url":"https:\/\/yangyingchao.github.io\/postgr.es_p_6s9\/","datePublished":"2024-03-25T00:00:00+00:00","dateModified":"2024-03-25T00:00:00+00:00","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/yangyingchao.github.io\/images\/avatar.png"},"author":{"@type":"Person","name":"yc"},"description":""}</script></head><body data-header-desktop=normal data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=老杨的杂货铺><span class=header-title-pre><i class="fa-solid fa-house-chimney"></i></span>老杨的杂货铺</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=https://github.com/yangyingchao/MyNotes title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=老杨的杂货铺><span class=header-title-pre><i class="fa-solid fa-house-chimney"></i></span>老杨的杂货铺</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=https://github.com/yangyingchao/MyNotes title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">cary huang: PostgreSQL’s Planner – Simple Scan Paths vs Plans</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>yc</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2024-03-25>2024-03-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 2198 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 5 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#introduction><span class=section-num>1</span> Introduction</a></li><li><a href=#where-it-all-start><span class=section-num>2</span> Where it all start</a></li><li><a href=#what-happens-behind-pg-plan-query><span class=section-num>3</span> What happens behind <code>pg_plan_query</code></a></li><li><a href=#set-base-rel-sizes><span class=section-num>4</span> set_base_rel_sizes()</a></li><li><a href=#set-base-rel-pathlist><span class=section-num>5</span> set_base_rel_pathlist()</a></li><li><a href=#generate-gather-paths><span class=section-num>6</span> generate_gather_paths</a></li><li><a href=#get-cheapest-fractional-path-and-create-plan><span class=section-num>7</span> get_cheapest_fractional_path and create_plan</a></li><li><a href=#examine-the-plan><span class=section-num>8</span> Examine the Plan</a></li></ul></nav></div></div><div class=content id=content><div class="ox-hugo-toc toc has-section-numbers"><div class=heading>Table of Contents</div><ul><li><span class=section-num>1</span> <a href=#introduction rel>Introduction</a></li><li><span class=section-num>2</span> <a href=#where-it-all-start rel>Where it all start</a></li><li><span class=section-num>3</span> <a href=#what-happens-behind-pg-plan-query rel>What happens behind <code>pg_plan_query</code></a></li><li><span class=section-num>4</span> <a href=#set-base-rel-sizes rel>set_base_rel_sizes()</a></li><li><span class=section-num>5</span> <a href=#set-base-rel-pathlist rel>set_base_rel_pathlist()</a></li><li><span class=section-num>6</span> <a href=#generate-gather-paths rel>generate_gather_paths</a></li><li><span class=section-num>7</span> <a href=#get-cheapest-fractional-path-and-create-plan rel>get_cheapest_fractional_path and create_plan</a></li><li><span class=section-num>8</span> <a href=#examine-the-plan rel>Examine the Plan</a></li></ul></div><p>本文为摘录(或转载)，侵删，原文为： <a href=https://postgr.es/p/6s9 target=_blank rel="noopener noreffer">https://postgr.es/p/6s9</a></p><h2 id=introduction><span class=section-num>1</span> Introduction</h2><p>当你向 PostgreSQL 发送查询时，通常会经历查询处理的各个阶段，并在最后返回结果。这些阶段被称为：</p><ul><li>解析（Parse）</li><li>分析（Analyze）</li><li>重写（Rewrite）</li><li>规划（Plan）</li><li>执行（Execute）</li></ul><p>在这篇博客中，我们将只关注“规划”阶段或者“规划器”模块，因为这或许是最有趣或者最复杂的阶段。
我将分享我对规划器模块的理解，探究其内部运作以处理一个简单的顺序扫描。这将基于 PostgreSQL
16。</p><p>虽然规划器的目标非常简单，即从一系列可选路径中识别最快的“路径”，并据此制订一个“方案”，
以便“执行器”模块在下一个阶段执行。然而， <strong>要识别最快的“路径”正是使规划器变得复杂的原因</strong> 。</p><h2 id=where-it-all-start><span class=section-num>2</span> Where it all start</h2><p>在 postgres.c 中的 <code>exec_simple_query()</code> 函数是查询处理阶段发生的地方。
我们将关注它落在 <code>pg_plan_query()</code> 之后发生了什么。
我只会提到它将会落在的重要函数。</p><figure><img src=/ox-hugo/highgo-training-Copy-of-Page-12.drawio-1.png width=800px></figure><h2 id=what-happens-behind-pg-plan-query><span class=section-num>3</span> What happens behind <code>pg_plan_query</code></h2><p>实际上会发生很多事情，比如：</p><ul><li><p>标识子查询、分区表、外键表、连接等等</p></li><li><p>借助表访问方法估计所有涉及表的大小</p></li><li><p>确定完成查询的所有可能路径</p><ul><li>顺序扫描、索引扫描、TID 扫描、并行工作线程等</li></ul></li><li><p>在所有路径中找到最佳路径，通常是成本最低的</p></li><li><p>制定一个执行计划。</p></li></ul><p>对于单个表的简单 SELECT 查询，不涉及任何连接或子查询，pg_plan_query 下的近似调用栈如下可
视化描述：</p><p>这个甘特图被极大地简化，但展示了规划模块的若干关键要素。如果字太小，你可能需要下载图片以
得到更好的视觉效果。接下来将详细解释带有蓝色星标记的区块。</p><figure><img src=/ox-hugo/highgo-training-Page-20.drawio-4.png width=800px></figure><h2 id=set-base-rel-sizes><span class=section-num>4</span> set_base_rel_sizes()</h2><p>:NOTER_DOCUMENT: <a href=https://postgr.es/p/6s9 target=_blank rel="noopener noreffer">https://postgr.es/p/6s9</a>
:NOTER_OPEN: eww
:NOTER_PAGE: 2076
:END:</p><p>正如其名称所示，这是用于估算与所有关系（表、视图、索引等）有关的大小的主要入口点。 大小
包括预估的行数（元组）和列数。 这些信息通常必须从“堆访问方法”中获取，其中它将可以访问“缓
冲区管理器”和“存储管理器”以提供大小的估算。</p><p>总大小将是所有涉及表的大小之和。 这对后续的“成本估算”阶段非常重要。</p><h2 id=set-base-rel-pathlist><span class=section-num>5</span> set_base_rel_pathlist()</h2><p>对于简单表的简单顺序扫描，程序会最终到达这里。其他更复杂的查询将使用不同的路径构建技术。
有关其他路径构建技术，请参考 allpaths.c 中的“set_rel_pathlist()”。</p><p>目前，默认添加了 4 个扫描路径：</p><ul><li><p>顺序扫描<br>逐个顺序扫描所有内容</p></li><li><p>部分顺序扫描<br></p><ul><li><p>这是以“部分”添加的，因为它将由“gather”节点聚合，该节点在下一阶段考虑。
这本质上意味着是一个并行顺序扫描</p></li><li><p>仅当关系或查询是并行安全时才添加</p></li></ul></li><li><p>索引扫描<br>如果表有索引，可以考虑作为潜在路径</p></li><li><p>tid 扫描<br>如果查询包含范围限制子句（WHERE ctid > &lsquo;(1,30)&rsquo; AND ctid &lt; &lsquo;(30,5)&rsquo;），则 tid 扫描可能
是一个选项</p></li></ul><p>所有这些都需要一些成本，这些成本是由元组或页面的数量以及每个元组/页面的成本因素来估算的，
如下配置:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cfg data-lang=cfg><span class=line><span class=cl><span class=c1># - Planner Cost Constants -</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>seq_page_cost</span> <span class=o>=</span> <span class=s>1.0                    # measured on an arbitrary scale</span>
</span></span><span class=line><span class=cl><span class=na>random_page_cost</span> <span class=o>=</span> <span class=s>4.0                 # same scale as above</span>
</span></span><span class=line><span class=cl><span class=na>cpu_tuple_cost</span> <span class=o>=</span> <span class=s>0.01                  # same scale as above</span>
</span></span><span class=line><span class=cl><span class=na>cpu_index_tuple_cost</span> <span class=o>=</span> <span class=s>0.005           # same scale as above</span>
</span></span><span class=line><span class=cl><span class=na>cpu_operator_cost</span> <span class=o>=</span> <span class=s>0.0025             # same scale as above</span>
</span></span><span class=line><span class=cl><span class=na>parallel_setup_cost</span> <span class=o>=</span> <span class=s>1000.0           # same scale as above</span>
</span></span><span class=line><span class=cl><span class=na>parallel_tuple_cost</span> <span class=o>=</span> <span class=s>0.1              # same scale as above</span>
</span></span></code></pre></td></tr></table></div></div><p>不同的路径方法具有不同的成本计算，它们会调用以下方法来计算“启动成本”和“运行成本”：</p><ul><li>cost_seqscan()</li><li>cost_indexscan()</li><li>cost_tidscan()</li></ul><p>你可以在选择最理想路径制定计划时从根本上影响规划者的决策。例如，如果你希望规划者更频繁地
使用并行扫描，你可以考虑降低每个并行扫描元组的成本，通过调小"parallel_tuple_cost"，比如
设为 0.001。</p><p>&ldquo;add_path&rdquo; 函数被调用以将路径添加到潜在路径列表中，但请记住规划器的路径构建机制确实有一
种排出机制。这意味着如果我们打算添加一条明显优于已添加的其他路径的路径，它可能会删除所有
现有路径并接受新路径。同样，如果要添加的路径明显更差，则根本不会被添加。</p><p>如果规划程序认为并行顺序扫描是安全的，则会调用“add_partial_path”。这种顺序扫描是
“partial”（部分的），因为需要对其进行收集和聚合，以形成最终结果，从而导致额外的成本，因
此并行性可能并不总是理想的。以下是一个经验法则：</p><ul><li>如果 PostgreSQL 需要扫描大量数据，但我们只需要其中的少量数据，则并行性可以帮助</li><li>如果 PostgreSQL 需要扫描大量数据，而其中大部分是我们需要的数据，则并行性可能会更慢。</li></ul><h2 id=generate-gather-paths><span class=section-num>6</span> generate_gather_paths</h2><p>如果已经添加了一些部分路径，通常是顺序扫描子路径，则调用此例程。这个例程添加了一个名为
“gather”的新路径类型，其中包含一个名为“顺序扫描”的子路径。gather 路径必须考虑每个子路径的
成本，以及从并行工作程序获取元组和在最终形式中对数据进行聚合的成本。</p><h2 id=get-cheapest-fractional-path-and-create-plan><span class=section-num>7</span> get_cheapest_fractional_path and create_plan</h2><p>一旦所有可能的路径候选项都被添加完毕，将调用此函数来选择最便宜的路径，即总成本最低的路径。
然后选择的路径将被输入到“create_plan”中，其中路径（以及子路径（如果有））将会递归地创建，
并制定成执行器能理解和执行的最终计划结构。</p><h2 id=examine-the-plan><span class=section-num>8</span> Examine the Plan</h2><p>我们可以在查询之前使用 EXPLAIN ANALYZE 来检查规划器选择的最便宜的计划及其成本细节。以下
示例是一个包含 1 个名为“gather”的主计划及 1 个局部计划“sequential scan”的查询计划，该计划有 2
个 worker。您可以通过箭头（->）来判断它代表一个子路径。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>explain</span><span class=w> </span><span class=k>analyze</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>500000</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>&lt;</span><span class=mi>600000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                          </span><span class=n>QUERY</span><span class=w> </span><span class=n>PLAN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>Gather</span><span class=w>  </span><span class=p>(</span><span class=n>cost</span><span class=o>=</span><span class=mi>1000</span><span class=p>.</span><span class=mi>00</span><span class=p>..</span><span class=mi>329718</span><span class=p>.</span><span class=mi>40</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>112390</span><span class=w> </span><span class=n>width</span><span class=o>=</span><span class=mi>36</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>actual</span><span class=w> </span><span class=n>time</span><span class=o>=</span><span class=mi>62</span><span class=p>.</span><span class=mi>362</span><span class=p>..</span><span class=mi>5106</span><span class=p>.</span><span class=mi>295</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>99999</span><span class=w> </span><span class=n>loops</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>Workers</span><span class=w> </span><span class=n>Planned</span><span class=p>:</span><span class=w> </span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>Workers</span><span class=w> </span><span class=n>Launched</span><span class=p>:</span><span class=w> </span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>-&gt;</span><span class=w>  </span><span class=n>Parallel</span><span class=w> </span><span class=n>Seq</span><span class=w> </span><span class=n>Scan</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>test</span><span class=w>  </span><span class=p>(</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=p>..</span><span class=mi>317479</span><span class=p>.</span><span class=mi>40</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>46829</span><span class=w> </span><span class=n>width</span><span class=o>=</span><span class=mi>36</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>actual</span><span class=w> </span><span class=n>time</span><span class=o>=</span><span class=mi>58</span><span class=p>.</span><span class=mi>020</span><span class=p>..</span><span class=mi>3416</span><span class=p>.</span><span class=mi>544</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>33333</span><span class=w> </span><span class=n>loops</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=n>Filter</span><span class=p>:</span><span class=w> </span><span class=p>((</span><span class=n>a</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>500000</span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>a</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>600000</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=k>Rows</span><span class=w> </span><span class=n>Removed</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Filter</span><span class=p>:</span><span class=w> </span><span class=mi>13300000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Planning</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>489</span><span class=w> </span><span class=n>ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Execution</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>5110</span><span class=p>.</span><span class=mi>030</span><span class=w> </span><span class=n>ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>8</span><span class=w> </span><span class=k>rows</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果规划器选择了顺序扫描主路径而没有选择任何子路径，查询计划会如下所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>postgres</span><span class=o>=#</span><span class=w> </span><span class=k>explain</span><span class=w> </span><span class=k>analyze</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>500000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                          </span><span class=n>QUERY</span><span class=w> </span><span class=n>PLAN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>Seq</span><span class=w> </span><span class=n>Scan</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>test</span><span class=w>  </span><span class=p>(</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=p>..</span><span class=mi>676994</span><span class=p>.</span><span class=mi>40</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>39571047</span><span class=w> </span><span class=n>width</span><span class=o>=</span><span class=mi>6</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>actual</span><span class=w> </span><span class=n>time</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>011</span><span class=p>..</span><span class=mi>7852</span><span class=p>.</span><span class=mi>896</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>39500000</span><span class=w> </span><span class=n>loops</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>Filter</span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>a</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>500000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>Rows</span><span class=w> </span><span class=n>Removed</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Filter</span><span class=p>:</span><span class=w> </span><span class=mi>500000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Planning</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>.</span><span class=mi>115</span><span class=w> </span><span class=n>ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Execution</span><span class=w> </span><span class=n>Time</span><span class=p>:</span><span class=w> </span><span class=mi>9318</span><span class=p>.</span><span class=mi>773</span><span class=w> </span><span class=n>ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=mi>5</span><span class=w> </span><span class=k>rows</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2024-03-25</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/postgr.es_p_6s9/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/pg/>Pg</a>,&nbsp;<a href=/tags/planner/>Planner</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/postgr.es_p_6oe/ class=prev rel=prev title="100x Faster Query in Aurora Postgres with a lower random_page_cost"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>100x Faster Query in Aurora Postgres with a lower random_page_cost</a>
<a href=/superuser.com_77504_how-to-strip-audio-streams-from-an-mkv-file/ class=next rel=next title="video - How to strip audio streams from an MKV file? - Super User">video - How to strip audio streams from an MKV file? - Super User<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app>Giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{giscus:{category:"Announcements",categoryId:"R_kgDON6NYZA",darkTheme:"dark",emitMetadata:"0",inputPosition:"bottom",lang:"zh-CN",lazyLoading:!1,lightTheme:"light",mapping:"pathname",reactionsEnabled:"1",repo:"yangyingchao/giscus",repoId:""}},search:{algoliaAppID:null,algoliaIndex:"index.zh-cn",algoliaSearchKey:null,highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>