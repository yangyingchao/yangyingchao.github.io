<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>LowCardinality(T) | ClickHouse Docs | MyNotes</title><meta name=keywords content><meta name=description content="1 LowCardinality(T) 1.1 Syntax​ 1.2 Description​ 1.3 Example​ 2 Use LowCardinality 3 string optimization 3.1 String storage in ClickHouse 3.2 Dictionary encoded strings 3.3 Summary 本文为摘录，原文为： https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality 1 LowCardinality(T) https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality Changes the internal representation of other data"><meta name=author content="Yang, Ying-chao"><link rel=canonical href=https://yangyingchao.github.io/posts/clickhouse_com_data-types_lowcardinality/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://yangyingchao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://yangyingchao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://yangyingchao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://yangyingchao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://yangyingchao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="LowCardinality(T) | ClickHouse Docs"><meta property="og:description" content="1 LowCardinality(T) 1.1 Syntax​ 1.2 Description​ 1.3 Example​ 2 Use LowCardinality 3 string optimization 3.1 String storage in ClickHouse 3.2 Dictionary encoded strings 3.3 Summary 本文为摘录，原文为： https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality 1 LowCardinality(T) https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality Changes the internal representation of other data"><meta property="og:type" content="article"><meta property="og:url" content="https://yangyingchao.github.io/posts/clickhouse_com_data-types_lowcardinality/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-03T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-03T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="LowCardinality(T) | ClickHouse Docs"><meta name=twitter:description content="1 LowCardinality(T) 1.1 Syntax​ 1.2 Description​ 1.3 Example​ 2 Use LowCardinality 3 string optimization 3.1 String storage in ClickHouse 3.2 Dictionary encoded strings 3.3 Summary 本文为摘录，原文为： https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality 1 LowCardinality(T) https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality Changes the internal representation of other data"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yangyingchao.github.io/posts/"},{"@type":"ListItem","position":2,"name":"LowCardinality(T) | ClickHouse Docs","item":"https://yangyingchao.github.io/posts/clickhouse_com_data-types_lowcardinality/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"LowCardinality(T) | ClickHouse Docs","name":"LowCardinality(T) | ClickHouse Docs","description":"1 LowCardinality(T) 1.1 Syntax​ 1.2 Description​ 1.3 Example​ 2 Use LowCardinality 3 string optimization 3.1 String storage in ClickHouse 3.2 Dictionary encoded strings 3.3 Summary 本文为摘录，原文为： https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality 1 LowCardinality(T) https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality Changes the internal representation of other data","keywords":[],"articleBody":" 1 LowCardinality(T) 1.1 Syntax​ 1.2 Description​ 1.3 Example​ 2 Use LowCardinality 3 string optimization 3.1 String storage in ClickHouse 3.2 Dictionary encoded strings 3.3 Summary 本文为摘录，原文为： https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality\n1 LowCardinality(T) https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality\nChanges the internal representation of other data types to be dictionary-encoded.\n1.1 Syntax​ LowCardinality(data_type) Parameters:\ndata_type String, FixedString, Date, DateTime, and numbers excepting Decimal. LowCardinality is not efficient for some data types, see the allow_suspicious_low_cardinality_types setting description. 1.2 Description​ LowCardinality is a superstructure that changes a data storage method and rules of data processing. ClickHouse applies dictionary coding to LowCardinality-columns. Operating with dictionary encoded data significantly increases performance of SELECT queries for many applications.\nLowCardinality 是一种改变数据存储方法和数据处理规则的超级结构。ClickHouse 对 LowCardinality 列应用字典编码。使用 字典编码的数据操作显著提高了许多应用程序的 SELECT 查询性能。\nThe efficiency of using LowCardinality data type depends on data diversity. If a dictionary contains less than 10,000 distinct values, then ClickHouse mostly shows higher efficiency of data reading and storing. If a dictionary contains more than 100,000 distinct values, then ClickHouse can perform worse in comparison with using ordinary data types.\n使用 LowCardinality 数据类型的效率取决于数据的多样性。如果字典包含少于 10,000 个不同的值，那么 ClickHouse 在数据 读取和存储方面通常显示出更高的效率。如果字典包含超过 100,000 个不同的值，那么 ClickHouse 的性能可能会比使用普通 数据类型差。\nConsider using LowCardinality instead of Enum when working with strings. LowCardinality provides more flexibility in use and often reveals the same or higher efficiency.\n在处理字符串时，可以考虑使用 LowCardinality 代替 Enum 。 LowCardinality 在使用上提供了更多的灵活性，并且通 常展现出相同或更高的效率。\n1.3 Example​ Create a table with a LowCardinality-column:\nCREATE TABLE lc_t ( `id` UInt16, `strings` LowCardinality(String) ) ENGINE = MergeTree() ORDER BY id 2 Use LowCardinality https://www.tinybird.co/clickhouse/knowledge-base/low-cardinality\nThe fewer bytes you read from disk, the faster your query.\nIf your column contains a limited set of repeated values (otherwise known as low cardinality, or low unique-ness) you can optimize the storage of the value of this column by using the LowCardinality type.\nThe LowCardinality type encapsulates other data types, creating a dictionary of possible column values. Rather than storing the raw value many, many times, instead, the column value is a key that points to the raw value in a dictionary.\nFor example, if you had ColumnA with 5 possible unique values:\n'Possible String Value 1' 'Possible String Value 2' 'Possible String Value 3' 'Possible String Value 4' 'Possible String Value 5' Your table may contain 1 million rows, and 300,000 rows have the value ‘Possible String Value 1’ for ColumnA. If you use a standard STRING type, you will store the entire value ‘Possible String Value 1’ 300,000 times, which uses 25 bytes each time, for a total of 7.5 megabytes.\nTo optimize, you can set the column type to LowCardinality. Every unique value will be stored once, in a dictionary table, for example:\n1: 'Possible String Value 1' 2: 'Possible String Value 2' 3: 'Possible String Value 3' 4: 'Possible String Value 4' 5: 'Possible String Value 5' Now, rather than each of the 300,000 rows storing ‘Possible String Value 1’ for ColumnA, instead, each of these rows stores the key 1. When selecting ColumnA, you would retrieve the value for key 1 from the dictionary of values. Storing 1 as a 4 byte integer, 300,000 times, would result in a total of 1.2 megabytes, or a 6.25x reduction in bytes.\nHere’s an example:\nDROP DATABASE IF EXISTS lc; CREATE DATABASE lc; CREATE TABLE lc.base ENGINE = MergeTree ORDER BY (n1, s1) AS SELECT number n1, [ 'The tattered work gloves speak of the many hours of hard labor he endured throughout his life.', 'The glacier came alive as the climbers hiked closer.', 'Nancy was proud that she ran a tight shipwreck.', 'The ants enjoyed the barbecue more than the family.', 'The bug was having an excellent day until he hit the windshield.' ][(rand() % 5) + 1] s1 FROM numbers(2000000); CREATE TABLE lc.lowcard ENGINE = MergeTree ORDER BY (n1, s1) AS SELECT n1, toLowCardinality(s1) s1 FROM lc.base; select formatReadableSize(sum(bytes_on_disk)), count() from system.parts WHERE table = 'base' and active FORMAT PrettyCompact; select formatReadableSize(sum(bytes_on_disk)), count() from system.parts WHERE table = 'lowcard' and active FORMAT PrettyCompact; You can already see that the table using the LowCardinality column requires less disk space. You can confirm this by doing a query and checking the statistics returned by ClickHouse.\nlocalhost :) SELECT * FROM lc.base WHERE n1 = 10 ; ┌─n1─┬─s1───────────────────────────────────────────────────┐ │ 10 │ The glacier came alive as the climbers hiked closer. │ └────┴──────────────────────────────────────────────────────┘ 1 rows in set. Elapsed: 0.006 sec. Processed 8.19 thousand rows, 646.57 KB (1.39 million rows/s., 110.00 MB/s.) localhost :) SELECT * FROM lc.lowcard WHERE n1 = 10 ; ┌─n1─┬─s1───────────────────────────────────────────────────┐ │ 10 │ The glacier came alive as the climbers hiked closer. │ └────┴──────────────────────────────────────────────────────┘ 1 rows in set. Elapsed: 0.004 sec. Processed 8.19 thousand rows, 74.09 KB (1.83 million rows/s., 16.51 MB/s.) As expected, both queries are reading the same number of rows but the one not using LowCardinality is reading almost 9 times more data!\n3 string optimization 3.1 String storage in ClickHouse Downloadable from: https://raw.githubusercontent.com/ClickHouse/clickhouse-presentations/master/meetup19/string_optimization.pdf\n3.1.1 External dictionaries Store strings in a dictionary, indices in a table\nAdvantages\nDynamically changeable set of strings No alterations (no problems) A variety of dictionary sources Disadvantages\nBulky (explicit) syntax Difficult to optimize Delayed updates from external source 3.1.2 Local dictionaries Getting rid of global dictionaries No synchronization — no problem Store dictionaries locally Per block (in memory) Per part (on file system) In caches (during query processing) 3.2 Dictionary encoded strings 3.2.1 StringWithDictionary Datatype for dictionary encoded strings\nSerialization Representation in memory Data processing Content:\nDictionary\nColumn with positions\nReversed index\n3.2.2 LowCardinality(Type) Is a general datatype with dictionary encoding\nIs implemented for strings, numbers, Date, DateTime, Nullable. StringWithDictionary is an alias for LowCardinality(String). Remains for some functions 3.2.3 Queries optimizations Implemented\nFunctions executed on dictionaries if it’s possible Calculations are cached for same dictionaries GROUP BY optimization To be done Specializations for aggregate functions\n3.3 Summary LowCardinality type is available in last release\nExperimental ( set allow_experimental_low_cardinality_type = 1 to enable) Test performance on your dataset Just replace String with StringWithDictionary Goals\nMake datatype with dictionary better than String in all cases Implicitly replace String with StringWithDictionary ","wordCount":"1477","inLanguage":"zh-cn","datePublished":"2025-01-03T00:00:00Z","dateModified":"2025-01-03T00:00:00Z","author":[{"@type":"Person","name":"Yang"},{"@type":"Person","name":"Ying-chao"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://yangyingchao.github.io/posts/clickhouse_com_data-types_lowcardinality/"},"publisher":{"@type":"Organization","name":"MyNotes","logo":{"@type":"ImageObject","url":"https://yangyingchao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yangyingchao.github.io accesskey=h title="MyNotes (Alt + H)">MyNotes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yangyingchao.github.io/ title=Home><span>Home</span></a></li><li><a href=https://yangyingchao.github.io/posts/ title=Archives><span>Archives</span></a></li><li><a href=https://yangyingchao.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://yangyingchao.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://yangyingchao.github.io/contact/ title="Contact me"><span>Contact me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">LowCardinality(T) | ClickHouse Docs</h1><div class=post-meta><span title='2025-01-03 00:00:00 +0000 UTC'>January 3, 2025</span>&nbsp;·&nbsp;Yang, Ying-chao</div></header><div class=post-content><ul><li>1 <a href=#lowcardinality--t>LowCardinality(T)</a><ul><li>1.1 <a href=#syntax>Syntax​</a></li><li>1.2 <a href=#description>Description​</a></li><li>1.3 <a href=#example>Example​</a></li></ul></li><li>2 <a href=#use-lowcardinality>Use LowCardinality</a></li><li>3 <a href=#string-optimization>string optimization</a><ul><li>3.1 <a href=#string-storage-in-clickhouse>String storage in ClickHouse</a></li><li>3.2 <a href=#dictionary-encoded-strings>Dictionary encoded strings</a></li><li>3.3 <a href=#summary>Summary</a></li></ul></li></ul><p>本文为摘录，原文为： <a href=https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality>https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality</a></p><h2 id=lowcardinality--t>1 LowCardinality(T)<a hidden class=anchor aria-hidden=true href=#lowcardinality--t>#</a></h2><p><a href=https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality>https://clickhouse.com/docs/en/sql-reference/data-types/lowcardinality</a></p><p>Changes the internal representation of other data types to be dictionary-encoded.</p><h3 id=syntax>1.1 Syntax​<a hidden class=anchor aria-hidden=true href=#syntax>#</a></h3><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>LowCardinality(data_type)
</span></span></code></pre></div><p>Parameters:</p><ul><li><code>data_type</code><ul><li><code>String</code>, <code>FixedString</code>, <code>Date</code>, <code>DateTime</code>, and <code>numbers</code> <strong>excepting</strong> <code>Decimal</code>.</li><li>LowCardinality is not efficient for some data types, see the <code>allow_suspicious_low_cardinality_types</code> setting description.</li></ul></li></ul><h3 id=description>1.2 Description​<a hidden class=anchor aria-hidden=true href=#description>#</a></h3><p>LowCardinality is a superstructure that changes a data storage method and rules of data processing. ClickHouse
applies dictionary coding to LowCardinality-columns. Operating with dictionary encoded data significantly
increases performance of SELECT queries for many applications.</p><p>LowCardinality 是一种改变数据存储方法和数据处理规则的超级结构。ClickHouse 对 LowCardinality 列应用字典编码。使用
字典编码的数据操作显著提高了许多应用程序的 SELECT 查询性能。</p><p>The efficiency of using LowCardinality data type depends on data diversity. If a dictionary contains less than
10,000 distinct values, then ClickHouse mostly shows higher efficiency of data reading and storing. If a
dictionary contains more than 100,000 distinct values, then ClickHouse can perform worse in comparison with
using ordinary data types.</p><p>使用 LowCardinality 数据类型的效率取决于数据的多样性。如果字典包含少于 10,000 个不同的值，那么 ClickHouse 在数据
读取和存储方面通常显示出更高的效率。如果字典包含超过 100,000 个不同的值，那么 ClickHouse 的性能可能会比使用普通
数据类型差。</p><p>Consider using LowCardinality instead of Enum when working with strings. LowCardinality provides more
flexibility in use and often reveals the same or higher efficiency.</p><p>在处理字符串时，可以考虑使用 <code>LowCardinality</code> 代替 <code>Enum</code> 。 <code>LowCardinality</code> 在使用上提供了更多的灵活性，并且通
常展现出相同或更高的效率。</p><h3 id=example>1.3 Example​<a hidden class=anchor aria-hidden=true href=#example>#</a></h3><p>Create a table with a LowCardinality-column:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#719e07>CREATE</span> <span style=color:#719e07>TABLE</span> lc_t
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    <span style=color:#719e07>`</span>id<span style=color:#719e07>`</span> UInt16,
</span></span><span style=display:flex><span>    <span style=color:#719e07>`</span>strings<span style=color:#719e07>`</span> LowCardinality(String)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>ENGINE <span style=color:#719e07>=</span> MergeTree()
</span></span><span style=display:flex><span><span style=color:#719e07>ORDER</span> <span style=color:#719e07>BY</span> id
</span></span></code></pre></div><h2 id=use-lowcardinality>2 Use LowCardinality<a hidden class=anchor aria-hidden=true href=#use-lowcardinality>#</a></h2><p><a href=https://www.tinybird.co/clickhouse/knowledge-base/low-cardinality>https://www.tinybird.co/clickhouse/knowledge-base/low-cardinality</a></p><p>The fewer bytes you read from disk, the faster your query.</p><p>If your column contains a limited set of repeated values (otherwise known as low cardinality, or low
unique-ness) you can optimize the storage of the value of this column by using the LowCardinality type.</p><p>The LowCardinality type encapsulates other data types, creating a dictionary of possible column values. Rather
than storing the raw value many, many times, instead, the column value is a key that points to the raw value in
a dictionary.</p><p>For example, if you had ColumnA with 5 possible unique values:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#2aa198>&#39;Possible String Value 1&#39;</span>
</span></span><span style=display:flex><span><span style=color:#2aa198>&#39;Possible String Value 2&#39;</span>
</span></span><span style=display:flex><span><span style=color:#2aa198>&#39;Possible String Value 3&#39;</span>
</span></span><span style=display:flex><span><span style=color:#2aa198>&#39;Possible String Value 4&#39;</span>
</span></span><span style=display:flex><span><span style=color:#2aa198>&#39;Possible String Value 5&#39;</span>
</span></span></code></pre></div><p>Your table may contain 1 million rows, and 300,000 rows have the value &lsquo;Possible String Value 1&rsquo; for ColumnA. If
you use a standard STRING type, you will store the entire value &lsquo;Possible String Value 1&rsquo; 300,000 times, which
uses 25 bytes each time, for a total of 7.5 megabytes.</p><p>To optimize, you can set the column type to LowCardinality. Every unique value will be stored once, in a
dictionary table, for example:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#2aa198>1</span>: <span style=color:#2aa198>&#39;Possible String Value 1&#39;</span>
</span></span><span style=display:flex><span><span style=color:#2aa198>2</span>: <span style=color:#2aa198>&#39;Possible String Value 2&#39;</span>
</span></span><span style=display:flex><span><span style=color:#2aa198>3</span>: <span style=color:#2aa198>&#39;Possible String Value 3&#39;</span>
</span></span><span style=display:flex><span><span style=color:#2aa198>4</span>: <span style=color:#2aa198>&#39;Possible String Value 4&#39;</span>
</span></span><span style=display:flex><span><span style=color:#2aa198>5</span>: <span style=color:#2aa198>&#39;Possible String Value 5&#39;</span>
</span></span></code></pre></div><p>Now, rather than each of the 300,000 rows storing &lsquo;Possible String Value 1&rsquo; for ColumnA, instead, each of these
rows stores the key 1. When selecting ColumnA, you would retrieve the value for key 1 from the dictionary of
values. Storing 1 as a 4 byte integer, 300,000 times, would result in a total of 1.2 megabytes, or a 6.25x
reduction in bytes.</p><p>Here&rsquo;s an example:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#719e07>DROP</span> <span style=color:#719e07>DATABASE</span> <span style=color:#719e07>IF</span> <span style=color:#719e07>EXISTS</span> lc;
</span></span><span style=display:flex><span><span style=color:#719e07>CREATE</span> <span style=color:#719e07>DATABASE</span> lc;
</span></span><span style=display:flex><span><span style=color:#719e07>CREATE</span> <span style=color:#719e07>TABLE</span> lc.base
</span></span><span style=display:flex><span>ENGINE <span style=color:#719e07>=</span> MergeTree
</span></span><span style=display:flex><span><span style=color:#719e07>ORDER</span> <span style=color:#719e07>BY</span> (n1, s1) <span style=color:#719e07>AS</span>
</span></span><span style=display:flex><span><span style=color:#719e07>SELECT</span>
</span></span><span style=display:flex><span>    <span style=color:#b58900>number</span> n1,
</span></span><span style=display:flex><span>    [
</span></span><span style=display:flex><span>        <span style=color:#2aa198>&#39;The tattered work gloves speak of the many hours of hard labor he endured throughout his life.&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#2aa198>&#39;The glacier came alive as the climbers hiked closer.&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#2aa198>&#39;Nancy was proud that she ran a tight shipwreck.&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#2aa198>&#39;The ants enjoyed the barbecue more than the family.&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#2aa198>&#39;The bug was having an excellent day until he hit the windshield.&#39;</span>
</span></span><span style=display:flex><span>    ][(rand() <span style=color:#719e07>%</span> <span style=color:#2aa198>5</span>) <span style=color:#719e07>+</span> <span style=color:#2aa198>1</span>] s1
</span></span><span style=display:flex><span><span style=color:#719e07>FROM</span> numbers(<span style=color:#2aa198>2000000</span>);
</span></span><span style=display:flex><span><span style=color:#719e07>CREATE</span> <span style=color:#719e07>TABLE</span> lc.lowcard
</span></span><span style=display:flex><span>ENGINE <span style=color:#719e07>=</span> MergeTree
</span></span><span style=display:flex><span><span style=color:#719e07>ORDER</span> <span style=color:#719e07>BY</span> (n1, s1) <span style=color:#719e07>AS</span>
</span></span><span style=display:flex><span><span style=color:#719e07>SELECT</span>
</span></span><span style=display:flex><span>    n1,
</span></span><span style=display:flex><span>    toLowCardinality(s1) s1
</span></span><span style=display:flex><span><span style=color:#719e07>FROM</span> lc.base;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#719e07>select</span> formatReadableSize(<span style=color:#719e07>sum</span>(bytes_on_disk)), <span style=color:#719e07>count</span>() <span style=color:#719e07>from</span> <span style=color:#719e07>system</span>.parts <span style=color:#719e07>WHERE</span> <span style=color:#719e07>table</span> <span style=color:#719e07>=</span> <span style=color:#2aa198>&#39;base&#39;</span> <span style=color:#719e07>and</span> active FORMAT PrettyCompact;
</span></span><span style=display:flex><span><span style=color:#719e07>select</span> formatReadableSize(<span style=color:#719e07>sum</span>(bytes_on_disk)), <span style=color:#719e07>count</span>() <span style=color:#719e07>from</span> <span style=color:#719e07>system</span>.parts <span style=color:#719e07>WHERE</span> <span style=color:#719e07>table</span> <span style=color:#719e07>=</span> <span style=color:#2aa198>&#39;lowcard&#39;</span> <span style=color:#719e07>and</span> active FORMAT PrettyCompact;
</span></span></code></pre></div><p>You can already see that the table using the LowCardinality column requires less disk space. You can confirm
this by doing a query and checking the statistics returned by ClickHouse.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>localhost :) <span style=color:#719e07>SELECT</span> <span style=color:#719e07>*</span> <span style=color:#719e07>FROM</span> lc.base <span style=color:#719e07>WHERE</span> n1 <span style=color:#719e07>=</span> <span style=color:#2aa198>10</span> ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>┌─n1─┬─s1───────────────────────────────────────────────────┐
</span></span><span style=display:flex><span>│ <span style=color:#2aa198>10</span> │ The glacier came alive <span style=color:#719e07>as</span> the climbers hiked closer. │
</span></span><span style=display:flex><span>└────┴──────────────────────────────────────────────────────┘
</span></span><span style=display:flex><span><span style=color:#2aa198>1</span> <span style=color:#719e07>rows</span> <span style=color:#719e07>in</span> <span style=color:#719e07>set</span>. Elapsed: <span style=color:#2aa198>0</span>.<span style=color:#2aa198>006</span> sec. Processed <span style=color:#2aa198>8</span>.<span style=color:#2aa198>19</span> thousand <span style=color:#719e07>rows</span>, <span style=color:#2aa198>646</span>.<span style=color:#2aa198>57</span> KB (<span style=color:#2aa198>1</span>.<span style=color:#2aa198>39</span> million <span style=color:#719e07>rows</span><span style=color:#719e07>/</span>s., <span style=color:#2aa198>110</span>.<span style=color:#2aa198>00</span> MB<span style=color:#719e07>/</span>s.)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>localhost :) <span style=color:#719e07>SELECT</span> <span style=color:#719e07>*</span> <span style=color:#719e07>FROM</span> lc.lowcard <span style=color:#719e07>WHERE</span> n1 <span style=color:#719e07>=</span> <span style=color:#2aa198>10</span> ;
</span></span><span style=display:flex><span>┌─n1─┬─s1───────────────────────────────────────────────────┐
</span></span><span style=display:flex><span>│ <span style=color:#2aa198>10</span> │ The glacier came alive <span style=color:#719e07>as</span> the climbers hiked closer. │
</span></span><span style=display:flex><span>└────┴──────────────────────────────────────────────────────┘
</span></span><span style=display:flex><span><span style=color:#2aa198>1</span> <span style=color:#719e07>rows</span> <span style=color:#719e07>in</span> <span style=color:#719e07>set</span>. Elapsed: <span style=color:#2aa198>0</span>.<span style=color:#2aa198>004</span> sec. Processed <span style=color:#2aa198>8</span>.<span style=color:#2aa198>19</span> thousand <span style=color:#719e07>rows</span>, <span style=color:#2aa198>74</span>.<span style=color:#2aa198>09</span> KB (<span style=color:#2aa198>1</span>.<span style=color:#2aa198>83</span> million <span style=color:#719e07>rows</span><span style=color:#719e07>/</span>s., <span style=color:#2aa198>16</span>.<span style=color:#2aa198>51</span> MB<span style=color:#719e07>/</span>s.)
</span></span></code></pre></div><p>As expected, both queries are reading the same number of rows but the one not using LowCardinality is reading
almost 9 times more data!</p><h2 id=string-optimization>3 string optimization<a hidden class=anchor aria-hidden=true href=#string-optimization>#</a></h2><h3 id=string-storage-in-clickhouse>3.1 String storage in ClickHouse<a hidden class=anchor aria-hidden=true href=#string-storage-in-clickhouse>#</a></h3><p>Downloadable from: <a href=https://raw.githubusercontent.com/ClickHouse/clickhouse-presentations/master/meetup19/string_optimization.pdf>https://raw.githubusercontent.com/ClickHouse/clickhouse-presentations/master/meetup19/string_optimization.pdf</a></p><h4 id=external-dictionaries>3.1.1 External dictionaries<a hidden class=anchor aria-hidden=true href=#external-dictionaries>#</a></h4><p>Store strings in a dictionary, indices in a table</p><ul><li><p>Advantages</p><ul><li>Dynamically changeable set of strings</li><li>No alterations (no problems)</li><li>A variety of dictionary sources</li></ul></li><li><p>Disadvantages</p><ul><li>Bulky (explicit) syntax</li><li>Difficult to optimize</li><li>Delayed updates from external source</li></ul></li></ul><h4 id=local-dictionaries>3.1.2 Local dictionaries<a hidden class=anchor aria-hidden=true href=#local-dictionaries>#</a></h4><ul><li>Getting rid of global dictionaries
No synchronization — no problem</li><li>Store dictionaries locally<ul><li>Per block (in memory)</li><li>Per part (on file system)</li><li>In caches (during query processing)</li></ul></li></ul><h3 id=dictionary-encoded-strings>3.2 Dictionary encoded strings<a hidden class=anchor aria-hidden=true href=#dictionary-encoded-strings>#</a></h3><h4 id=stringwithdictionary>3.2.1 StringWithDictionary<a hidden class=anchor aria-hidden=true href=#stringwithdictionary>#</a></h4><ul><li><p>Datatype for dictionary encoded strings</p><ul><li>Serialization</li><li>Representation in memory</li><li>Data processing</li></ul></li><li><p>Content:</p><ul><li><p>Dictionary</p></li><li><p>Column with positions</p></li><li><p>Reversed index</p><p></p><figure><img loading=lazy src=/ox-hugo/7e2dfb78239_screenshot@2025-01-03_20:23:29.png></figure></li></ul></li></ul><h4 id=lowcardinality--type>3.2.2 LowCardinality(Type)<a hidden class=anchor aria-hidden=true href=#lowcardinality--type>#</a></h4><p>Is a general datatype with dictionary encoding</p><ul><li>Is implemented for strings, numbers, Date, DateTime, Nullable.</li><li>StringWithDictionary is an alias for LowCardinality(String).</li><li>Remains for some functions</li></ul><p></p><figure><img loading=lazy src=/ox-hugo/7e2dfb78239_screenshot@2025-01-03_20:25:28.png width=800px></figure><h4 id=queries-optimizations>3.2.3 Queries optimizations<a hidden class=anchor aria-hidden=true href=#queries-optimizations>#</a></h4><ul><li><p>Implemented</p><ul><li>Functions executed on dictionaries if it’s possible</li><li>Calculations are cached for same dictionaries</li><li>GROUP BY optimization</li></ul></li><li><p>To be done
Specializations for aggregate functions</p></li></ul><p></p><figure><img loading=lazy src=/ox-hugo/7e2dfb78239_screenshot@2025-01-03_20:28:36.png></figure><h3 id=summary>3.3 Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h3><ul><li><p>LowCardinality type is available in last release</p><ul><li>Experimental ( <code>set allow_experimental_low_cardinality_type = 1</code> to enable)</li><li>Test performance on your dataset</li><li>Just replace String with StringWithDictionary</li></ul></li><li><p>Goals</p><ul><li>Make datatype with dictionary better than String in all cases</li><li>Implicitly replace String with StringWithDictionary</li></ul></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer><script src=https://giscus.app/client.js data-repo=yangyingchao/giscus data-repo-id=R_kgDON6NYZA data-category=Announcements data-category-id=DIC_kwDON6NYZM4CnANs data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://yangyingchao.github.io>MyNotes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>