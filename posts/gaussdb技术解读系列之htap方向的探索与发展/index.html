<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>GaussDB技术解读系列之HTAP方向的探索与发展 | MyNotes</title><meta name=keywords content="guassdb,htap"><meta name=description content="1 什么是 HTAP？ 2 HTAP 架构模式有哪些？ 2.1 IN-Memory Store 模式 2.2 主备架构模式 2.3 IN-Memory Computing 模式 2.4 主列存+增量行存模式 3 思考 3.1 GaussDB 对 HTAP 的思考 4 GaussDB 在 HTAP 上的创新 1 什么是 H"><meta name=author content><link rel=canonical href=https://yangyingchao.github.io/posts/gaussdb%E6%8A%80%E6%9C%AF%E8%A7%A3%E8%AF%BB%E7%B3%BB%E5%88%97%E4%B9%8Bhtap%E6%96%B9%E5%90%91%E7%9A%84%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%8F%91%E5%B1%95/><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://yangyingchao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://yangyingchao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://yangyingchao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://yangyingchao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://yangyingchao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="GaussDB技术解读系列之HTAP方向的探索与发展"><meta property="og:description" content="1 什么是 HTAP？ 2 HTAP 架构模式有哪些？ 2.1 IN-Memory Store 模式 2.2 主备架构模式 2.3 IN-Memory Computing 模式 2.4 主列存+增量行存模式 3 思考 3.1 GaussDB 对 HTAP 的思考 4 GaussDB 在 HTAP 上的创新 1 什么是 H"><meta property="og:type" content="article"><meta property="og:url" content="https://yangyingchao.github.io/posts/gaussdb%E6%8A%80%E6%9C%AF%E8%A7%A3%E8%AF%BB%E7%B3%BB%E5%88%97%E4%B9%8Bhtap%E6%96%B9%E5%90%91%E7%9A%84%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%8F%91%E5%B1%95/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-22T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="GaussDB技术解读系列之HTAP方向的探索与发展"><meta name=twitter:description content="1 什么是 HTAP？ 2 HTAP 架构模式有哪些？ 2.1 IN-Memory Store 模式 2.2 主备架构模式 2.3 IN-Memory Computing 模式 2.4 主列存+增量行存模式 3 思考 3.1 GaussDB 对 HTAP 的思考 4 GaussDB 在 HTAP 上的创新 1 什么是 H"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://yangyingchao.github.io/posts/"},{"@type":"ListItem","position":3,"name":"GaussDB技术解读系列之HTAP方向的探索与发展","item":"https://yangyingchao.github.io/posts/gaussdb%E6%8A%80%E6%9C%AF%E8%A7%A3%E8%AF%BB%E7%B3%BB%E5%88%97%E4%B9%8Bhtap%E6%96%B9%E5%90%91%E7%9A%84%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%8F%91%E5%B1%95/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"GaussDB技术解读系列之HTAP方向的探索与发展","name":"GaussDB技术解读系列之HTAP方向的探索与发展","description":"1 什么是 HTAP？ 2 HTAP 架构模式有哪些？ 2.1 IN-Memory Store 模式 2.2 主备架构模式 2.3 IN-Memory Computing 模式 2.4 主列存+增量行存模式 3 思考 3.1 GaussDB 对 HTAP 的思考 4 GaussDB 在 HTAP 上的创新 1 什么是 H","keywords":["guassdb","htap"],"articleBody":" 1 什么是 HTAP？ 2 HTAP 架构模式有哪些？ 2.1 IN-Memory Store 模式 2.2 主备架构模式 2.3 IN-Memory Computing 模式 2.4 主列存+增量行存模式 3 思考 3.1 GaussDB 对 HTAP 的思考 4 GaussDB 在 HTAP 上的创新 1 什么是 HTAP？ TP 和 AP 的特点\nTP 一般是做交易型的业务， 它的数据量通常来说比较小，在 GB~TB 的范围内， 它要求低时延、高吞吐，同时对高可用、故障恢复要求较高。 AP 一般用于对历史数 据做分析，根据数据分析的结论为企业的商业决策提供一些支撑，因此 AP 对时延和吞吐的要求没有 那么高， 主要面对数据量大、查询偏复杂的场景。 2010 年左右，业内开始考虑把 TP 和 AP 同时融合到同一个数据库里，通过这种 方式提升数据库处理数据的能力\n总结了 HTAP 有两个关键特点:\n一个是采用 In-Memory 的架构。 我们可以看到，无论是老牌的数据库厂商，还是新兴的数据库厂商，都不约而同采用 In-Memory 的架构来实现 HTAP。\n另外一个是实时。 我们当前的架构主要是，交易型的业务在行存的数据库上，分析型的业务在列存的数仓上，中间 通过 ETL 工具传输数据。这个架构的问题是，它的数据新鲜度不够好，比如说先前在互联网应用 方面，我们经常做一些个性化的用户推荐，在给用户推荐感兴趣的商品时，会在登录时对它进行 一个用户画像，根据用户画像的结果推荐产品，这是一种实时分析的能力。另外就是防诈骗系统， 需要实时的响应，实时分析这笔交易是否为诈骗交易。这种实时性的特点，对 HTAP 方案提出了新 的要求。我们当前的 HTAP 架构主要应对实时 AP 分析的能力，实时 AP 对性能上有一些影响，它随着 数据新鲜度，也就是实时性要求变高，数据库的性能会有一些下降。\n2 HTAP 架构模式有哪些？ 2.1 IN-Memory Store 模式 这种模式在同一个集群内对行存引擎做了增强，用空间换时间，在内存里保存一份列存数据，我们 可以把他看成是一个列存索引，这种架构下的数据新鲜度比较好，行存和列存的数据完全同步，在 行存和列存中间，会有一个 Delta 表记录增删改操作带来的增量数据，后台有进程定期将 Delta 表里 的数据 Merge 到列存引擎。\n但是这种架构的扩展性一般，资源的隔离性不佳，能够支撑的列存的数据 量也是有限度的，\n因此这种架构适用于 TP 为主，实时 AP 为辅的业务模型。\n2.2 主备架构模式 这种模式下主机上是行存模式，应对 TP 业务负载，在只读的备机上是列存模式，应对 AP 的业务负载， 主备之间通过物理复制或逻辑复制的方式实现数据同步。\n这种方式的扩展性、资源隔离性都比较好，\n但是数据的新鲜度取决于主备之间的数据传输模式，如果采用同步复制，则主备的数据新鲜度较好， 但是对主机的事务吞吐量会有所影响；如果采用异步复制模式，则主备的数据新鲜度取决于数据的 延迟。\n2.3 IN-Memory Computing 模式 这种模式将列式内存引擎和数据库对接，由数据库负责 TP 业务，列式内存引擎负责 AP 业务。\n由于其部署在云上，因此有很好的计算弹性，数据库和列式内存引擎之间通过逻辑复制同步数据，数 据的延迟小于 100ms，能够较好的兼顾数据新鲜度和性能之间的平衡。\n2.4 主列存+增量行存模式 通过主列存+增量行存的方式既能够较好的支撑 TP 业务，也能够应对 AP 业务，在 TP/AP 性能上做了一 些均衡。其中增量行存可以看做是 delta 表，应对 TP 中的增删改操作，保证增删改操作的性能和 TP 系 统基本一致，同时通过主列存引擎对 AP 业务进行加速，当然在做 AP 业务时，会同时访问增量数据和 列存数据，达成数据的一致性。\n3 思考 我们有了这么多模式之后，可以思考两个问题。一个是到底什么样的架构才是真正的 HTAP 架构？我 个人的观点是没有适合的定义，因为在不同的业务场景下，TP 和 AP 的占比不一样，包括周边各种环 境，各种因素都不同，每个用户的选择也会不一样。包括我们在 HTAP 研发过程中接触到很多用户， 每个用户都提出很多要求，像 Orcale 这种架构更适合重 TP、轻 AP 的场景，而 HANA 这种架构更多是做 偏 AP 分析型的应用。如果我们以 TP、AP 业务占比做一个横轴的话，每个架构在上面都有一个独立的 坐标点。\n另外一个问题，我们当前这些 HTAP 的主流架构能不能取代以前的那种 TP+ETL+AP 的架构？从目前看， 如果我们把 HTAP 定义为实时 TP+实时 AP，实际上是不能取代的，因为 TP+ETL+AP 这种架构，AP 的数据 量远远大于当前 HTAP 的主流架构所能支撑的 AP 数据量。\n3.1 GaussDB 对 HTAP 的思考 在 GaussDB HTAP 开发过程中，我们总结了以下实现 HTAP 架构需要关注的核心技术：\n3.1.1 第一，透明路由。 它之所以成为关键的原因是因为增加了客户的易用性，提升了 HTAP 产品的商用价 值。这里面有两个观点，一个是如果 HTAP 基于行存和冗余列存这种方式，需要判断哪些数据被冗余 到列存里面来，因此提供一种自动化的方法根据业务特点来选择加载列存数据，并对用户透明就非 常有意义。另外，TP 业务要路由到行存引擎，AP 业务路由到列存引擎，目前大部分架构还需要通过 Hint 的方式来实现业务分流，如果借助优化器的代价系统、以及当前的 AI4DB 技术，能够更大程度的 提供业务分流的准确性，从而对用户透明，提高系统的易用性。\n3.1.2 第二，性能提升。 我们把 TP 和 AP 融合起来比较困难的关键原因，主要是因为 AP 查询的复杂度比较高。 如果是一个纯 TP 数据库，一些常规执行优化技术，比如说并行、编译执行、向量化执行，TP 上虽然 也有，但实际上很难有大的作为，因为 TP 要求的是低时延、高吞吐，这种情况下这些技术都有自己 的启动代价，这些启动代价会对 TP 的性能产生很大的影响。在 TP 上，如果我们把 HTAP 里面的 AP 融入 进来，这些技术就能大有可为，我们在这些技术的基础上对复杂查询进行加速，可以很好地支撑我 们现在的性能，支撑我们的 HTAP。\n3.1.3 第三，数据新鲜度。 我们多次讨论实时性的问题，不同的数据新鲜度最后带来的就是我们不同的架 构，有 In-Memory 的，有主备的，也有基于增量表技术的，都会带来不同的数据新鲜度。在这种数据 新鲜度下，我们怎么保证数据新鲜度高，而且性能又好。在这些方面我们需要更多的思考，来保证 我们 HTAP 架构能够具备更多应对用户的能力。\n3.1.4 第四，资源隔离。 我们看到有的架构，比如说用户对 TP 性能要求比较高，要求你在引入实时 AP 的同 时，不能影响 TP 的能力和性能。也有用户提出对整体的能力要求，对硬件没有什么诉求，如果有需 要可以增加硬件。不同的用户有不同的要求，我们在面对这样的用户时，需要在资源隔离和数据新 鲜度，以及性能的提升方面做好权衡。\n4 GaussDB 在 HTAP 上的创新 GaussDB 在现有基础上对 HTAP 进行改造，并实现以下几个方面的提升：\n– 性能提升数十倍。GaussDB 已经实现向量化、并行、编译技术，性能提升 10+倍，一些场景下还有 更高的性能提升。最近我们基于 HTAP 做了更深度的挖掘和优化，比如基于降低内存拷贝、延迟读 等技术，向量化的扫描算子最新的数据又提升了大概 30 倍左右。\n– 100%的透明路由。我们既有基于 Hint 手工指定的方式，还有基于规则、基于代价、基于 AI 的透明 路由技术。我们在基于代价的透明度路由方面，做了向量化优化技术；基于 AI 的透明路由方面， 我们通过轻量的 AI 技术可以真正应用到商业版中，通过这些技术，TP、AP 分流的准确率目前表现 还是不错的。\n– 100%的数据新鲜度。我们实现了在同 Server 内的列式的内存引擎，数据同步方面支持实时同步、 在线同步、定期同步，保证了 TP 上的数据和 IUD 操作带来的数据修改及时同步到引擎上，可以实现 100%的数据新鲜度。\n– 100%的资源隔离。如果用户更关注的是 100%的资源隔离，我们也提供了基于主备复制 HTAP 模式， 通过读写分离，把 TP 业务放到主机上，AP 业务放到备机上，实现资源的隔离。\n目前，GaussDB 既有基于同 Server 的实时的 HTAP，也有基于主备技术的准实时的 HTAP，同时在透明路 由的加持下，能够准确的把业务分流同步分到实时的 HTAP 上，达成在性能、资源隔离、数据新鲜度 方面有一个均衡的结果。\n","wordCount":"2991","inLanguage":"zh-cn","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-08-22T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://yangyingchao.github.io/posts/gaussdb%E6%8A%80%E6%9C%AF%E8%A7%A3%E8%AF%BB%E7%B3%BB%E5%88%97%E4%B9%8Bhtap%E6%96%B9%E5%90%91%E7%9A%84%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%8F%91%E5%B1%95/"},"publisher":{"@type":"Organization","name":"MyNotes","logo":{"@type":"ImageObject","url":"https://yangyingchao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yangyingchao.github.io accesskey=h title="MyNotes (Alt + H)">MyNotes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>GaussDB技术解读系列之HTAP方向的探索与发展</h1><div class=post-meta><span title='2023-08-22 00:00:00 +0000 UTC'>August 22, 2023</span></div></header><div class=post-content><ul><li>1 <a href=#h:5b21d35f-99bb-4d99-81d3-91a62417244e>什么是 HTAP？</a></li><li>2 <a href=#h:cf283d8d-9c7c-4a64-8102-e08cef75921f>HTAP 架构模式有哪些？</a><ul><li>2.1 <a href=#h:e50df0a5-f62c-4e9e-b225-236d99e8e439>IN-Memory Store 模式</a></li><li>2.2 <a href=#h:d30833b8-2140-4152-9ea7-e8f70bf3e8d1>主备架构模式</a></li><li>2.3 <a href=#h:b651f209-8a4b-4faf-859e-e20feef34570>IN-Memory Computing 模式</a></li><li>2.4 <a href=#h:5b382630-9cd4-4651-a0b5-3184be1119fd>主列存+增量行存模式</a></li></ul></li><li>3 <a href=#h:05ee8b35-d261-4b7b-9f39-ba3c95542278>思考</a><ul><li>3.1 <a href=#h:19e241a9-66b3-446d-a2a7-cffe857e87d0>GaussDB 对 HTAP 的思考</a></li></ul></li><li>4 <a href=#h:fe8fe64e-4da2-4de3-8d67-65b166c68b46>GaussDB 在 HTAP 上的创新</a></li></ul><h2 id=h:5b21d35f-99bb-4d99-81d3-91a62417244e>1 什么是 HTAP？<a hidden class=anchor aria-hidden=true href=#h:5b21d35f-99bb-4d99-81d3-91a62417244e>#</a></h2><ul><li><p>TP 和 AP 的特点</p><ul><li>TP 一般是做交易型的业务，<ul><li>它的数据量通常来说比较小，在 GB~TB 的范围内，</li><li>它要求低时延、高吞吐，同时对高可用、故障恢复要求较高。</li></ul></li><li>AP 一般用于对历史数 据做分析，根据数据分析的结论为企业的商业决策提供一些支撑，因此<ul><li>AP 对时延和吞吐的要求没有 那么高，</li><li>主要面对数据量大、查询偏复杂的场景。</li></ul></li></ul></li><li><p>2010 年左右，业内开始考虑把 TP 和 AP 同时融合到同一个数据库里，通过这种 方式提升数据库处理数据的能力</p></li><li><p>总结了 HTAP 有两个关键特点:</p><ul><li><p>一个是采用 In-Memory 的架构。
我们可以看到，无论是老牌的数据库厂商，还是新兴的数据库厂商，都不约而同采用 In-Memory 的架构来实现 HTAP。</p></li><li><p>另外一个是实时。
我们当前的架构主要是，交易型的业务在行存的数据库上，分析型的业务在列存的数仓上，中间
通过 ETL 工具传输数据。这个架构的问题是，它的数据新鲜度不够好，比如说先前在互联网应用
方面，我们经常做一些个性化的用户推荐，在给用户推荐感兴趣的商品时，会在登录时对它进行
一个用户画像，根据用户画像的结果推荐产品，这是一种实时分析的能力。另外就是防诈骗系统，
需要实时的响应，实时分析这笔交易是否为诈骗交易。这种实时性的特点，对 HTAP 方案提出了新
的要求。我们当前的 HTAP 架构主要应对实时 AP 分析的能力，实时 AP 对性能上有一些影响，它随着
数据新鲜度，也就是实时性要求变高，数据库的性能会有一些下降。</p></li></ul></li></ul><h2 id=h:cf283d8d-9c7c-4a64-8102-e08cef75921f>2 HTAP 架构模式有哪些？<a hidden class=anchor aria-hidden=true href=#h:cf283d8d-9c7c-4a64-8102-e08cef75921f>#</a></h2><h3 id=h:e50df0a5-f62c-4e9e-b225-236d99e8e439>2.1 IN-Memory Store 模式<a hidden class=anchor aria-hidden=true href=#h:e50df0a5-f62c-4e9e-b225-236d99e8e439>#</a></h3><p>这种模式在同一个集群内对行存引擎做了增强，用空间换时间，在内存里保存一份列存数据，我们
可以把他看成是一个列存索引，这种架构下的数据新鲜度比较好，行存和列存的数据完全同步，在
行存和列存中间，会有一个 Delta 表记录增删改操作带来的增量数据，后台有进程定期将 Delta 表里
的数据 Merge 到列存引擎。</p><p>但是这种架构的扩展性一般，资源的隔离性不佳，能够支撑的列存的数据
量也是有限度的，</p><p>因此这种架构适用于 TP 为主，实时 AP 为辅的业务模型。</p><h3 id=h:d30833b8-2140-4152-9ea7-e8f70bf3e8d1>2.2 主备架构模式<a hidden class=anchor aria-hidden=true href=#h:d30833b8-2140-4152-9ea7-e8f70bf3e8d1>#</a></h3><p>这种模式下主机上是行存模式，应对 TP 业务负载，在只读的备机上是列存模式，应对 AP 的业务负载，
主备之间通过物理复制或逻辑复制的方式实现数据同步。</p><p>这种方式的扩展性、资源隔离性都比较好，</p><p>但是数据的新鲜度取决于主备之间的数据传输模式，如果采用同步复制，则主备的数据新鲜度较好，
但是对主机的事务吞吐量会有所影响；如果采用异步复制模式，则主备的数据新鲜度取决于数据的
延迟。</p><h3 id=h:b651f209-8a4b-4faf-859e-e20feef34570>2.3 IN-Memory Computing 模式<a hidden class=anchor aria-hidden=true href=#h:b651f209-8a4b-4faf-859e-e20feef34570>#</a></h3><p>这种模式将列式内存引擎和数据库对接，由数据库负责 TP 业务，列式内存引擎负责 AP 业务。</p><p>由于其部署在云上，因此有很好的计算弹性，数据库和列式内存引擎之间通过逻辑复制同步数据，数
据的延迟小于 100ms，能够较好的兼顾数据新鲜度和性能之间的平衡。</p><h3 id=h:5b382630-9cd4-4651-a0b5-3184be1119fd>2.4 主列存+增量行存模式<a hidden class=anchor aria-hidden=true href=#h:5b382630-9cd4-4651-a0b5-3184be1119fd>#</a></h3><p>通过主列存+增量行存的方式既能够较好的支撑 TP 业务，也能够应对 AP 业务，在 TP/AP 性能上做了一
些均衡。其中增量行存可以看做是 delta 表，应对 TP 中的增删改操作，保证增删改操作的性能和 TP 系
统基本一致，同时通过主列存引擎对 AP 业务进行加速，当然在做 AP 业务时，会同时访问增量数据和
列存数据，达成数据的一致性。</p><h2 id=h:05ee8b35-d261-4b7b-9f39-ba3c95542278>3 思考<a hidden class=anchor aria-hidden=true href=#h:05ee8b35-d261-4b7b-9f39-ba3c95542278>#</a></h2><p>我们有了这么多模式之后，可以思考两个问题。一个是到底什么样的架构才是真正的 HTAP 架构？我
个人的观点是没有适合的定义，因为在不同的业务场景下，TP 和 AP 的占比不一样，包括周边各种环
境，各种因素都不同，每个用户的选择也会不一样。包括我们在 HTAP 研发过程中接触到很多用户，
每个用户都提出很多要求，像 Orcale 这种架构更适合重 TP、轻 AP 的场景，而 HANA 这种架构更多是做
偏 AP 分析型的应用。如果我们以 TP、AP 业务占比做一个横轴的话，每个架构在上面都有一个独立的
坐标点。</p><p>另外一个问题，我们当前这些 HTAP 的主流架构能不能取代以前的那种 TP+ETL+AP 的架构？从目前看，
如果我们把 HTAP 定义为实时 TP+实时 AP，实际上是不能取代的，因为 TP+ETL+AP 这种架构，AP 的数据
量远远大于当前 HTAP 的主流架构所能支撑的 AP 数据量。</p><h3 id=h:19e241a9-66b3-446d-a2a7-cffe857e87d0>3.1 GaussDB 对 HTAP 的思考<a hidden class=anchor aria-hidden=true href=#h:19e241a9-66b3-446d-a2a7-cffe857e87d0>#</a></h3><p>在 GaussDB HTAP 开发过程中，我们总结了以下实现 HTAP 架构需要关注的核心技术：</p><h4 id=h:c056ed23-a65f-452b-b06f-50a9a8f0d208>3.1.1 第一，透明路由。<a hidden class=anchor aria-hidden=true href=#h:c056ed23-a65f-452b-b06f-50a9a8f0d208>#</a></h4><p>它之所以成为关键的原因是因为增加了客户的易用性，提升了 HTAP 产品的商用价
值。这里面有两个观点，一个是如果 HTAP 基于行存和冗余列存这种方式，需要判断哪些数据被冗余
到列存里面来，因此提供一种自动化的方法根据业务特点来选择加载列存数据，并对用户透明就非
常有意义。另外，TP 业务要路由到行存引擎，AP 业务路由到列存引擎，目前大部分架构还需要通过
Hint 的方式来实现业务分流，如果借助优化器的代价系统、以及当前的 AI4DB 技术，能够更大程度的
提供业务分流的准确性，从而对用户透明，提高系统的易用性。</p><h4 id=h:75291a2a-b23f-47a6-be53-b01d51c65ae8>3.1.2 第二，性能提升。<a hidden class=anchor aria-hidden=true href=#h:75291a2a-b23f-47a6-be53-b01d51c65ae8>#</a></h4><p>我们把 TP 和 AP 融合起来比较困难的关键原因，主要是因为 AP 查询的复杂度比较高。
如果是一个纯 TP 数据库，一些常规执行优化技术，比如说并行、编译执行、向量化执行，TP 上虽然
也有，但实际上很难有大的作为，因为 TP 要求的是低时延、高吞吐，这种情况下这些技术都有自己
的启动代价，这些启动代价会对 TP 的性能产生很大的影响。在 TP 上，如果我们把 HTAP 里面的 AP 融入
进来，这些技术就能大有可为，我们在这些技术的基础上对复杂查询进行加速，可以很好地支撑我
们现在的性能，支撑我们的 HTAP。</p><h4 id=h:9fd3135d-6b8c-4b0d-9295-868f6e83a601>3.1.3 第三，数据新鲜度。<a hidden class=anchor aria-hidden=true href=#h:9fd3135d-6b8c-4b0d-9295-868f6e83a601>#</a></h4><p>我们多次讨论实时性的问题，不同的数据新鲜度最后带来的就是我们不同的架
构，有 In-Memory 的，有主备的，也有基于增量表技术的，都会带来不同的数据新鲜度。在这种数据
新鲜度下，我们怎么保证数据新鲜度高，而且性能又好。在这些方面我们需要更多的思考，来保证
我们 HTAP 架构能够具备更多应对用户的能力。</p><h4 id=h:8449b860-b8de-46c2-a31f-9cf24aeb6ea5>3.1.4 第四，资源隔离。<a hidden class=anchor aria-hidden=true href=#h:8449b860-b8de-46c2-a31f-9cf24aeb6ea5>#</a></h4><p>我们看到有的架构，比如说用户对 TP 性能要求比较高，要求你在引入实时 AP 的同
时，不能影响 TP 的能力和性能。也有用户提出对整体的能力要求，对硬件没有什么诉求，如果有需
要可以增加硬件。不同的用户有不同的要求，我们在面对这样的用户时，需要在资源隔离和数据新
鲜度，以及性能的提升方面做好权衡。</p><h2 id=h:fe8fe64e-4da2-4de3-8d67-65b166c68b46>4 GaussDB 在 HTAP 上的创新<a hidden class=anchor aria-hidden=true href=#h:fe8fe64e-4da2-4de3-8d67-65b166c68b46>#</a></h2><p>GaussDB 在现有基础上对 HTAP 进行改造，并实现以下几个方面的提升：</p><p>– 性能提升数十倍。GaussDB 已经实现向量化、并行、编译技术，性能提升 10+倍，一些场景下还有
更高的性能提升。最近我们基于 HTAP 做了更深度的挖掘和优化，比如基于降低内存拷贝、延迟读
等技术，向量化的扫描算子最新的数据又提升了大概 30 倍左右。</p><p>– 100%的透明路由。我们既有基于 Hint 手工指定的方式，还有基于规则、基于代价、基于 AI 的透明
路由技术。我们在基于代价的透明度路由方面，做了向量化优化技术；基于 AI 的透明路由方面，
我们通过轻量的 AI 技术可以真正应用到商业版中，通过这些技术，TP、AP 分流的准确率目前表现
还是不错的。</p><p>– 100%的数据新鲜度。我们实现了在同 Server 内的列式的内存引擎，数据同步方面支持实时同步、
在线同步、定期同步，保证了 TP 上的数据和 IUD 操作带来的数据修改及时同步到引擎上，可以实现
100%的数据新鲜度。</p><p>– 100%的资源隔离。如果用户更关注的是 100%的资源隔离，我们也提供了基于主备复制 HTAP 模式，
通过读写分离，把 TP 业务放到主机上，AP 业务放到备机上，实现资源的隔离。</p><p>目前，GaussDB 既有基于同 Server 的实时的 HTAP，也有基于主备技术的准实时的 HTAP，同时在透明路
由的加持下，能够准确的把业务分流同步分到实时的 HTAP 上，达成在性能、资源隔离、数据新鲜度
方面有一个均衡的结果。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://yangyingchao.github.io/tags/guassdb/>guassdb</a></li><li><a href=https://yangyingchao.github.io/tags/htap/>HTAP</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://yangyingchao.github.io>MyNotes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>