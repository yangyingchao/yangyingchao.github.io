<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Performance Tip of the Week - 杂七杂八随手记</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="yyc"><meta name=description content="Table of Contents 1 #9: Optimizations past their prime 1.1 Best practices 1.2 #21: Improving the efficiency of your regular expressions 1 #9: Optimizations past their prime 1.1 Best practices – 可能的情况下编写清晰、惯用的代码 Prefer writing clear, idiomatic code whenever possible. It is not only easier to read and debug, but in the long run, also easier"><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.115.0 with theme even"><link rel=canonical href=https://yangyingchao.github.io/posts/perf-tip-of-week/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.154ed883776547b0e136be39b3037f61350da06f888d0868d1756a9463cd9520.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Performance Tip of the Week"><meta property="og:description" content="Table of Contents 1 #9: Optimizations past their prime 1.1 Best practices 1.2 #21: Improving the efficiency of your regular expressions 1 #9: Optimizations past their prime 1.1 Best practices – 可能的情况下编写清晰、惯用的代码 Prefer writing clear, idiomatic code whenever possible. It is not only easier to read and debug, but in the long run, also easier"><meta property="og:type" content="article"><meta property="og:url" content="https://yangyingchao.github.io/posts/perf-tip-of-week/"><meta property="article:section" content="posts"><meta itemprop=name content="Performance Tip of the Week"><meta itemprop=description content="Table of Contents 1 #9: Optimizations past their prime 1.1 Best practices 1.2 #21: Improving the efficiency of your regular expressions 1 #9: Optimizations past their prime 1.1 Best practices – 可能的情况下编写清晰、惯用的代码 Prefer writing clear, idiomatic code whenever possible. It is not only easier to read and debug, but in the long run, also easier"><meta itemprop=wordCount content="808"><meta itemprop=keywords content="tag1,tag2,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Performance Tip of the Week"><meta name=twitter:description content="Table of Contents 1 #9: Optimizations past their prime 1.1 Best practices 1.2 #21: Improving the efficiency of your regular expressions 1 #9: Optimizations past their prime 1.1 Best practices – 可能的情况下编写清晰、惯用的代码 Prefer writing clear, idiomatic code whenever possible. It is not only easier to read and debug, but in the long run, also easier"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Even</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Even</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><div class=post-content><div class="ox-hugo-toc toc has-section-numbers"><div class=heading>Table of Contents</div><ul><li><span class=section-num>1</span> <a href=#h:3349e37f-2402-49e1-a891-9f1849eee5a8>#9: Optimizations past their prime</a><ul><li><span class=section-num>1.1</span> <a href=#h:4353c6fb-3ca3-4d32-b745-11b1fbcb7005>Best practices</a></li><li><span class=section-num>1.2</span> <a href=#h:b840fb72-5992-44a3-ad54-225b893a0b03>#21: Improving the efficiency of your regular expressions</a></li></ul></li></ul></div><h2 id=h:3349e37f-2402-49e1-a891-9f1849eee5a8><span class=section-num>1</span> #9: Optimizations past their prime</h2><h3 id=h:4353c6fb-3ca3-4d32-b745-11b1fbcb7005><span class=section-num>1.1</span> Best practices</h3><p>– 可能的情况下编写清晰、惯用的代码<br>Prefer writing clear, idiomatic code whenever possible. It is not only easier to read
and debug, but in the long run, also easier for the compiler to optimize.</p><p>这不仅易于阅读和调试，而且从长远来看，也更容易让编译器进行优化。</p><p>– 倾向使用编译器提供的函数：<br>Whenever you find a low-level performance optimization that requires fancy
bit-twiddling, intrinsics code, or inline assembly, consider first whether this is
something the compiler could do.</p><p>当你发现需要使用复杂的位运算、内嵌代码或内联汇编来进行底层性能优化时，请首先考虑这是否是编译器可以
完成的工作。</p><p>– If the code is hot, and the optimization is not something the compiler can be taught
to perform, then: prefer portable code, possibly using hwy to generate efficient and
portable vector code, failing that use intrinsics, failing that use inline asm (this
should be extremely rare). Avoiding inline assembly makes the code more portable
across microarchitectures.</p><p>如果代码运行频繁，并且优化不是编译器可以完成的工作， 有多种可选择的实现时，考虑下面的顺序：</p><ul><li>请优先使用可移植的代码，（可能使用 hwy 生成高效且可移植的向量代码）</li><li>如果不行则使用编译器内部函数 (intrinsics) ，</li><li>最后使用内联汇编（这应该是极为罕见的情况）。<ul><li>避免使用内联汇编可使代码在微体系结构之间更易移植。</li></ul></li></ul><p>– Keep the “naive” code you are replacing.<br>If you are optimizing ComputeFoo, consider keeping the simple implementation in a
REFERENCE_ComputeFoo function. This:</p><ul><li>makes it easy to write a unit-test for the new implementation that ensures the two
functions are equivalent;</li><li>makes it easier to write a microbenchmark; and it makes it easier to revert to the
reference code when (not if) the machine-dependent implementation outlives its
usefulness.</li></ul><p>保留你要替换的“朴素”代码。如果你正在优化 ComputeFoo，考虑将简单的实现保留在
REFERENCE_ComputeFoo 函数中。这使得编写单元测试来确保两个函数是等效的变得容易；它使编
写微基准测试变得更容易；它也使得当（而不是如果）与机器相关的实现过时时，更容易恢复到参
考代码。</p><p>– Include a microbenchmark with your change.<br>在你的更改中包含一个微基准测试。</p><p>– When designing or changing configuration knobs, ensure that the choices stay optimal
over time. Frequently, overriding the default can lead to suboptimal behavior when the
default changes by pinning things in a worse-than-out-of-the-box state. Designing the
knobs in terms of the outcome rather than specific behavior aspects can make such
overrides easier (or even possible) to evolve.</p><p>在设计或更改配置选项时，请确保选择始终保持最优状态。通常，覆盖默认设置可能会导致次优行
为，因为将事物钉在比开箱即用更差的状态。将选项设计为以结果为基础而不是特定行为方面，可
以使这些覆盖更易于演变甚至成为可能。</p><h3 id=h:b840fb72-5992-44a3-ad54-225b893a0b03><span class=section-num>1.2</span> #21: Improving the efficiency of your regular expressions</h3><h4 id=h:7505eba6-e079-4ae5-9a54-b62074cc1450><span class=section-num>1.2.1</span> Using regular expressions: a representative sample</h4><h4 id=h:eee0025f-e714-4baf-a3fc-f789edc9919b><span class=section-num>1.2.2</span> Writing more efficient code</h4><h4 id=h:29739270-c76a-4e80-b8b7-bbafb535e4d2><span class=section-num>1.2.3</span> Writing more efficient regular expressions</h4></div></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:yang.yingchao@qq.com class="iconfont icon-email" title=email></a>
<a href=http://localhost:1313 class="iconfont icon-stack-overflow" title=stack-overflow></a>
<a href=https://github.com/yangyingchao/ class="iconfont icon-github" title=github></a>
<a href=https://yangyingchao.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2017 -
2023<span class=heart><i class="iconfont icon-heart"></i></span><span>yyc</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script></body></html>