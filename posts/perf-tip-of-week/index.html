<!doctype html><html lang=zh-cn><head><title>Performance Tip of the Week · MyNotes</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="yyc"><meta name=description content="1 #9: Optimizations past their prime 1.1 Best practices 1.2 #21: Improving the efficiency of your regular expressions 本文为摘录，原文为： https://abseil.io/fast 1 #9: Optimizations past their prime 链接到标题 1.1 Best practices 链接到标题 – 可能的情况下编写清晰、惯用的代码 Prefer writing clear, idiomatic code"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Performance Tip of the Week"><meta name=twitter:description content="1 #9: Optimizations past their prime 1.1 Best practices 1.2 #21: Improving the efficiency of your regular expressions 本文为摘录，原文为： https://abseil.io/fast 1 #9: Optimizations past their prime 链接到标题 1.1 Best practices 链接到标题 – 可能的情况下编写清晰、惯用的代码 Prefer writing clear, idiomatic code"><meta property="og:title" content="Performance Tip of the Week"><meta property="og:description" content="1 #9: Optimizations past their prime 1.1 Best practices 1.2 #21: Improving the efficiency of your regular expressions 本文为摘录，原文为： https://abseil.io/fast 1 #9: Optimizations past their prime 链接到标题 1.1 Best practices 链接到标题 – 可能的情况下编写清晰、惯用的代码 Prefer writing clear, idiomatic code"><meta property="og:type" content="article"><meta property="og:url" content="https://yangyingchao.github.io/posts/perf-tip-of-week/"><meta property="article:section" content="posts"><link rel=canonical href=https://yangyingchao.github.io/posts/perf-tip-of-week/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.135e22c97ff685fe983fc60048e309ced8f00d8d38f536aa67dba8a13a03dfa4.css integrity="sha256-E14iyX/2hf6YP8YASOMJztjwDY049TaqZ9uooToD36Q=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>MyNotes</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/contact/>Contact me</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://yangyingchao.github.io/posts/perf-tip-of-week/>Performance Tip of the Week</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=0001-01-01T00:00:00Z>January 1, 0001</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
阅读时间：2 分钟</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/tag1/>tag1</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/tag2/>tag2</a></span></div></div></header><div class=post-content><ul><li>1 <a href=#h:3349e37f-2402-49e1-a891-9f1849eee5a8>#9: Optimizations past their prime</a><ul><li>1.1 <a href=#h:4353c6fb-3ca3-4d32-b745-11b1fbcb7005>Best practices</a></li><li>1.2 <a href=#h:b840fb72-5992-44a3-ad54-225b893a0b03>#21: Improving the efficiency of your regular expressions</a></li></ul></li></ul><p>本文为摘录，原文为： <a href=https://abseil.io/fast class=external-link target=_blank rel=noopener>https://abseil.io/fast</a></p><h2 id=h:3349e37f-2402-49e1-a891-9f1849eee5a8>1 #9: Optimizations past their prime
<a class=heading-link href=#h:3349e37f-2402-49e1-a891-9f1849eee5a8><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h2><h3 id=h:4353c6fb-3ca3-4d32-b745-11b1fbcb7005>1.1 Best practices
<a class=heading-link href=#h:4353c6fb-3ca3-4d32-b745-11b1fbcb7005><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p>– 可能的情况下编写清晰、惯用的代码
Prefer writing clear, idiomatic code whenever possible. It is not only easier to read
and debug, but in the long run, also easier for the compiler to optimize.</p><p>这不仅易于阅读和调试，而且从长远来看，也更容易让编译器进行优化。</p><p>– 倾向使用编译器提供的函数：
Whenever you find a low-level performance optimization that requires fancy
bit-twiddling, intrinsics code, or inline assembly, consider first whether this is
something the compiler could do.</p><p>当你发现需要使用复杂的位运算、内嵌代码或内联汇编来进行底层性能优化时，请首先考虑这是否是编译器可以
完成的工作。</p><p>– If the code is hot, and the optimization is not something the compiler can be taught
to perform, then: prefer portable code, possibly using hwy to generate efficient and
portable vector code, failing that use intrinsics, failing that use inline asm (this
should be extremely rare). Avoiding inline assembly makes the code more portable
across microarchitectures.</p><p>如果代码运行频繁，并且优化不是编译器可以完成的工作， 有多种可选择的实现时，考虑下面的顺序：</p><ul><li>请优先使用可移植的代码，（可能使用 hwy 生成高效且可移植的向量代码）</li><li>如果不行则使用编译器内部函数 (intrinsics) ，</li><li>最后使用内联汇编（这应该是极为罕见的情况）。<ul><li>避免使用内联汇编可使代码在微体系结构之间更易移植。</li></ul></li></ul><p>– Keep the “naive” code you are replacing.
If you are optimizing ComputeFoo, consider keeping the simple implementation in a
REFERENCE_ComputeFoo function. This:</p><ul><li>makes it easy to write a unit-test for the new implementation that ensures the two
functions are equivalent;</li><li>makes it easier to write a microbenchmark; and it makes it easier to revert to the
reference code when (not if) the machine-dependent implementation outlives its
usefulness.</li></ul><p>保留你要替换的“朴素”代码。如果你正在优化 ComputeFoo，考虑将简单的实现保留在
REFERENCE_ComputeFoo 函数中。这使得编写单元测试来确保两个函数是等效的变得容易；它使编
写微基准测试变得更容易；它也使得当（而不是如果）与机器相关的实现过时时，更容易恢复到参
考代码。</p><p>– Include a microbenchmark with your change.
在你的更改中包含一个微基准测试。</p><p>– When designing or changing configuration knobs, ensure that the choices stay optimal
over time. Frequently, overriding the default can lead to suboptimal behavior when the
default changes by pinning things in a worse-than-out-of-the-box state. Designing the
knobs in terms of the outcome rather than specific behavior aspects can make such
overrides easier (or even possible) to evolve.</p><p>在设计或更改配置选项时，请确保选择始终保持最优状态。通常，覆盖默认设置可能会导致次优行
为，因为将事物钉在比开箱即用更差的状态。将选项设计为以结果为基础而不是特定行为方面，可
以使这些覆盖更易于演变甚至成为可能。</p><h3 id=h:b840fb72-5992-44a3-ad54-225b893a0b03>1.2 #21: Improving the efficiency of your regular expressions
<a class=heading-link href=#h:b840fb72-5992-44a3-ad54-225b893a0b03><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><h4 id=h:7505eba6-e079-4ae5-9a54-b62074cc1450>1.2.1 Using regular expressions: a representative sample
<a class=heading-link href=#h:7505eba6-e079-4ae5-9a54-b62074cc1450><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h4><h4 id=h:eee0025f-e714-4baf-a3fc-f789edc9919b>1.2.2 Writing more efficient code
<a class=heading-link href=#h:eee0025f-e714-4baf-a3fc-f789edc9919b><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h4><h4 id=h:29739270-c76a-4e80-b8b7-bbafb535e4d2>1.2.3 Writing more efficient regular expressions
<a class=heading-link href=#h:29739270-c76a-4e80-b8b7-bbafb535e4d2><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h4></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2023
yyc
·
技术支持 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>