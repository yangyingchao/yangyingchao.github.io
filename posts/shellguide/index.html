<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>google shell style guide | Style guides for Google-originated open-source projects | MyNotes</title><meta name=keywords content="google,style,shell,bash"><meta name=description content="1 Background 2 Shell Files and Interpreter Invocation 2.1 File Extensions 2.2 SUID/SGID 3 Environment 3.1 STDOUT vs STDERR 4 Comments 4.1 File Header 4.2 Function Comments 4.3 Implementation Comments 4.4 TODO Comments 5 Formatting 5.1 Indentation 5.2 Line Length and Long Strings 5.3 Pipelines 5.4 Loops 5.5 Case statement 5.6 Variable expansion 5.7 Quoting 6 Features and Bugs 6.1 ShellCheck 6.2 Command Substitution 6.3 Test, [ … ], and"><meta name=author content><link rel=canonical href=https://yangyingchao.github.io/posts/shellguide/><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://yangyingchao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://yangyingchao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://yangyingchao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://yangyingchao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://yangyingchao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="google shell style guide | Style guides for Google-originated open-source projects"><meta property="og:description" content="1 Background 2 Shell Files and Interpreter Invocation 2.1 File Extensions 2.2 SUID/SGID 3 Environment 3.1 STDOUT vs STDERR 4 Comments 4.1 File Header 4.2 Function Comments 4.3 Implementation Comments 4.4 TODO Comments 5 Formatting 5.1 Indentation 5.2 Line Length and Long Strings 5.3 Pipelines 5.4 Loops 5.5 Case statement 5.6 Variable expansion 5.7 Quoting 6 Features and Bugs 6.1 ShellCheck 6.2 Command Substitution 6.3 Test, [ … ], and"><meta property="og:type" content="article"><meta property="og:url" content="https://yangyingchao.github.io/posts/shellguide/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-17T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-17T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="google shell style guide | Style guides for Google-originated open-source projects"><meta name=twitter:description content="1 Background 2 Shell Files and Interpreter Invocation 2.1 File Extensions 2.2 SUID/SGID 3 Environment 3.1 STDOUT vs STDERR 4 Comments 4.1 File Header 4.2 Function Comments 4.3 Implementation Comments 4.4 TODO Comments 5 Formatting 5.1 Indentation 5.2 Line Length and Long Strings 5.3 Pipelines 5.4 Loops 5.5 Case statement 5.6 Variable expansion 5.7 Quoting 6 Features and Bugs 6.1 ShellCheck 6.2 Command Substitution 6.3 Test, [ … ], and"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://yangyingchao.github.io/posts/"},{"@type":"ListItem","position":3,"name":"google shell style guide | Style guides for Google-originated open-source projects","item":"https://yangyingchao.github.io/posts/shellguide/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"google shell style guide | Style guides for Google-originated open-source projects","name":"google shell style guide | Style guides for Google-originated open-source projects","description":"1 Background 2 Shell Files and Interpreter Invocation 2.1 File Extensions 2.2 SUID/SGID 3 Environment 3.1 STDOUT vs STDERR 4 Comments 4.1 File Header 4.2 Function Comments 4.3 Implementation Comments 4.4 TODO Comments 5 Formatting 5.1 Indentation 5.2 Line Length and Long Strings 5.3 Pipelines 5.4 Loops 5.5 Case statement 5.6 Variable expansion 5.7 Quoting 6 Features and Bugs 6.1 ShellCheck 6.2 Command Substitution 6.3 Test, [ … ], and","keywords":["google","style","shell","bash"],"articleBody":" 1 Background 2 Shell Files and Interpreter Invocation 2.1 File Extensions 2.2 SUID/SGID 3 Environment 3.1 STDOUT vs STDERR 4 Comments 4.1 File Header 4.2 Function Comments 4.3 Implementation Comments 4.4 TODO Comments 5 Formatting 5.1 Indentation 5.2 Line Length and Long Strings 5.3 Pipelines 5.4 Loops 5.5 Case statement 5.6 Variable expansion 5.7 Quoting 6 Features and Bugs 6.1 ShellCheck 6.2 Command Substitution 6.3 Test, [ … ], and \\[\\[ … \\]\\] 6.4 Testing Strings 6.5 Wildcard Expansion of Filenames 6.6 Eval 6.7 Arrays 6.8 Pipes to While 6.9 Arithmetic 7 Naming Conventions 7.1 Function Names 7.2 Variable Names 7.3 Constants and Environment Variable Names 7.4 Source Filenames 7.5 Read-only Variables 7.6 Use Local Variables 7.7 Function Location 7.8 main 8 Calling Commands 8.1 Checking Return Values 8.2 Builtin Commands vs. External Commands 9 Conclusion 本文为摘录，原文为： https://google.github.io/styleguide/shellguide.html\n1 Background Bash is the only shell scripting language permitted for executables.\n2 Shell Files and Interpreter Invocation 2.1 File Extensions 可执行文件: 应该没有扩展名（强烈推荐）, 或者使用 .sh 扩展名。 库文件: 必须使用 .sh 扩展名，且 不应该是可执行 的。 在执行一个程序时，不需要知道它使用的是哪种语言， 而且 shell 不需要扩展名，所以我们更倾向于不给可执行文件使用扩展名。\n然而，对于库文件，知道使用的是哪种语言很重要， 有时候需要使用不同语言的相似库文件。这样， 具有相同功能但不同语言的库文件可以有相同的文件名，只是在文件名末尾加上特定于语言的后缀。\n2.2 SUID/SGID 在 shell 脚本中禁止使用 SUID 和 SGID。\n由于 shell 存在许多安全问题，几乎不可能足够安全地使用 SUID/SGID。虽然 bash 确实使得运行 SUID 变得困难，但在某些平台上仍然有可能实现，这就是为什么我们明确禁止使用它的原因。\n如果需要提供特权访问，请使用 sudo。\n3 Environment 3.1 STDOUT vs STDERR 所有错误信息都应该发送到 STDERR 。这样可以更容易区分正常状态和实际问题。\n建议创建一个函数，用于打印错误信息以及其他状态信息。\n1 2 3 4 5 6 7 8 err() { echo \"[$(date +'%Y-%m-%dT%H:%M:%S%z')]: $*\" \u003e\u00262 } if ! do_something; then err \"Unable to do_something\" exit 1 fi 4 Comments 4.1 File Header 每个文件都要以其内容的描述开始。\n每个文件必须包含一个顶级注释，其中包含其内容的简要概述。版权声明和作者信息是可选的。\n示例:\n1 2 3 #!/bin/bash # # Perform hot backups of Oracle databases. 4.2 Function Comments 任何不明显且不简短的函数必须注释。 无论长度或复杂性如何，库中的每个函数都必须注释。 通过阅读注释（和提供的自助信息）而无需阅读代码，他人应能够了解如何使用您的程序或使用库中的函数。\n所有函数的注释应描述预期的 API 行为，包括：\n函数的描述。 全局变量：使用和修改的全局变量列表。 参数：接受的参数。 输出：STDOUT 或 STDERR 的输出。 返回值：除最后一条运行命令的默认退出状态之外的返回值。 1 2 3 4 5 6 7 8 9 10 11 12 13 Example: ####################################### # Cleanup files from the backup directory. # Globals: # BACKUP_DIR # ORACLE_SID # Arguments: # None ####################################### function cleanup() { … } 4.3 Implementation Comments 对复杂、不明显、有趣或重要的部分加以注释 这遵循了注释的一般惯例。不要对每个地方都进行评论。如果有复杂的算法或者你正在做一些与平常 不同的事情，可以简短地加上注释。\nTODO 4.4 Comments 对于临时的、短期的解决方案或者是足够好但不完美的代码，请使用 TODO 注释。 这与 C++指南的约定一致。\nTODO 应该包含全大写的 TODO 字符串，后面跟着在此问题上有最好理解背景的人的名字、电子邮件 地址或其他标识符。主要目的是拥有一致的 TODO，可以通过搜索找到如何根据请求获取更多细节的 方法。TODO 并不是一个承诺，指定的人会解决这个问题。因此，当您创建一个 TODO 时，通常会使 用您自己的名字。\n1 # TODO(mrmonkey): Handle the unlikely edge cases (bug ####) 5 Formatting 在修改文件时，应遵循已有的样式，但以下规定适用于任何新代码。\n5.1 Indentation 缩进两个空格，不要使用制表符。\n使用空行来分隔不同的块以提高可读性。缩进为两个空格。 无论你做什么，都不要使用制表符。 对于现有的文件，请保持忠于现有的缩进方式。\n5.2 Line Length and Long Strings 最大行长度是 80 个字符。\n如果您必须编写超过 80 个字符的字符串，应尽可能使用 here 文档或嵌入换行进行操作。 如果字面字符串必须超过 80 个字符且无法合理拆分，则可以接受，但强烈建议找到缩短的方法。 1 2 3 4 5 6 7 8 9 # DO use 'here document's cat \u003c","wordCount":"6429","inLanguage":"zh-cn","datePublished":"2023-08-17T00:00:00Z","dateModified":"2023-08-17T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://yangyingchao.github.io/posts/shellguide/"},"publisher":{"@type":"Organization","name":"MyNotes","logo":{"@type":"ImageObject","url":"https://yangyingchao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yangyingchao.github.io accesskey=h title="MyNotes (Alt + H)">MyNotes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yangyingchao.github.io/ title=Home><span>Home</span></a></li><li><a href=https://yangyingchao.github.io/posts/ title=Archives><span>Archives</span></a></li><li><a href=https://yangyingchao.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://yangyingchao.github.io/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>google shell style guide | Style guides for Google-originated open-source projects</h1><div class=post-meta><span title='2023-08-17 00:00:00 +0000 UTC'>August 17, 2023</span></div></header><div class=post-content><ul><li>1 <a href=#h:f6a55800-10d4-4052-be0f-f0d7053dd7b6>Background</a></li><li>2 <a href=#h:be0de52e-c0fc-43e7-b1f8-d99e128cef75>Shell Files and Interpreter Invocation</a><ul><li>2.1 <a href=#h:f9b70299-d7f6-431d-a77d-2bb400685496>File Extensions</a></li><li>2.2 <a href=#h:7eb24edb-2c24-4fea-b278-6aa152751b06>SUID/SGID</a></li></ul></li><li>3 <a href=#h:fa963b24-5dd3-4380-ae40-710090f14e29>Environment</a><ul><li>3.1 <a href=#h:90556c60-d3cd-465b-91c8-1e635abfee5f>STDOUT vs STDERR</a></li></ul></li><li>4 <a href=#h:e774be8f-ca5b-4520-a57f-c799f69b7675>Comments</a><ul><li>4.1 <a href=#h:24294cf2-94e9-4f88-9afe-a56220843c64>File Header</a></li><li>4.2 <a href=#h:43e7e163-58c6-4932-b309-95390eea923d>Function Comments</a></li><li>4.3 <a href=#h:4b9e0968-747e-4428-a718-7e54939feffd>Implementation Comments</a></li><li>4.4 <a href=#h:9a26a2da-3497-46f0-a3e1-1bc5739749e4>TODO Comments</a></li></ul></li><li>5 <a href=#h:fa0aab5f-0167-4fa5-a463-ea5b965ac727>Formatting</a><ul><li>5.1 <a href=#h:033bfebd-8148-4e37-bdb7-f1242f62d7a7>Indentation</a></li><li>5.2 <a href=#h:098c6c3a-4ae7-40bb-b75c-e37a811e28d7>Line Length and Long Strings</a></li><li>5.3 <a href=#h:dcbc1b2e-9cf4-48fe-a706-7f3a39386d32>Pipelines</a></li><li>5.4 <a href=#h:d5df6dad-79a8-4531-af28-a3e4a797d193>Loops</a></li><li>5.5 <a href=#h:033449c1-3dc3-4148-9de3-099eb0e1f366>Case statement</a></li><li>5.6 <a href=#h:ee435b39-dad7-4604-a699-738299997086>Variable expansion</a></li><li>5.7 <a href=#h:59bf8094-699c-4c8b-ae73-65616213a707>Quoting</a></li></ul></li><li>6 <a href=#h:f07ebca3-d96a-4b10-8f24-043ef9cfec52>Features and Bugs</a><ul><li>6.1 <a href=#h:8c4ba5f5-2f9e-41df-8f4d-1d1f7c143b71>ShellCheck</a></li><li>6.2 <a href=#h:39f77101-8b9e-48d3-8378-b9286c796412>Command Substitution</a></li><li>6.3 <a href=#h:2cf87600-2f6d-48c2-be83-78bcd604e5da>Test, <code>[ … ]</code>, and <code>\[\[ … \]\]</code></a></li><li>6.4 <a href=#h:35d9e289-38dc-42e3-a41c-6de70e4d8404>Testing Strings</a></li><li>6.5 <a href=#h:64dfe8cd-4826-44a0-aba3-7eb35ce48f26>Wildcard Expansion of Filenames</a></li><li>6.6 <a href=#h:32bb0195-e72a-4225-90ad-7117fde8d0a2>Eval</a></li><li>6.7 <a href=#h:2dd03710-f58f-42a5-9a44-e8018bfc560d>Arrays</a></li><li>6.8 <a href=#h:02047bfd-a8ec-4485-9930-17d1182370a5>Pipes to While</a></li><li>6.9 <a href=#h:2aa69bf1-223e-4c9d-902a-c195f99571a7>Arithmetic</a></li></ul></li><li>7 <a href=#h:f05a3c9b-4803-4daf-9f8e-a308ec4cdd7e>Naming Conventions</a><ul><li>7.1 <a href=#h:bb847e7f-6e4d-42ef-9dbe-f21d51289ce3>Function Names</a></li><li>7.2 <a href=#h:50d9a19c-c3c1-4f69-9933-5f6d4d4649b0>Variable Names</a></li><li>7.3 <a href=#h:58b0b2a6-375f-4a97-804d-ad2fea2ee103>Constants and Environment Variable Names</a></li><li>7.4 <a href=#h:888f6100-39cf-4d9a-b38b-75cf38526704>Source Filenames</a></li><li>7.5 <a href=#h:051bf4c0-5a94-4a7a-96c0-72c4c18e3547>Read-only Variables</a></li><li>7.6 <a href=#h:31bbd098-0f2e-46fd-83f5-c249dc69e0a1>Use Local Variables</a></li><li>7.7 <a href=#h:24a30647-7c4c-491f-b703-bbf46125092d>Function Location</a></li><li>7.8 <a href=#h:798b0a69-eb83-48ff-bcf3-a1860767c727>main</a></li></ul></li><li>8 <a href=#h:04e85d27-2e7a-4bbd-bec6-5ff094ed706f>Calling Commands</a><ul><li>8.1 <a href=#h:2a0c36d5-95f1-4aae-9b18-2f44a9d992c4>Checking Return Values</a></li><li>8.2 <a href=#h:eca45d0b-79dd-4e82-a638-bf072f336d79>Builtin Commands vs. External Commands</a></li></ul></li><li>9 <a href=#h:36111ffd-58b2-49b6-85f0-8c0f3cfe80f4>Conclusion</a></li></ul><p>本文为摘录，原文为： <a href=https://google.github.io/styleguide/shellguide.html>https://google.github.io/styleguide/shellguide.html</a></p><h2 id=h:f6a55800-10d4-4052-be0f-f0d7053dd7b6>1 Background<a hidden class=anchor aria-hidden=true href=#h:f6a55800-10d4-4052-be0f-f0d7053dd7b6>#</a></h2><p>Bash is the only shell scripting language permitted for executables.</p><h2 id=h:be0de52e-c0fc-43e7-b1f8-d99e128cef75>2 Shell Files and Interpreter Invocation<a hidden class=anchor aria-hidden=true href=#h:be0de52e-c0fc-43e7-b1f8-d99e128cef75>#</a></h2><h3 id=h:f9b70299-d7f6-431d-a77d-2bb400685496>2.1 File Extensions<a hidden class=anchor aria-hidden=true href=#h:f9b70299-d7f6-431d-a77d-2bb400685496>#</a></h3><ul><li>可执行文件: 应该没有扩展名（强烈推荐）, 或者使用 .sh 扩展名。</li><li>库文件: 必须使用 .sh 扩展名，且 <strong>不应该是可执行</strong> 的。</li></ul><p>在执行一个程序时，不需要知道它使用的是哪种语言， 而且 shell 不需要扩展名，所以我们更倾向于不给可执行文件使用扩展名。</p><p>然而，对于库文件，知道使用的是哪种语言很重要， 有时候需要使用不同语言的相似库文件。这样，
具有相同功能但不同语言的库文件可以有相同的文件名，只是在文件名末尾加上特定于语言的后缀。</p><h3 id=h:7eb24edb-2c24-4fea-b278-6aa152751b06>2.2 SUID/SGID<a hidden class=anchor aria-hidden=true href=#h:7eb24edb-2c24-4fea-b278-6aa152751b06>#</a></h3><p>在 shell 脚本中禁止使用 SUID 和 SGID。</p><p>由于 shell 存在许多安全问题，几乎不可能足够安全地使用 SUID/SGID。虽然 bash 确实使得运行
SUID 变得困难，但在某些平台上仍然有可能实现，这就是为什么我们明确禁止使用它的原因。</p><p>如果需要提供特权访问，请使用 sudo。</p><h2 id=h:fa963b24-5dd3-4380-ae40-710090f14e29>3 Environment<a hidden class=anchor aria-hidden=true href=#h:fa963b24-5dd3-4380-ae40-710090f14e29>#</a></h2><h3 id=h:90556c60-d3cd-465b-91c8-1e635abfee5f>3.1 STDOUT vs STDERR<a hidden class=anchor aria-hidden=true href=#h:90556c60-d3cd-465b-91c8-1e635abfee5f>#</a></h3><p>所有错误信息都应该发送到 <code>STDERR</code> 。这样可以更容易区分正常状态和实际问题。</p><p>建议创建一个函数，用于打印错误信息以及其他状态信息。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>err<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;[</span><span class=k>$(</span>date +<span class=s1>&#39;%Y-%m-%dT%H:%M:%S%z&#39;</span><span class=k>)</span><span class=s2>]: </span><span class=nv>$*</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> ! do_something<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  err <span class=s2>&#34;Unable to do_something&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=h:e774be8f-ca5b-4520-a57f-c799f69b7675>4 Comments<a hidden class=anchor aria-hidden=true href=#h:e774be8f-ca5b-4520-a57f-c799f69b7675>#</a></h2><h3 id=h:24294cf2-94e9-4f88-9afe-a56220843c64>4.1 File Header<a hidden class=anchor aria-hidden=true href=#h:24294cf2-94e9-4f88-9afe-a56220843c64>#</a></h3><p>每个文件都要以其内容的描述开始。</p><p>每个文件必须包含一个顶级注释，其中包含其内容的简要概述。版权声明和作者信息是可选的。</p><p>示例:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Perform hot backups of Oracle databases.</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:43e7e163-58c6-4932-b309-95390eea923d>4.2 Function Comments<a hidden class=anchor aria-hidden=true href=#h:43e7e163-58c6-4932-b309-95390eea923d>#</a></h3><ul><li>任何不明显且不简短的函数必须注释。</li><li>无论长度或复杂性如何，库中的每个函数都必须注释。</li></ul><p>通过阅读注释（和提供的自助信息）而无需阅读代码，他人应能够了解如何使用您的程序或使用库中的函数。</p><p>所有函数的注释应描述预期的 API 行为，包括：</p><ul><li>函数的描述。</li><li>全局变量：使用和修改的全局变量列表。</li><li>参数：接受的参数。</li><li>输出：STDOUT 或 STDERR 的输出。</li><li>返回值：除最后一条运行命令的默认退出状态之外的返回值。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>Example:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#######################################</span>
</span></span><span class=line><span class=cl><span class=c1># Cleanup files from the backup directory.</span>
</span></span><span class=line><span class=cl><span class=c1># Globals:</span>
</span></span><span class=line><span class=cl><span class=c1>#   BACKUP_DIR</span>
</span></span><span class=line><span class=cl><span class=c1>#   ORACLE_SID</span>
</span></span><span class=line><span class=cl><span class=c1># Arguments:</span>
</span></span><span class=line><span class=cl><span class=c1>#   None</span>
</span></span><span class=line><span class=cl><span class=c1>#######################################</span>
</span></span><span class=line><span class=cl><span class=k>function</span> cleanup<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  …
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:4b9e0968-747e-4428-a718-7e54939feffd>4.3 Implementation Comments<a hidden class=anchor aria-hidden=true href=#h:4b9e0968-747e-4428-a718-7e54939feffd>#</a></h3><ul><li>对复杂、不明显、有趣或重要的部分加以注释</li></ul><p>这遵循了注释的一般惯例。不要对每个地方都进行评论。如果有复杂的算法或者你正在做一些与平常
不同的事情，可以简短地加上注释。</p><h3 id=h:9a26a2da-3497-46f0-a3e1-1bc5739749e4>TODO 4.4 Comments<a hidden class=anchor aria-hidden=true href=#h:9a26a2da-3497-46f0-a3e1-1bc5739749e4>#</a></h3><ul><li>对于临时的、短期的解决方案或者是足够好但不完美的代码，请使用 TODO 注释。</li></ul><p>这与 C++指南的约定一致。</p><p>TODO 应该包含全大写的 TODO 字符串，后面跟着在此问题上有最好理解背景的人的名字、电子邮件
地址或其他标识符。主要目的是拥有一致的 TODO，可以通过搜索找到如何根据请求获取更多细节的
方法。TODO 并不是一个承诺，指定的人会解决这个问题。因此，当您创建一个 TODO 时，通常会使
用您自己的名字。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># TODO(mrmonkey): Handle the unlikely edge cases (bug ####)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=h:fa0aab5f-0167-4fa5-a463-ea5b965ac727>5 Formatting<a hidden class=anchor aria-hidden=true href=#h:fa0aab5f-0167-4fa5-a463-ea5b965ac727>#</a></h2><p>在修改文件时，应遵循已有的样式，但以下规定适用于任何新代码。</p><h3 id=h:033bfebd-8148-4e37-bdb7-f1242f62d7a7>5.1 Indentation<a hidden class=anchor aria-hidden=true href=#h:033bfebd-8148-4e37-bdb7-f1242f62d7a7>#</a></h3><ul><li><p>缩进两个空格，不要使用制表符。</p><ul><li>使用空行来分隔不同的块以提高可读性。缩进为两个空格。</li><li>无论你做什么，都不要使用制表符。</li></ul></li><li><p>对于现有的文件，请保持忠于现有的缩进方式。</p></li></ul><h3 id=h:098c6c3a-4ae7-40bb-b75c-e37a811e28d7>5.2 Line Length and Long Strings<a hidden class=anchor aria-hidden=true href=#h:098c6c3a-4ae7-40bb-b75c-e37a811e28d7>#</a></h3><p>最大行长度是 80 个字符。</p><ul><li>如果您必须编写超过 80 个字符的字符串，应尽可能使用 here 文档或嵌入换行进行操作。</li><li>如果字面字符串必须超过 80 个字符且无法合理拆分，则可以接受，但强烈建议找到缩短的方法。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># DO use &#39;here document&#39;s</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;END
</span></span></span><span class=line><span class=cl><span class=s>I am an exceptionally long
</span></span></span><span class=line><span class=cl><span class=s>string.
</span></span></span><span class=line><span class=cl><span class=s>END</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Embedded newlines are ok too</span>
</span></span><span class=line><span class=cl><span class=nv>long_string</span><span class=o>=</span><span class=s2>&#34;I am an exceptionally
</span></span></span><span class=line><span class=cl><span class=s2>long string.&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:dcbc1b2e-9cf4-48fe-a706-7f3a39386d32>5.3 Pipelines<a hidden class=anchor aria-hidden=true href=#h:dcbc1b2e-9cf4-48fe-a706-7f3a39386d32>#</a></h3><ul><li>如果一个管道能全部放在一行上，应该放在一行上。</li><li>如果一个管道不能:<ul><li>应该在每个管道段落上分开一行，</li><li>管道放在新的一行上，</li><li>下一个管道段落应有两个空格的缩进。</li><li>这适用于使用“|”连接的一系列命令以及使用“||”和“&&”进行逻辑连接的组合。</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># All fits on one line</span>
</span></span><span class=line><span class=cl>command1 <span class=p>|</span> command2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Long commands</span>
</span></span><span class=line><span class=cl>command1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> command2 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> command3 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=p>|</span> command4
</span></span></code></pre></td></tr></table></div></div><h3 id=h:d5df6dad-79a8-4531-af28-a3e4a797d193>5.4 Loops<a hidden class=anchor aria-hidden=true href=#h:d5df6dad-79a8-4531-af28-a3e4a797d193>#</a></h3><p>将 <code>; do</code> 和 <code>; then</code> 放在与 <code>while</code> 、 <code>for</code> 或 <code>if</code> 同一行。</p><p>在 shell 中的循环有点不同，但我们遵循与声明函数时相同的原则。也就是说：</p><ul><li>; then 和 ; do 应该与 if/for/while 放在同一行</li><li>else 应该自成一行，</li><li>关闭语句应该垂直对齐于开放语句的行。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># If inside a function, consider declaring the loop variable as</span>
</span></span><span class=line><span class=cl><span class=c1># a local to avoid it leaking into the global environment:</span>
</span></span><span class=line><span class=cl><span class=c1># local dir</span>
</span></span><span class=line><span class=cl><span class=k>for</span> dir in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>dirs_to_cleanup</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[[</span> -d <span class=s2>&#34;</span><span class=si>${</span><span class=nv>dir</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>ORACLE_SID</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    log_date <span class=s2>&#34;Cleaning up old files in </span><span class=si>${</span><span class=nv>dir</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>ORACLE_SID</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    rm <span class=s2>&#34;</span><span class=si>${</span><span class=nv>dir</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>ORACLE_SID</span><span class=si>}</span><span class=s2>/&#34;</span>*
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>((</span> <span class=nv>$?</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>      error_message
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>    mkdir -p <span class=s2>&#34;</span><span class=si>${</span><span class=nv>dir</span><span class=si>}</span><span class=s2>/</span><span class=si>${</span><span class=nv>ORACLE_SID</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>((</span> <span class=nv>$?</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>      error_message
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:033449c1-3dc3-4148-9de3-099eb0e1f366>5.5 Case statement<a hidden class=anchor aria-hidden=true href=#h:033449c1-3dc3-4148-9de3-099eb0e1f366>#</a></h3><ul><li>替代缩进使用 2 个空格。</li><li>一行替代方案需要在模式的关闭括号后和 ;; 前加上一个空格。</li><li>长或多命令的替代方案应该分成多行，模式、行为和 ;; 分别放在不同的行上。</li></ul><p>匹配表达式离 case 和 esac 缩进一个层级。多行行为再缩进一个层级。通常情况下，没有必要对匹
配表达式进行引号。模式表达式之前不应有左括号。避免使用 ;& 和 ;;& 符号。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=k>case</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>expression</span><span class=si>}</span><span class=s2>&#34;</span> in
</span></span><span class=line><span class=cl>  a<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>variable</span><span class=o>=</span><span class=s2>&#34;…&#34;</span>
</span></span><span class=line><span class=cl>    some_command <span class=s2>&#34;</span><span class=si>${</span><span class=nv>variable</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>other_expr</span><span class=si>}</span><span class=s2>&#34;</span> …
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  absolute<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>actions</span><span class=o>=</span><span class=s2>&#34;relative&#34;</span>
</span></span><span class=line><span class=cl>    another_command <span class=s2>&#34;</span><span class=si>${</span><span class=nv>actions</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>other_expr</span><span class=si>}</span><span class=s2>&#34;</span> …
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  *<span class=o>)</span>
</span></span><span class=line><span class=cl>    error <span class=s2>&#34;Unexpected expression &#39;</span><span class=si>${</span><span class=nv>expression</span><span class=si>}</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl><span class=k>esac</span>
</span></span></code></pre></td></tr></table></div></div><p>只要表达式可读性没有受到影响，简单命令可以与模式和;;放在同一行上。</p><p>这通常适用于单字母选项处理。当动作无法放在一行上时，将模式放在独立的一行上，然后是动作，
然后再另起一行写;;。当与动作在同一行上时，在模式的闭括号后加一个空格，再在;;之前加一个空
格。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>verbose</span><span class=o>=</span><span class=s1>&#39;false&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>aflag</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>bflag</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>files</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=nb>getopts</span> <span class=s1>&#39;abf:v&#39;</span> flag<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>flag</span><span class=si>}</span><span class=s2>&#34;</span> in
</span></span><span class=line><span class=cl>    a<span class=o>)</span> <span class=nv>aflag</span><span class=o>=</span><span class=s1>&#39;true&#39;</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>    b<span class=o>)</span> <span class=nv>bflag</span><span class=o>=</span><span class=s1>&#39;true&#39;</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>    f<span class=o>)</span> <span class=nv>files</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>OPTARG</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>    v<span class=o>)</span> <span class=nv>verbose</span><span class=o>=</span><span class=s1>&#39;true&#39;</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>    *<span class=o>)</span> error <span class=s2>&#34;Unexpected option </span><span class=si>${</span><span class=nv>flag</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>  <span class=k>esac</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:ee435b39-dad7-4604-a699-738299997086>5.6 Variable expansion<a hidden class=anchor aria-hidden=true href=#h:ee435b39-dad7-4604-a699-738299997086>#</a></h3><p>按照优先顺序：</p><ul><li>保持与您发现的代码一致；</li><li>引用您的变量 (使用 <code>"</code> )；</li><li>优先使用 <code>"${var}"</code> 而非 <code>"$var"</code> 。</li></ul><p>这些是强烈推荐的准则，但并非强制性规定。然而，推荐而非强制并不意味着可以轻视或低估。</p><h3 id=h:59bf8094-699c-4c8b-ae73-65616213a707>5.7 Quoting<a hidden class=anchor aria-hidden=true href=#h:59bf8094-699c-4c8b-ae73-65616213a707>#</a></h3><ul><li>无论如何都要引用包含变量、命令替换、空格或 shell 元字符的字符串
除非需要小心地取消引用扩展或它是一个 shell 内部整数（见下一条）。</li><li>使用数组来安全引用元素列表，尤其是命令行选项
详见下面的数组部分。</li><li>可选择引用 shell 内部的只读特殊变量<ul><li>这些变量被定义为整数：\(?、\)#、$$、$!（参见 man bash）。</li><li>为了一致性，更喜欢引用“命名”的内部整数变量，如 PPID 等。</li></ul></li><li>更倾向于引用作为“单词”的字符串（而不是命令选项或路径名）。</li><li>永远不要引用字面整数。</li><li>了解 <code>\[\[..\]\]</code> ]]中模式匹配的引用规则。
详见下面的章节。</li><li>除非有特定的原因要使用 <code>$*</code> ，否则使用 <code>"$@"</code> ，比如只是将参数追加到消息或日志的字符串中。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># &#39;Single&#39; quotes indicate that no substitution is desired.</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;Double&#34; quotes indicate that substitution is required/tolerated.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Simple examples</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &#34;quote command substitutions&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Note that quotes nested inside &#34;$()&#34; don&#39;t need escaping.</span>
</span></span><span class=line><span class=cl><span class=nv>flag</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>some_command and its args <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span> <span class=s1>&#39;quoted separately&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &#34;quote variables&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>flag</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Use arrays with quoted expansion for lists.</span>
</span></span><span class=line><span class=cl><span class=nb>declare</span> -a FLAGS
</span></span><span class=line><span class=cl><span class=nv>FLAGS</span><span class=o>=(</span> --foo --bar<span class=o>=</span><span class=s1>&#39;baz&#39;</span> <span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> FLAGS
</span></span><span class=line><span class=cl>mybinary <span class=s2>&#34;</span><span class=si>${</span><span class=nv>FLAGS</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># It&#39;s ok to not quote internal integer variables.</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>((</span> <span class=nv>$#</span> &gt; <span class=m>3</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;ppid=</span><span class=si>${</span><span class=nv>PPID</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &#34;never quote literal integers&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>value</span><span class=o>=</span><span class=m>32</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;quote command substitutions&#34;, even when you expect integers</span>
</span></span><span class=line><span class=cl><span class=nv>number</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>generate_number<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &#34;prefer quoting words&#34;, not compulsory</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>USE_INTEGER</span><span class=o>=</span><span class=s1>&#39;true&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &#34;quote shell meta characters&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;Hello stranger, and well met. Earn lots of $$$&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Process </span><span class=nv>$$</span><span class=s2>: Done making \$\$\$.&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &#34;command options or path names&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># ($1 is assumed to contain a value here)</span>
</span></span><span class=line><span class=cl>grep -li Hugo /dev/null <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Less simple examples</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;quote variables, unless proven false&#34;: ccs might be empty</span>
</span></span><span class=line><span class=cl>git send-email --to <span class=s2>&#34;</span><span class=si>${</span><span class=nv>reviewers</span><span class=si>}</span><span class=s2>&#34;</span> <span class=si>${</span><span class=nv>ccs</span><span class=p>:+</span><span class=s2>&#34;--cc&#34;</span><span class=p> </span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>ccs</span><span class=si>}</span><span class=s2>&#34;</span><span class=si>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Positional parameter precautions: $1 might be unset</span>
</span></span><span class=line><span class=cl><span class=c1># Single quotes leave regex as-is.</span>
</span></span><span class=line><span class=cl>grep -cP <span class=s1>&#39;([Ss]pecial|\|?characters*)$&#39;</span> <span class=si>${</span><span class=nv>1</span><span class=p>:+</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span><span class=si>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># For passing on arguments,</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;$@&#34; is right almost every time, and</span>
</span></span><span class=line><span class=cl><span class=c1># $* is wrong almost every time:</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># * $* and $@ will split on spaces, clobbering up arguments</span>
</span></span><span class=line><span class=cl><span class=c1>#   that contain spaces and dropping empty strings;</span>
</span></span><span class=line><span class=cl><span class=c1># * &#34;$@&#34; will retain arguments as-is, so no args</span>
</span></span><span class=line><span class=cl><span class=c1>#   provided will result in no args being passed on;</span>
</span></span><span class=line><span class=cl><span class=c1>#   This is in most cases what you want to use for passing</span>
</span></span><span class=line><span class=cl><span class=c1>#   on arguments.</span>
</span></span><span class=line><span class=cl><span class=c1># * &#34;$*&#34; expands to one argument, with all args joined</span>
</span></span><span class=line><span class=cl><span class=c1>#   by (usually) spaces,</span>
</span></span><span class=line><span class=cl><span class=c1>#   so no args provided will result in one empty string</span>
</span></span><span class=line><span class=cl><span class=c1>#   being passed on.</span>
</span></span><span class=line><span class=cl><span class=c1># (Consult `man bash` for the nit-grits ;-)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=nb>set</span> -- <span class=m>1</span> <span class=s2>&#34;2 two&#34;</span> <span class=s2>&#34;3 three tres&#34;</span><span class=p>;</span> <span class=nb>echo</span> <span class=nv>$#</span><span class=p>;</span> <span class=nb>set</span> -- <span class=s2>&#34;</span><span class=nv>$*</span><span class=s2>&#34;</span><span class=p>;</span> <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$#</span><span class=s2>, </span><span class=nv>$@</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=nb>set</span> -- <span class=m>1</span> <span class=s2>&#34;2 two&#34;</span> <span class=s2>&#34;3 three tres&#34;</span><span class=p>;</span> <span class=nb>echo</span> <span class=nv>$#</span><span class=p>;</span> <span class=nb>set</span> -- <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span><span class=p>;</span> <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$#</span><span class=s2>, </span><span class=nv>$@</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=h:f07ebca3-d96a-4b10-8f24-043ef9cfec52>6 Features and Bugs<a hidden class=anchor aria-hidden=true href=#h:f07ebca3-d96a-4b10-8f24-043ef9cfec52>#</a></h2><h3 id=h:8c4ba5f5-2f9e-41df-8f4d-1d1f7c143b71>6.1 ShellCheck<a hidden class=anchor aria-hidden=true href=#h:8c4ba5f5-2f9e-41df-8f4d-1d1f7c143b71>#</a></h3><p><a href=https://www.shellcheck.net/>ShellCheck</a> 项目可帮助您识别 shell 脚本中的常见错误和警告。无论是大型还是小型脚本，都推荐
使用该工具。</p><h3 id=h:39f77101-8b9e-48d3-8378-b9286c796412>6.2 Command Substitution<a hidden class=anchor aria-hidden=true href=#h:39f77101-8b9e-48d3-8378-b9286c796412>#</a></h3><p>使用 <code>$(command)</code> 代替反引号。</p><p>嵌套的反引号需要用 <code>\</code> 来转义内部的反引号。 <code>$(command)</code> 的格式在嵌套时不会改变，并且更容易读取。</p><p>Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># This is preferred:</span>
</span></span><span class=line><span class=cl><span class=nv>var</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>command</span> <span class=s2>&#34;</span><span class=k>$(</span>command1<span class=k>)</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># This is not:</span>
</span></span><span class=line><span class=cl><span class=nv>var</span><span class=o>=</span><span class=s2>&#34;`command \`command1\``&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:2cf87600-2f6d-48c2-be83-78bcd604e5da>6.3 Test, <code>[ … ]</code>, and <code>\[\[ … \]\]</code><a hidden class=anchor aria-hidden=true href=#h:2cf87600-2f6d-48c2-be83-78bcd604e5da>#</a></h3><p>\[\[..\]\] is preferred over [ … ], test and <em>usr/bin</em>[.</p><p>\[\[..\]\] 减少错误的发生，因为在 \[\[ and \]\] 之间没有路径名展开或者单词分割。
此外，\[\[ … ]] 可以进行正则表达式匹配，而 [ … ] 不可以。</p><h3 id=h:35d9e289-38dc-42e3-a41c-6de70e4d8404>6.4 Testing Strings<a hidden class=anchor aria-hidden=true href=#h:35d9e289-38dc-42e3-a41c-6de70e4d8404>#</a></h3><p>在可能的情况下，请使用引号而不是填充字符。</p><p>Bash 足够聪明，能够处理测试中的空字符串。因此，考虑到代码更易读性，应该使用 test 来
处理空字符串或非空字符串，而不是使用填充字符。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Do this:</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>my_var</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;some_string&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -z (string length is zero) and -n (string length is not zero) are</span>
</span></span><span class=line><span class=cl><span class=c1># preferred over testing for an empty string</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> -z <span class=s2>&#34;</span><span class=si>${</span><span class=nv>my_var</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This is OK (ensure quotes on the empty side), but not preferred:</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>my_var</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=c1># Not this:</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>my_var</span><span class=si>}</span><span class=s2>X&#34;</span> <span class=o>==</span> <span class=s2>&#34;some_stringX&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To avoid confusion about what you’re testing <span class=k>for</span>, explicitly use -z or -n.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Use this</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> -n <span class=s2>&#34;</span><span class=si>${</span><span class=nv>my_var</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=c1># Instead of this</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>my_var</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><p>为了明确起见，使用==表示相等，而不是=，尽管两者都可以工作。前者鼓励使用[[，而后者可能会
与赋值混淆。但是，在[\[…]]中使用&lt;和>时要小心，它将执行词典比较。使用((…))或-lt 和-gt 进行数
值比较。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Use this</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>my_var</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;val&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>((</span> my_var &gt; <span class=m>3</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>my_var</span><span class=si>}</span><span class=s2>&#34;</span> -gt <span class=m>3</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=c1># Instead of this</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>my_var</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;val&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=c1># Probably unintended lexicographical comparison.</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>my_var</span><span class=si>}</span><span class=s2>&#34;</span> &gt; <span class=m>3</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=c1># True for 4, false for 22.</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:64dfe8cd-4826-44a0-aba3-7eb35ce48f26>6.5 Wildcard Expansion of Filenames<a hidden class=anchor aria-hidden=true href=#h:64dfe8cd-4826-44a0-aba3-7eb35ce48f26>#</a></h3><p>当使用通配符扩展文件名时，请使用显式路径。</p><p>由于文件名可能以 - 开头，使用 <code>./*</code> 而不是 <code>*</code> 来扩展通配符会更安全。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Here&#39;s the contents of the directory:</span>
</span></span><span class=line><span class=cl><span class=c1># -f  -r  somedir  somefile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Incorrectly deletes almost everything in the directory by force</span>
</span></span><span class=line><span class=cl>psa@bilby$ rm -v *
</span></span><span class=line><span class=cl>removed directory: <span class=sb>`</span>somedir<span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>removed `somefile&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># As opposed to:</span>
</span></span><span class=line><span class=cl>psa@bilby$ rm -v ./*
</span></span><span class=line><span class=cl>removed <span class=sb>`</span>./-f<span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>removed `./-r&#39;</span>
</span></span><span class=line><span class=cl>rm: cannot remove <span class=sb>`</span>./somedir<span class=s1>&#39;: Is a directory
</span></span></span><span class=line><span class=cl><span class=s1>removed `./somefile&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:32bb0195-e72a-4225-90ad-7117fde8d0a2>6.6 Eval<a hidden class=anchor aria-hidden=true href=#h:32bb0195-e72a-4225-90ad-7117fde8d0a2>#</a></h3><p><code>eval</code> 应该避免使用。</p><p>当用于对变量赋值时，eval 会修改输入，并且可以设置变量，无法检查这些变量是什么。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># What does this set?</span>
</span></span><span class=line><span class=cl><span class=c1># Did it succeed? In part or whole?</span>
</span></span><span class=line><span class=cl><span class=nb>eval</span> <span class=k>$(</span>set_my_variables<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># What happens if one of the returned values has a space in it?</span>
</span></span><span class=line><span class=cl><span class=nv>variable</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>eval</span> some_function<span class=k>)</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:2dd03710-f58f-42a5-9a44-e8018bfc560d>6.7 Arrays<a hidden class=anchor aria-hidden=true href=#h:2dd03710-f58f-42a5-9a44-e8018bfc560d>#</a></h3><ul><li><p>Bash 数组应该用于存储元素列表，以避免引号引用的复杂性。</p><ul><li>这尤其适用于参数列表。不应使用数组来方便更复杂的数据结构（参见上面的使用 Shell 时）。</li></ul></li><li><p>数组存储有序的字符串集合，并且可以安全地展开为命令或循环的单个元素。</p></li><li><p>应避免使用单个字符串作为多个命令参数，
因为这不可避免地导致作者使用 eval 或尝试在字符串中嵌套引号，这不会产生可靠或可读的结果，并且导致不必要的复杂性。</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># An array is assigned using parentheses, and can be appended to</span>
</span></span><span class=line><span class=cl><span class=c1># with +=( … ).</span>
</span></span><span class=line><span class=cl><span class=nb>declare</span> -a flags
</span></span><span class=line><span class=cl><span class=nv>flags</span><span class=o>=(</span>--foo --bar<span class=o>=</span><span class=s1>&#39;baz&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>flags</span><span class=o>+=(</span>--greeting<span class=o>=</span><span class=s2>&#34;Hello </span><span class=si>${</span><span class=nv>name</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>mybinary <span class=s2>&#34;</span><span class=si>${</span><span class=nv>flags</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Don’t use strings for sequences.</span>
</span></span><span class=line><span class=cl><span class=nv>flags</span><span class=o>=</span><span class=s1>&#39;--foo --bar=baz&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>flags</span><span class=o>+=</span><span class=s1>&#39; --greeting=&#34;Hello world&#34;&#39;</span>  <span class=c1># This won’t work as intended.</span>
</span></span><span class=line><span class=cl>mybinary <span class=si>${</span><span class=nv>flags</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=c1># Command expansions return single strings, not arrays. Avoid</span>
</span></span><span class=line><span class=cl><span class=c1># unquoted expansion in array assignments because it won’t</span>
</span></span><span class=line><span class=cl><span class=c1># work correctly if the command output contains special</span>
</span></span><span class=line><span class=cl><span class=c1># characters or whitespace.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This expands the listing output into a string, then does special keyword</span>
</span></span><span class=line><span class=cl><span class=c1># expansion, and then whitespace splitting.  Only then is it turned into a</span>
</span></span><span class=line><span class=cl><span class=c1># list of words.  The ls command may also change behavior based on the user&#39;s</span>
</span></span><span class=line><span class=cl><span class=c1># active environment!</span>
</span></span><span class=line><span class=cl><span class=nb>declare</span> -a <span class=nv>files</span><span class=o>=(</span><span class=k>$(</span>ls /directory<span class=k>)</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The get_arguments writes everything to STDOUT, but then goes through the</span>
</span></span><span class=line><span class=cl><span class=c1># same expansion process above before turning into a list of arguments.</span>
</span></span><span class=line><span class=cl>mybinary <span class=k>$(</span>get_arguments<span class=k>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=h:ddb31c21-29a3-46e3-ad4f-21146f74ff4b>6.7.1 Arrays Pros<a hidden class=anchor aria-hidden=true href=#h:ddb31c21-29a3-46e3-ad4f-21146f74ff4b>#</a></h4><ul><li>使用数组可以在不混淆引用语义的情况下创建列表。相反地，不使用数组会导致在字符串内部错误地嵌套引用的尝试。</li><li>数组使得可以安全地存储包含空格的任意字符串的序列/列表。</li></ul><h4 id=h:1d90b364-8f46-4129-ba9d-2e2240b81a0a>6.7.2 Arrays Cons<a hidden class=anchor aria-hidden=true href=#h:1d90b364-8f46-4129-ba9d-2e2240b81a0a>#</a></h4><p>使用数组可能会增加脚本的复杂性增加的风险。</p><h4 id=h:86f5e27f-5817-410f-afec-e16e1eacc75f>6.7.3 Arrays Decision<a hidden class=anchor aria-hidden=true href=#h:86f5e27f-5817-410f-afec-e16e1eacc75f>#</a></h4><p>应该使用数组来安全地创建和传递列表。特别是在构建一组命令参数时，应该使用数组来避免引号的混乱问题。使用引用扩展 - &ldquo;${array[@]}&rdquo; - 来访问数组。然而，如果需要更高级的数据操作，应该完全避免使用 shell 脚本;参见上面的内容。</p><h3 id=h:02047bfd-a8ec-4485-9930-17d1182370a5>6.8 Pipes to While<a hidden class=anchor aria-hidden=true href=#h:02047bfd-a8ec-4485-9930-17d1182370a5>#</a></h3><p>使用进程替换或者优先使用 bash4+里的 readarray 命令，而不是使用管道传递给 while。</p><p>管道会创建一个子 shell，所以在管道中修改的变量不会传递到父 shell。</p><p>管道传递给 while 的隐式子 shell 可能会引入难以追踪的细微错误。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>last_line</span><span class=o>=</span><span class=s1>&#39;NULL&#39;</span>
</span></span><span class=line><span class=cl>your_command <span class=p>|</span> <span class=k>while</span> <span class=nb>read</span> -r line<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[[</span> -n <span class=s2>&#34;</span><span class=si>${</span><span class=nv>line</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nv>last_line</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>line</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This will always output &#39;NULL&#39;!</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>last_line</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>使用进程替换也会创建一个子 shell。然而，它允许从子 shell 重定向到一个 while 循环，而无需
将 while（或任何其他命令）放入子 shell 中。</p><h3 id=h:2aa69bf1-223e-4c9d-902a-c195f99571a7>6.9 Arithmetic<a hidden class=anchor aria-hidden=true href=#h:2aa69bf1-223e-4c9d-902a-c195f99571a7>#</a></h3><ul><li>始终使用(( … ))或\((( … ))而不是 let 或\)[ … ]或 expr。</li><li>永远不要使用$[ … ]语法，expr 命令或 let 内置命令。</li><li>&lt;and>在\[[]]表达式内部不执行数字比较（而执行字典比较；请参见字符串测试）。</li><li>不要对数值比较使用[\[]]，而是使用 <code>(( … ))</code> 。</li><li>特别是在启用 set -e 的情况下。例如，set -e; i=0; (( i++ ))将导致
shell 退出。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Simple calculation used as text - note the use of $(( … )) within</span>
</span></span><span class=line><span class=cl><span class=c1># a string.</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=k>$((</span> <span class=m>2</span> <span class=o>+</span> <span class=m>2</span> <span class=k>))</span><span class=s2> is 4&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># When performing arithmetic comparisons for testing</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>((</span> a &lt; b <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  …
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Some calculation assigned to a variable.</span>
</span></span><span class=line><span class=cl><span class=o>((</span> <span class=nv>i</span> <span class=o>=</span> <span class=m>10</span> * j + <span class=m>400</span> <span class=o>))</span>
</span></span><span class=line><span class=cl><span class=c1># This form is non-portable and deprecated</span>
</span></span><span class=line><span class=cl><span class=nv>i</span><span class=o>=</span>$<span class=o>[</span><span class=m>2</span> * 10<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Despite appearances, &#39;let&#39; isn&#39;t one of the declarative keywords,</span>
</span></span><span class=line><span class=cl><span class=c1># so unquoted assignments are subject to globbing wordsplitting.</span>
</span></span><span class=line><span class=cl><span class=c1># For the sake of simplicity, avoid &#39;let&#39; and use (( … ))</span>
</span></span><span class=line><span class=cl><span class=nb>let</span> <span class=nv>i</span><span class=o>=</span><span class=s2>&#34;2 + 2&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The expr utility is an external program and not a shell builtin.</span>
</span></span><span class=line><span class=cl><span class=nv>i</span><span class=o>=</span><span class=k>$(</span> expr <span class=m>4</span> + <span class=m>4</span> <span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Quoting can be error prone when using expr too.</span>
</span></span><span class=line><span class=cl><span class=nv>i</span><span class=o>=</span><span class=k>$(</span> expr <span class=m>4</span> <span class=s1>&#39;*&#39;</span> <span class=m>4</span> <span class=k>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=h:f05a3c9b-4803-4daf-9f8e-a308ec4cdd7e>7 Naming Conventions<a hidden class=anchor aria-hidden=true href=#h:f05a3c9b-4803-4daf-9f8e-a308ec4cdd7e>#</a></h2><h3 id=h:bb847e7f-6e4d-42ef-9dbe-f21d51289ce3>7.1 Function Names<a hidden class=anchor aria-hidden=true href=#h:bb847e7f-6e4d-42ef-9dbe-f21d51289ce3>#</a></h3><ul><li>小写字母，用下划线分隔单词。</li><li>使用双冒号来分隔库。</li><li>在函数名后面需要使用括号。</li><li>关键字 function 是可选的，但必须在整个项目中保持一致使用。</li><li>如果你正在编写单个函数，请使用小写字母，并使用下划线分隔单词。</li><li>如果你正在编写一个包，应使用双冒号分隔包名。</li><li>大括号必须与函数名在同一行（与 Google 的其他语言一样），函数名与括号之间不要有空格。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Single function</span>
</span></span><span class=line><span class=cl>my_func<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  …
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Part of a package</span>
</span></span><span class=line><span class=cl>mypackage::my_func<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  …
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当函数名后面跟着“()”时，“function”关键字是多余的，但它能够加强对函数的快速识别。</p><h3 id=h:50d9a19c-c3c1-4f69-9933-5f6d4d4649b0>7.2 Variable Names<a hidden class=anchor aria-hidden=true href=#h:50d9a19c-c3c1-4f69-9933-5f6d4d4649b0>#</a></h3><p>关于函数名称。</p><p>循环变量的变量名称应与您正在遍历的任
何变量命名方式相似。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=k>for</span> zone in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>zones</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  something_with <span class=s2>&#34;</span><span class=si>${</span><span class=nv>zone</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:58b0b2a6-375f-4a97-804d-ad2fea2ee103>7.3 Constants and Environment Variable Names<a hidden class=anchor aria-hidden=true href=#h:58b0b2a6-375f-4a97-804d-ad2fea2ee103>#</a></h3><ul><li>所有字母大写，用下划线分隔，在文件顶部声明。</li><li>常量和任何导出到环境的内容都应大写。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Constant</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>PATH_TO_FILES</span><span class=o>=</span><span class=s1>&#39;/some/path&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Both constant and environment</span>
</span></span><span class=line><span class=cl><span class=nb>declare</span> -xr <span class=nv>ORACLE_SID</span><span class=o>=</span><span class=s1>&#39;PROD&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>有些东西在它们第一次设置后变得恒定（例如通过 getopts）。因此，在 getopts 或基于条件设置一个
constant 是可以的，但是之后应立即将其设置为 readonly。为了清晰起见，建议使用 readonly 或
export 而不是等效的 declare 命令。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>VERBOSE</span><span class=o>=</span><span class=s1>&#39;false&#39;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=nb>getopts</span> <span class=s1>&#39;v&#39;</span> flag<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>flag</span><span class=si>}</span><span class=s2>&#34;</span> in
</span></span><span class=line><span class=cl>    v<span class=o>)</span> <span class=nv>VERBOSE</span><span class=o>=</span><span class=s1>&#39;true&#39;</span> <span class=p>;;</span>
</span></span><span class=line><span class=cl>  <span class=k>esac</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> VERBOSE
</span></span></code></pre></td></tr></table></div></div><h3 id=h:888f6100-39cf-4d9a-b38b-75cf38526704>7.4 Source Filenames<a hidden class=anchor aria-hidden=true href=#h:888f6100-39cf-4d9a-b38b-75cf38526704>#</a></h3><p>使用小写字母，并在需要时用下划线分隔单词。</p><p>这是为了与 Google 中的其他代码风格保持一致：maketemplate 或 make_template，而不是 make-template。</p><h3 id=h:051bf4c0-5a94-4a7a-96c0-72c4c18e3547>7.5 Read-only Variables<a hidden class=anchor aria-hidden=true href=#h:051bf4c0-5a94-4a7a-96c0-72c4c18e3547>#</a></h3><p>使用 readonly 或 declare -r 来确保它们是只读的。</p><p>由于全局变量在 shell 中被广泛使用，因此在处理它们时捕捉错误是很重要的。当你声明一个变量
是只读的时候，要明确表示这一点。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>zip_version</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>dpkg --status zip <span class=p>|</span> grep Version: <span class=p>|</span> cut -d <span class=s1>&#39; &#39;</span> -f 2<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> -z <span class=s2>&#34;</span><span class=si>${</span><span class=nv>zip_version</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  error_message
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=nb>readonly</span> zip_version
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:31bbd098-0f2e-46fd-83f5-c249dc69e0a1>7.6 Use Local Variables<a hidden class=anchor aria-hidden=true href=#h:31bbd098-0f2e-46fd-83f5-c249dc69e0a1>#</a></h3><p>使用 local 关键字在函数内部声明具体函数变量。声明和赋值应该分开放在不同的行上。</p><p>通过使用 local 关键字在声明变量时，确保本地变量只在函数及其子函数内部可见。这样可以避免污染全局命名空间，并意外地设置对函数外部可能有重要意义的变量。</p><p>当赋值值由命令替换提供时，声明和赋值必须是分开的语句；因为 local 内建函数不会传播来自命
令替换的退出代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>my_func2<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> <span class=nv>name</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Separate lines for declaration and assignment:</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> my_var
</span></span><span class=line><span class=cl>  <span class=nv>my_var</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>my_func<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>((</span> <span class=nv>$?</span> <span class=o>==</span> <span class=m>0</span> <span class=o>))</span> <span class=o>||</span> <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  …
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>my_func2<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=c1># DO NOT do this:</span>
</span></span><span class=line><span class=cl>  <span class=c1># $? will always be zero, as it contains the exit code of &#39;local&#39;, not my_func</span>
</span></span><span class=line><span class=cl>  <span class=nb>local</span> <span class=nv>my_var</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>my_func<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>((</span> <span class=nv>$?</span> <span class=o>==</span> <span class=m>0</span> <span class=o>))</span> <span class=o>||</span> <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  …
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:24a30647-7c4c-491f-b703-bbf46125092d>7.7 Function Location<a hidden class=anchor aria-hidden=true href=#h:24a30647-7c4c-491f-b703-bbf46125092d>#</a></h3><p>将所有函数放在常量的下方，不要在函数之间隐藏可执行代码。这样做会使代码难以跟踪，并在调试
时会产生令人讨厌的意外。</p><p>如果您有函数，请将它们都放在文件的顶部附近。只有 includes、set 语句和设置常量可以在声明
函数之前完成。</p><h3 id=h:798b0a69-eb83-48ff-bcf3-a1860767c727>7.8 main<a hidden class=anchor aria-hidden=true href=#h:798b0a69-eb83-48ff-bcf3-a1860767c727>#</a></h3><p>如果脚本足够长，至少包含一个其他函数，则需要一个名为 main 的函数。</p><p>为了方便找到程序的起始点，将主程序放在一个名为 main 的函数中，作为最底层的函数。这样可以保
持与代码库其余部分的一致性，同时还允许您将更多变量定义为本地变量（如果主代码不是函数，则
无法完成此操作）。文件中最后一个非注释行应该是对 main 的调用：</p><h2 id=h:04e85d27-2e7a-4bbd-bec6-5ff094ed706f>8 Calling Commands<a hidden class=anchor aria-hidden=true href=#h:04e85d27-2e7a-4bbd-bec6-5ff094ed706f>#</a></h2><h3 id=h:2a0c36d5-95f1-4aae-9b18-2f44a9d992c4>8.1 Checking Return Values<a hidden class=anchor aria-hidden=true href=#h:2a0c36d5-95f1-4aae-9b18-2f44a9d992c4>#</a></h3><p>始终检查返回值并提供有信息的返回值。</p><p>对于未使用管道的命令，请使用 $? 或直接通过 if 语句进行检查，以保持简单。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=k>if</span> ! mv <span class=s2>&#34;</span><span class=si>${</span><span class=nv>file_list</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>dest_dir</span><span class=si>}</span><span class=s2>/&#34;</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Unable to move </span><span class=si>${</span><span class=nv>file_list</span><span class=p>[*]</span><span class=si>}</span><span class=s2> to </span><span class=si>${</span><span class=nv>dest_dir</span><span class=si>}</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>  <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Or</span>
</span></span><span class=line><span class=cl>mv <span class=s2>&#34;</span><span class=si>${</span><span class=nv>file_list</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>dest_dir</span><span class=si>}</span><span class=s2>/&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>((</span> <span class=nv>$?</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Unable to move </span><span class=si>${</span><span class=nv>file_list</span><span class=p>[*]</span><span class=si>}</span><span class=s2> to </span><span class=si>${</span><span class=nv>dest_dir</span><span class=si>}</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>  <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><p>Bash 还有一个名为 PIPESTATUS 的变量，允许检查管道中所有部分的返回代码。如果仅需要检查整个管
道的成功或失败，以下方法也是可行的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>tar -cf - ./* <span class=p>|</span> <span class=o>(</span> <span class=nb>cd</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>dir</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> tar -xf - <span class=o>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>((</span> PIPESTATUS<span class=o>[</span>0<span class=o>]</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>||</span> PIPESTATUS<span class=o>[</span>1<span class=o>]</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Unable to tar files to </span><span class=si>${</span><span class=nv>dir</span><span class=si>}</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><p>然而，一旦您执行其他命令，PIPESTATUS 将被覆盖，所以如果您需要根据管道中发生错误的位置来进行不同的错误处理，您需要在运行命令后立即将 PIPESTATUS 分配给另一个变量（请记住，[ 是一个命令，会清除
PIPESTATUS）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>tar -cf - ./* <span class=p>|</span> <span class=o>(</span> <span class=nb>cd</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>DIR</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> tar -xf - <span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>return_codes</span><span class=o>=(</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PIPESTATUS</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>((</span> return_codes<span class=o>[</span>0<span class=o>]</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>((</span> return_codes<span class=o>[</span>1<span class=o>]</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  do_something_else
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=h:eca45d0b-79dd-4e82-a638-bf072f336d79>8.2 Builtin Commands vs. External Commands<a hidden class=anchor aria-hidden=true href=#h:eca45d0b-79dd-4e82-a638-bf072f336d79>#</a></h3><p>在选择调用内置 shell 和调用独立进程之间，选择内置 shell。</p><p>我们更喜欢使用内置的函数，例如 bash(1) 中的参数扩展函数，因为它更健壮和可移植（特别是与类似 sed 的工具相比较）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Prefer this:</span>
</span></span><span class=line><span class=cl><span class=nv>addition</span><span class=o>=</span><span class=k>$((</span> X <span class=o>+</span> Y <span class=k>))</span>
</span></span><span class=line><span class=cl><span class=nv>substitution</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>string</span><span class=p>/#foo/bar</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Instead of this:</span>
</span></span><span class=line><span class=cl><span class=nv>addition</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>expr <span class=s2>&#34;</span><span class=si>${</span><span class=nv>X</span><span class=si>}</span><span class=s2>&#34;</span> + <span class=s2>&#34;</span><span class=si>${</span><span class=nv>Y</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>substitution</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>string</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>|</span> sed -e <span class=s1>&#39;s/^foo/bar/&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=h:36111ffd-58b2-49b6-85f0-8c0f3cfe80f4>9 Conclusion<a hidden class=anchor aria-hidden=true href=#h:36111ffd-58b2-49b6-85f0-8c0f3cfe80f4>#</a></h2><p>Use common sense and BE CONSISTENT.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://yangyingchao.github.io/tags/google/>google</a></li><li><a href=https://yangyingchao.github.io/tags/style/>style</a></li><li><a href=https://yangyingchao.github.io/tags/shell/>shell</a></li><li><a href=https://yangyingchao.github.io/tags/bash/>bash</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://yangyingchao.github.io>MyNotes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>