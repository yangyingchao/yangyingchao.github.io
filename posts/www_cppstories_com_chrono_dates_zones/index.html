<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>What is the current time around the world? Utilizing std::chrono with time zones in C++23 | MyNotes</title><meta name=keywords content><meta name=description content="1 Improving the print 2 Getting time in my current time zone 获取我当前时区的时间 3 Daylight saving time 夏令时 4 Summary 本文为摘录，原文为： https://www.cppstories.com/2024/chrono_dates_zones/ 在这篇博客文章中，我们将探讨如何使用 std::chrono 处理日期，包括时区"><meta name=author content="Yang Yingchao"><link rel=canonical href=https://yangyingchao.github.io/posts/www_cppstories_com_chrono_dates_zones/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://yangyingchao.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://yangyingchao.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://yangyingchao.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://yangyingchao.github.io/apple-touch-icon.png><link rel=mask-icon href=https://yangyingchao.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="What is the current time around the world? Utilizing std::chrono with time zones in C++23"><meta property="og:description" content="1 Improving the print 2 Getting time in my current time zone 获取我当前时区的时间 3 Daylight saving time 夏令时 4 Summary 本文为摘录，原文为： https://www.cppstories.com/2024/chrono_dates_zones/ 在这篇博客文章中，我们将探讨如何使用 std::chrono 处理日期，包括时区"><meta property="og:type" content="article"><meta property="og:url" content="https://yangyingchao.github.io/posts/www_cppstories_com_chrono_dates_zones/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-04T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-04T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="What is the current time around the world? Utilizing std::chrono with time zones in C++23"><meta name=twitter:description content="1 Improving the print 2 Getting time in my current time zone 获取我当前时区的时间 3 Daylight saving time 夏令时 4 Summary 本文为摘录，原文为： https://www.cppstories.com/2024/chrono_dates_zones/ 在这篇博客文章中，我们将探讨如何使用 std::chrono 处理日期，包括时区"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yangyingchao.github.io/posts/"},{"@type":"ListItem","position":2,"name":"What is the current time around the world? Utilizing std::chrono with time zones in C++23","item":"https://yangyingchao.github.io/posts/www_cppstories_com_chrono_dates_zones/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"What is the current time around the world? Utilizing std::chrono with time zones in C++23","name":"What is the current time around the world? Utilizing std::chrono with time zones in C\u002b\u002b23","description":"1 Improving the print 2 Getting time in my current time zone 获取我当前时区的时间 3 Daylight saving time 夏令时 4 Summary 本文为摘录，原文为： https://www.cppstories.com/2024/chrono_dates_zones/ 在这篇博客文章中，我们将探讨如何使用 std::chrono 处理日期，包括时区","keywords":[],"articleBody":" 1 Improving the print 2 Getting time in my current time zone 获取我当前时区的时间 3 Daylight saving time 夏令时 4 Summary 本文为摘录，原文为： https://www.cppstories.com/2024/chrono_dates_zones/\n在这篇博客文章中，我们将探讨如何使用 std::chrono 处理日期，包括时区。我们将利用该库的最新特性来检索各个时区的当前时间，同时考虑夏令时的变化。此外，我们还将结合 C++23 中引入的新功能，例如增强的打印函数等。\n让我们从以下代码开始，它将打印当前的日期和时间：\n#include #include int main() { auto now = std::chrono::system_clock::now(); std::print(\"now is {}\", now); } 在我的会话中，我得到以下结果：\nNow is 2024-11-01 11:44:06.374573703 这很简单，但我们处于哪个时区？我们可以以更短的形式打印出来吗？我们如何检查世界各地的时间？夏令时呢？\n第一件事：时间输出。\n1 Improving the print 如您所见，我使用了 C++23 中的 std::print ，这在 GCC 14 中可用！默认情况下， 使用 std::chrono::system_clock::now() 获得的时间点会打印完整信息， 但我们可以更改并调整它。例如：\n基本日期和时间格式设置 Basic Date and Time Formatting\n仅显示日期： {0:%F} 将日期格式化为 YYYY-MM-DD 。 使用 hh:mm:ss 格式显示时间： {0:%T} 将时间格式化为 HH:MM:SS 。 显示月份和/或星期几的名称： {0:%A, %B} 将格式化为星期几，月份。 Advanced Formatting Options\nYear and Month:\n{0:%Y}: Full year (e.g., 2024). {0:%y}: Last two digits of the year (e.g., 24). {0:%B}: Full month name (e.g., November). {0:%b}: Abbreviated month name (e.g., Nov). Day and Week:\n{0:%d}: Day of the month, zero-padded (e.g., 01). {0:%A}: Full weekday name (e.g., Friday). {0:%a}: Abbreviated weekday name (e.g., Fri). Time of Day:\n{0:%H}: Hour (24-hour clock), zero-padded (e.g., 14). {0:%I}: Hour (12-hour clock), zero-padded (e.g., 02). {0:%M}: Minute, zero-padded (e.g., 05). {0:%S}: Second, zero-padded (e.g., 09). {0:%p}: AM/PM designation. Time Zone:\n{0:%Z}: Time zone abbreviation (e.g., UTC). {0:%z}: Offset from UTC (e.g., +0000). Here is an example demonstrating some of these formatting options:\n#include #include int main() { auto now = std::chrono::system_clock::now(); std::print(\"Full date and time: {0:%Y-%m-%d %H:%M:%S}\\n\", now); std::print(\"Date only: {0:%F}\\n\", now); std::print(\"Time only: {0:%T}\\n\", now); std::print(\"Day of the week: {0:%A}\\n\", now); std::print(\"Month name: {0:%B}\\n\", now); std::print(\"12-hour clock with AM/PM: {0:%I:%M:%S %p}\\n\", now); std::print(\"ISO 8601 format: {0:%FT%T%z}\\n\", now); } Run @Compiler Explorer\nExample output:\nFull date and time: 2024-11-02 19:35:16.296643881 Date only: 2024-11-02 Time only: 19:35:16.296643881 Day of the week: Saturday Month name: November 12-hour clock with AM/PM: 07:35:16.296643881 PM ISO 8601 format: 2024-11-02T19:35:16.296643881+0000 2 Getting time in my current time zone 获取我当前时区的时间 #include #include int main() { const auto now = std::chrono::system_clock::now(); auto zt_local = std::chrono::zoned_time{ std::chrono::current_zone(), now }; std::print(\"now is {} UTC and local is: {}\\n\", now, zt_local); constexpr std::string_view Warsaw{ \"Europe/Warsaw\" }; constexpr std::string_view NewYork{ \"America/New_York\" }; constexpr std::string_view Tokyo{ \"Asia/Tokyo\" }; try { const std::chrono::zoned_time zt_w{Warsaw, now}; std::print(\"Warsaw: {0:%F} {0:%R}\\n\", zt_w); const std::chrono::zoned_time zt_ny{NewYork, now}; std::print(\"New York: {0:%F} {0:%R}\\n\", zt_ny); const std::chrono::zoned_time zt_t{Tokyo, now}; std::print(\"Tokyo: {0:%F} {0:%R}\\n\", zt_t); } catch (std::runtime_error\u0026 ex) { std::print(\"Error: {}\", ex.what()); } } Example output:\nnow is 2024-11-01 19:24:51.319170338 UTC and local is: 2024-11-01 19:24:51.319170338 Warsaw: 2024-11-01 20:24 New York: 2024-11-01 15:24 Tokyo: 2024-11-02 04:24 让我们现在深入细节：\n获取当前时间：\n我们通过使用 std::chrono::system_clock::now() 来获取当前时间。 这将给我们 UTC 的当前时间。 本地时区：\n我们使用 std::chrono::current_zone() 创建一个 std::chrono::zoned_time 对象， 该对象会自动检测代码运行所在系统的本地时区。这使我们能够将 UTC 时间转换为本地时区。 时区转换：\n我们使用 std=::string_view= 定义三个时区：华沙、纽约和东京。 这些时区是使用各自的 IANA 时区标识符进行指定的。\n对于每个时区，我们创建一个 std::chrono::zoned_time 对象， 将当前的 UTC 时间转换为指定的时区。\n打印结果：\n我们使用 std::print 来显示 UTC 和本地时区的当前时间。\n对于每个指定的时区（华沙、纽约、东京）， 我们使用格式说明符 {0:%F} 打印日期（ YYYY-MM-DD ）和 {0:%R} 打印时间（ HH:MM ）。\n错误处理： – 代码被包裹在一个 try-catch 块中，以处理任何潜在的运行时错误，例如无效的时区标识符。\n3 Daylight saving time 夏令时 我们甚至可以检查与我们当前时区相关的一些额外信息。 我们可以从 zoned_time 中获取信息并打印出开始/结束、偏移量等信息：\n#include #include #include int main() { try { const auto now = std::chrono::floor\u003cstd::chrono::minutes\u003e(std::chrono::system_clock::now()); auto zt_local = std::chrono::zoned_time{ \"Europe/Warsaw\", now }; std::print(\"现在是 {} UTC，华沙是: {}\\n\", now, zt_local); auto info = zt_local.get_info(); std::print(\"本地时间信息: \\n缩写: {},\\n 开始 {}, 结束 {}, \\n偏移 {}, 夏令时 {}\\n\", info.abbrev, info.begin, info.end, info.offset, info.save); } catch (std::runtime_error\u0026 ex) { std::print(\"错误: {}\", ex.what()); } } 和夏令时信息：\n#include #include void printInfo(std::chrono::sys_days sd, std::string_view zone) { auto zt_local = std::chrono::zoned_time{ \"Europe/Warsaw\", std::chrono::sys_days{sd} }; auto info = zt_local.get_info(); std::print(\"在 {:%F} 的 {} 的时间信息:\\n缩写: {},\\n开始 {}, 结束 {}, \\n偏移 {}, 夏令时 {}\\n\", sd, zone, info.abbrev, info.begin, info.end, info.offset, info.save); } int main() { try { printInfo(std::chrono::year{ 2024 } / 9 / 14, \"Europe/Warsaw\"); printInfo(std::chrono::year{ 2024 } / 11 / 14, \"Europe/Warsaw\"); } catch (std::runtime_error\u0026 ex) { std::print(\"错误: {}\", ex.what()); } } 我得到了：\n在 Europe/Warsaw 的时间信息 2024-09-14: 缩写: CEST, 开始 2024-03-31 01:00:00, 结束 2024-10-27 01:00:00, 偏移 7200s, 夏令时 60min 在 Europe/Warsaw 的时间信息 2024-11-14: 缩写: CET, 开始 2024-10-27 01:00:00, 结束 2025-03-30 01:00:00, 偏移 3600s, 夏令时 0min 如您所见，我们获得了以下信息：\n– info.abbrev - 时区缩写名，例如 CET、PT 等 – info.begin, info.end - 给定时区的开始和结束日期（以 sys_seconds 为单位），通常在夏令时转换时会发生变化 – info.offset - 相对于 UTC 时间的偏移量 – info.save - 如果不为零，则表示时区处于夏令时\n4 Summary 这真是一趟旅程！我们从简单的当前时间显示开始，逐渐过渡到更复杂的场景，包括 C++20 和 C++23 中提供的各种格式选项， 以及时区。最后，我们探讨了如何检查特定时间点的细节，并检查与其时区相关的信息。\n","wordCount":"1596","inLanguage":"zh-cn","datePublished":"2024-11-04T00:00:00Z","dateModified":"2024-11-04T00:00:00Z","author":[{"@type":"Person","name":"Yang Yingchao"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://yangyingchao.github.io/posts/www_cppstories_com_chrono_dates_zones/"},"publisher":{"@type":"Organization","name":"MyNotes","logo":{"@type":"ImageObject","url":"https://yangyingchao.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yangyingchao.github.io accesskey=h title="MyNotes (Alt + H)">MyNotes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yangyingchao.github.io/ title=Home><span>Home</span></a></li><li><a href=https://yangyingchao.github.io/posts/ title=Archives><span>Archives</span></a></li><li><a href=https://yangyingchao.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://yangyingchao.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://yangyingchao.github.io/contact/ title="Contact me"><span>Contact me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">What is the current time around the world? Utilizing std::chrono with time zones in C++23</h1><div class=post-meta><span title='2024-11-04 00:00:00 +0000 UTC'>November 4, 2024</span>&nbsp;·&nbsp;Yang Yingchao</div></header><div class=post-content><ul><li>1 <a href=#improving-the-print>Improving the print</a></li><li>2 <a href=#getting-time-in-my-current-time-zone-%E8%8E%B7%E5%8F%96%E6%88%91%E5%BD%93%E5%89%8D%E6%97%B6%E5%8C%BA%E7%9A%84%E6%97%B6%E9%97%B4>Getting time in my current time zone 获取我当前时区的时间</a></li><li>3 <a href=#daylight-saving-time-%E5%A4%8F%E4%BB%A4%E6%97%B6>Daylight saving time 夏令时</a></li><li>4 <a href=#summary>Summary</a></li></ul><p>本文为摘录，原文为： <a href=https://www.cppstories.com/2024/chrono_dates_zones/>https://www.cppstories.com/2024/chrono_dates_zones/</a></p><p>在这篇博客文章中，我们将探讨如何使用 std::chrono 处理日期，包括时区。我们将利用该库的最新特性来检索各个时区的当前时间，同时考虑夏令时的变化。此外，我们还将结合 C++23 中引入的新功能，例如增强的打印函数等。</p><p>让我们从以下代码开始，它将打印当前的日期和时间：</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;chrono&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;print&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07></span>
</span></span><span style=display:flex><span><span style=color:#dc322f>int</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#719e07>auto</span> now <span style=color:#719e07>=</span> std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>system_clock<span style=color:#719e07>::</span>now();
</span></span><span style=display:flex><span>    std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;now is {}&#34;</span>, now);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在我的会话中，我得到以下结果：</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Now is 2024-11-01 11:44:06.374573703
</span></span></code></pre></div><p>这很简单，但我们处于哪个时区？我们可以以更短的形式打印出来吗？我们如何检查世界各地的时间？夏令时呢？</p><p>第一件事：时间输出。</p><h2 id=improving-the-print>1 Improving the print<a hidden class=anchor aria-hidden=true href=#improving-the-print>#</a></h2><p>如您所见，我使用了 C++23 中的 <code>std::print</code> ，这在 GCC 14 中可用！默认情况下，
使用 <code>std::chrono::system_clock::now()</code> 获得的时间点会打印完整信息，
但我们可以更改并调整它。例如：</p><ul><li><p>基本日期和时间格式设置 Basic Date and Time Formatting</p><ul><li><strong>仅显示日期：</strong> <code>{0:%F}</code> 将日期格式化为 <code>YYYY-MM-DD</code> 。</li><li><strong>使用 hh:mm:ss 格式显示时间：</strong> <code>{0:%T}</code> 将时间格式化为 <code>HH:MM:SS</code> 。</li><li><strong>显示月份和/或星期几的名称：</strong> <code>{0:%A, %B}</code> 将格式化为星期几，月份。</li></ul></li><li><p>Advanced Formatting Options</p><ul><li><p>Year and Month:</p><ul><li><code>{0:%Y}</code>: Full year (e.g., 2024).</li><li><code>{0:%y}</code>: Last two digits of the year (e.g., 24).</li><li><code>{0:%B}</code>: Full month name (e.g., November).</li><li><code>{0:%b}</code>: Abbreviated month name (e.g., Nov).</li></ul></li><li><p>Day and Week:</p><ul><li><code>{0:%d}</code>: Day of the month, zero-padded (e.g., 01).</li><li><code>{0:%A}</code>: Full weekday name (e.g., Friday).</li><li><code>{0:%a}</code>: Abbreviated weekday name (e.g., Fri).</li></ul></li><li><p>Time of Day:</p><ul><li><code>{0:%H}</code>: Hour (24-hour clock), zero-padded (e.g., 14).</li><li><code>{0:%I}</code>: Hour (12-hour clock), zero-padded (e.g., 02).</li><li><code>{0:%M}</code>: Minute, zero-padded (e.g., 05).</li><li><code>{0:%S}</code>: Second, zero-padded (e.g., 09).</li><li><code>{0:%p}</code>: AM/PM designation.</li></ul></li><li><p>Time Zone:</p><ul><li><code>{0:%Z}</code>: Time zone abbreviation (e.g., UTC).</li><li><code>{0:%z}</code>: Offset from UTC (e.g., +0000).</li></ul></li></ul></li></ul><p>Here is an example demonstrating some of these formatting options:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;chrono&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;print&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07></span><span style=color:#dc322f>int</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#719e07>auto</span> now <span style=color:#719e07>=</span> std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>system_clock<span style=color:#719e07>::</span>now();
</span></span><span style=display:flex><span>    std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;Full date and time: {0:%Y-%m-%d %H:%M:%S}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, now);
</span></span><span style=display:flex><span>    std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;Date only: {0:%F}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, now);
</span></span><span style=display:flex><span>    std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;Time only: {0:%T}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, now);
</span></span><span style=display:flex><span>    std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;Day of the week: {0:%A}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, now);
</span></span><span style=display:flex><span>    std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;Month name: {0:%B}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, now);
</span></span><span style=display:flex><span>    std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;12-hour clock with AM/PM: {0:%I:%M:%S %p}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, now);
</span></span><span style=display:flex><span>    std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;ISO 8601 format: {0:%FT%T%z}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, now);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Run @Compiler Explorer</p><p>Example output:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Full date and time: 2024-11-02 19:35:16.296643881
</span></span><span style=display:flex><span>Date only: 2024-11-02
</span></span><span style=display:flex><span>Time only: 19:35:16.296643881
</span></span><span style=display:flex><span>Day of the week: Saturday
</span></span><span style=display:flex><span>Month name: November
</span></span><span style=display:flex><span>12-hour clock with AM/PM: 07:35:16.296643881 PM
</span></span><span style=display:flex><span>ISO 8601 format: 2024-11-02T19:35:16.296643881+0000
</span></span></code></pre></div><h2 id=getting-time-in-my-current-time-zone-获取我当前时区的时间>2 Getting time in my current time zone 获取我当前时区的时间<a hidden class=anchor aria-hidden=true href=#getting-time-in-my-current-time-zone-获取我当前时区的时间>#</a></h2><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;chrono&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;print&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07></span>
</span></span><span style=display:flex><span><span style=color:#dc322f>int</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#719e07>const</span> <span style=color:#719e07>auto</span> now <span style=color:#719e07>=</span> std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>system_clock<span style=color:#719e07>::</span>now();
</span></span><span style=display:flex><span>    <span style=color:#719e07>auto</span> zt_local <span style=color:#719e07>=</span> std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>zoned_time{ std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>current_zone(), now };
</span></span><span style=display:flex><span>    std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;now is {} UTC and local is: {}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, now, zt_local);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>constexpr</span> std<span style=color:#719e07>::</span>string_view Warsaw{ <span style=color:#2aa198>&#34;Europe/Warsaw&#34;</span> };
</span></span><span style=display:flex><span>    <span style=color:#719e07>constexpr</span> std<span style=color:#719e07>::</span>string_view NewYork{ <span style=color:#2aa198>&#34;America/New_York&#34;</span> };
</span></span><span style=display:flex><span>    <span style=color:#719e07>constexpr</span> std<span style=color:#719e07>::</span>string_view Tokyo{ <span style=color:#2aa198>&#34;Asia/Tokyo&#34;</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#719e07>try</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#719e07>const</span> std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>zoned_time zt_w{Warsaw, now};
</span></span><span style=display:flex><span>        std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;Warsaw: {0:%F} {0:%R}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, zt_w);
</span></span><span style=display:flex><span>        <span style=color:#719e07>const</span> std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>zoned_time zt_ny{NewYork, now};
</span></span><span style=display:flex><span>        std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;New York: {0:%F} {0:%R}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, zt_ny);
</span></span><span style=display:flex><span>        <span style=color:#719e07>const</span> std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>zoned_time zt_t{Tokyo, now};
</span></span><span style=display:flex><span>        std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;Tokyo: {0:%F} {0:%R}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, zt_t);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#719e07>catch</span> (std<span style=color:#719e07>::</span>runtime_error<span style=color:#719e07>&amp;</span> ex)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;Error: {}&#34;</span>, ex.what());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Example output:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>now is 2024-11-01 19:24:51.319170338 UTC and local is: 2024-11-01 19:24:51.319170338
</span></span><span style=display:flex><span>Warsaw: 2024-11-01 20:24
</span></span><span style=display:flex><span>New York: 2024-11-01 15:24
</span></span><span style=display:flex><span>Tokyo: 2024-11-02 04:24
</span></span></code></pre></div><p>让我们现在深入细节：</p><ol><li><p>获取当前时间：</p><ul><li>我们通过使用 <code>std::chrono::system_clock::now()</code> 来获取当前时间。
这将给我们 UTC 的当前时间。</li></ul></li><li><p>本地时区：</p><ul><li>我们使用 <code>std::chrono::current_zone()</code> 创建一个 <code>std::chrono::zoned_time</code> 对象，
该对象会自动检测代码运行所在系统的本地时区。这使我们能够将 UTC 时间转换为本地时区。</li></ul></li><li><p>时区转换：</p><ul><li><p>我们使用 std=::string_view= 定义三个时区：华沙、纽约和东京。
这些时区是使用各自的 IANA 时区标识符进行指定的。</p></li><li><p>对于每个时区，我们创建一个 <code>std::chrono::zoned_time</code> 对象，
将当前的 UTC 时间转换为指定的时区。</p></li></ul></li><li><p>打印结果：</p><ul><li><p>我们使用 <code>std::print</code> 来显示 UTC 和本地时区的当前时间。</p></li><li><p>对于每个指定的时区（华沙、纽约、东京），
我们使用格式说明符 <code>{0:%F}</code> 打印日期（ <code>YYYY-MM-DD</code> ）和 <code>{0:%R}</code> 打印时间（ <code>HH:MM</code> ）。</p></li></ul></li><li><p>错误处理：
– 代码被包裹在一个 <code>try-catch</code> 块中，以处理任何潜在的运行时错误，例如无效的时区标识符。</p></li></ol><h2 id=daylight-saving-time-夏令时>3 Daylight saving time 夏令时<a hidden class=anchor aria-hidden=true href=#daylight-saving-time-夏令时>#</a></h2><p>我们甚至可以检查与我们当前时区相关的一些额外信息。
我们可以从 <code>zoned_time</code> 中获取信息并打印出开始/结束、偏移量等信息：</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;chrono&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;print&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;iostream&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07></span>
</span></span><span style=display:flex><span><span style=color:#dc322f>int</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#719e07>try</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#719e07>const</span> <span style=color:#719e07>auto</span> now <span style=color:#719e07>=</span> std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>floor<span style=color:#719e07>&lt;</span>std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>minutes<span style=color:#719e07>&gt;</span>(std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>system_clock<span style=color:#719e07>::</span>now());
</span></span><span style=display:flex><span>        <span style=color:#719e07>auto</span> zt_local <span style=color:#719e07>=</span> std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>zoned_time{ <span style=color:#2aa198>&#34;Europe/Warsaw&#34;</span>, now };
</span></span><span style=display:flex><span>        std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;现在是 {} UTC，华沙是: {}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>, now, zt_local);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#719e07>auto</span> info <span style=color:#719e07>=</span> zt_local.get_info();
</span></span><span style=display:flex><span>        std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;本地时间信息: </span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>缩写: {},</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198> 开始 {}, 结束 {}, </span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>偏移 {}, 夏令时 {}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>,
</span></span><span style=display:flex><span>                          info.abbrev, info.begin, info.end, info.offset, info.save);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#719e07>catch</span> (std<span style=color:#719e07>::</span>runtime_error<span style=color:#719e07>&amp;</span> ex)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;错误: {}&#34;</span>, ex.what());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>和夏令时信息：</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;chrono&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07>#include</span> <span style=color:#719e07>&lt;print&gt;</span><span style=color:#719e07>
</span></span></span><span style=display:flex><span><span style=color:#719e07></span>
</span></span><span style=display:flex><span><span style=color:#dc322f>void</span> <span style=color:#268bd2>printInfo</span>(std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>sys_days sd, std<span style=color:#719e07>::</span>string_view zone) {
</span></span><span style=display:flex><span>    <span style=color:#719e07>auto</span> zt_local <span style=color:#719e07>=</span> std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>zoned_time{ <span style=color:#2aa198>&#34;Europe/Warsaw&#34;</span>, std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>sys_days{sd} };
</span></span><span style=display:flex><span>    <span style=color:#719e07>auto</span> info <span style=color:#719e07>=</span> zt_local.get_info();
</span></span><span style=display:flex><span>    std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;在 {:%F} 的 {} 的时间信息:</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>缩写: {},</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>开始 {}, 结束 {}, </span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>偏移 {}, 夏令时 {}</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>,
</span></span><span style=display:flex><span>                sd, zone, info.abbrev, info.begin, info.end, info.offset, info.save);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#dc322f>int</span> <span style=color:#268bd2>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#719e07>try</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        printInfo(std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>year{ <span style=color:#2aa198>2024</span> } <span style=color:#719e07>/</span> <span style=color:#2aa198>9</span> <span style=color:#719e07>/</span> <span style=color:#2aa198>14</span>, <span style=color:#2aa198>&#34;Europe/Warsaw&#34;</span>);
</span></span><span style=display:flex><span>        printInfo(std<span style=color:#719e07>::</span>chrono<span style=color:#719e07>::</span>year{ <span style=color:#2aa198>2024</span> } <span style=color:#719e07>/</span> <span style=color:#2aa198>11</span> <span style=color:#719e07>/</span> <span style=color:#2aa198>14</span>, <span style=color:#2aa198>&#34;Europe/Warsaw&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#719e07>catch</span> (std<span style=color:#719e07>::</span>runtime_error<span style=color:#719e07>&amp;</span> ex)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        std<span style=color:#719e07>::</span>print(<span style=color:#2aa198>&#34;错误: {}&#34;</span>, ex.what());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>我得到了：</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>在 Europe/Warsaw 的时间信息 2024-09-14:
</span></span><span style=display:flex><span>缩写: CEST,
</span></span><span style=display:flex><span>开始 2024-03-31 01:00:00, 结束 2024-10-27 01:00:00,
</span></span><span style=display:flex><span>偏移 7200s, 夏令时 60min
</span></span><span style=display:flex><span>在 Europe/Warsaw 的时间信息 2024-11-14:
</span></span><span style=display:flex><span>缩写: CET,
</span></span><span style=display:flex><span>开始 2024-10-27 01:00:00, 结束 2025-03-30 01:00:00,
</span></span><span style=display:flex><span>偏移 3600s, 夏令时 0min
</span></span></code></pre></div><p>如您所见，我们获得了以下信息：</p><p>– info.abbrev - 时区缩写名，例如 CET、PT 等
– info.begin, info.end - 给定时区的开始和结束日期（以 sys_seconds 为单位），通常在夏令时转换时会发生变化
– info.offset - 相对于 UTC 时间的偏移量
– info.save - 如果不为零，则表示时区处于夏令时</p><h2 id=summary>4 Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>这真是一趟旅程！我们从简单的当前时间显示开始，逐渐过渡到更复杂的场景，包括 C++20 和 C++23 中提供的各种格式选项，
以及时区。最后，我们探讨了如何检查特定时间点的细节，并检查与其时区相关的信息。</p></div><footer class=post-footer><ul class=post-tags></ul></footer><script src=https://giscus.app/client.js data-repo=yangyingchao/giscus data-repo-id=R_kgDON6NYZA data-category=Announcements data-category-id=DIC_kwDON6NYZM4CnANs data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://yangyingchao.github.io>MyNotes</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>